# Backend/MySQL/概要

## 共通

### ドキュメント

- [MySQL :: MySQL 5.6 リファレンスマニュアル](https://dev.mysql.com/doc/refman/5.6/ja/)
- [Mac へ MySQL を Homebrew でインストールする手順 - Qiita](https://qiita.com/hkusu/items/cda3e8461e7a46ecf25d)

### インストール

```bash
brew install mysql
```

### MySQLの起動・終了

| コマンド               | 概要                |
| ---------------------- | ------------------- |
| `mysql.server start`   | MySQLを起動する。   |
| `mysql.server stop`    | MySQLを終了する。   |
| `mysql.server restart` | MySQLを再起動する。 |

### MySQLの起動・終了（`brew services`を使用する場合）

| コマンド                      | 概要                                  |
| ----------------------------- | ------------------------------------- |
| `brew services start mysql`   | MySQLを起動し、自動起動をオンにする。 |
| `brew services stop mysql`    | MySQLを終了し、自動起動をオフにする。 |
| `brew services restart mysql` | MySQLを再起動する。                   |

## mysql

### コマンド

|コマンド|概要|
|---|---|
|`mysql [データベース名]`|MySQLにログインし、対話的にSQLを実行する。|
|`mysql [データベース名]`（標準入力あり）|MySQLにログインし、標準入力のSQLを実行する。|
|`mysql -e SQL文 [データベース名]`|MySQLにログインし、指定したSQLを実行する。|

### オプション（接続情報系）

|オプション|概要|
|---|---|
|`-h ホスト名`|ホストを指定する。|
|`-u ユーザー名`|ユーザー名を指定する。（未指定時は、ログインユーザー名となる）|
|`-pパスワード`|パスワードを指定する。（間にスペースは入れない）|

### オプション（その他）

|オプション|概要|
|---|---|
|`-N`|カラム名を出力しない。|
|`-B`|値のみ出力する。|

### ホスト名

- `localhost`（デフォルト）：ソケットで接続される
- `127.0.0.1`：TCP経由で接続される。
- デフォルトでうまく接続できない場合は、ホスト名に`127.0.0.1`を指定する。
  [MySQLでlocalhostと127.0.0.1の違い - Qiita](https://qiita.com/TanukiTam/items/f6a08740d0fcda0db7be)

## mysql内操作

### コマンド

| コマンド                    | 概要                                           |
| --------------------------- | ---------------------------------------------- |
| `\h`, `help`<br />`\?`, `?` | ヘルプを表示する。                             |
| `\g`, `go`                  | コマンドを送信する。                           |
| `\G`, `ego`                 | コマンドを送信し、縦型のレイアウトで表示する。 |
| `\W`, `warnings`            | コマンドの後に、警告を表示する。               |
| `\w`, `nowarnings`          | コマンドの後に、警告を表示しない。             |

### ログ

- CLIでインタラクティブに実行されたログは、`MYSQL_HISTFILE`（通常は`~/.mysql_history`）に出力される。

- ログを残したくない場合は、以下のようにログインする。

  ```bash
  MYSQL_HISTFILE=/dev/null mysql ...
  ```

## mysqldump

### コマンド

|コマンド|概要|
|---|---|
|`mysqldump データベース名 [テーブル名...]`|dumpを標準出力に出力する。|

### オプション

| オプション      | 概要                                                         |
| --------------- | ------------------------------------------------------------ |
| `-h ホスト名`   | ホストを指定する。                                           |
| `-u ユーザー名` | ユーザー名を指定する。（未指定時は、ログインユーザー名となる） |
| `-pパスワード`  | パスワードを指定する。（間にスペースは入れない）             |

### その他

- バージョンの違いのエラー（`Unknown table 'column_statistics' in information_schema`）が出た場合は、`--skip-column-statistics`オプションを付ける。
  [mysqldumpコマンドで "Unknown table 'COLUMN_STATISTICS' in information_schema (1109)" と怒られる原因と対策 - モヒカンメモ](https://blog.pinkumohikan.com/entry/mysqldump-disable-column-statistics)

- 作成したdumpファイルのインポート

  ```bash
  mysql [データベース名] < ファイル名
  ```
