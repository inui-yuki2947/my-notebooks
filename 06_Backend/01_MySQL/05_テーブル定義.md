# Backend/MySQL/テーブル定義

## データ型

### 数値型

- `unsigned`型の数値を使った演算結果が負数になる場合は、キャストを行う。
  - [MySQL :: MySQL 5.6 リファレンスマニュアル :: 11.2.6 範囲外およびオーバーフローの処理](https://dev.mysql.com/doc/refman/5.6/ja/out-of-range-and-overflow.html)
  - [UNSIGNEDなカラムの演算でマイナス値になるとエラーになる - Qiita](https://qiita.com/cufh/items/ed6203f368f1ec1bf3a7)

### 日時型

| 型          | 概要                       | 表せる範囲                                   |
| ----------- | -------------------------- | -------------------------------------------- |
| `datetime`  | タイムゾーンを意識しない型 | `1000-01-01 00:00:00`～`9999-12-31 23:59:59` |
| `timestamp` | タイムゾーンを意識した型   | `1970-01-01 00:00:01`〜`2038-01-19 03:14:07` |

- 日付の演算には、`INTERVAL`関数が使える。

  ```sql
  SELECT NOW() - INTERVAL 1 MONTH
  ```

- `yyyyMM`形式の数値には、`PERIOD_ADD`関数が使える。

### 文字列型

- 文字列型のリテラル値は、**シングルクォーテーション**で囲う。
- 文字列の結合は、`+`もしくは`CONCAT`で行う。
- バイト数は、非バイナリ文字列型の場合は**文字数**、バイナリ文字列型の場合は**バイト数**となる。

| 型        | 概要                                                         |
| --------- | ------------------------------------------------------------ |
| `CHAR`    | **常に指定したバイト数**を消費する。                         |
| `VARCHAR` | 「文字列のバイト数＋**バイト長のプリフィックス**（1バイトあるいは2バイト）」を消費する。 |

## テーブル

### CREATE TABLE

- テーブル定義を記述する場合

  ```sql
  CREATE [TEMPORARY] TABLE [IF NOT EXISTS] テーブル名 (テーブル定義, ...)
  ```

- クエリから生成する場合

  ```sql
  CREATE [TEMPORARY] TABLE [IF NOT EXISTS] テーブル名 クエリ
  ```

- 既存テーブルを利用する場合

  ```sql
  CREATE [TEMPORARY] TABLE [IF NOT EXISTS] テーブル名 LIKE 既存テーブル名
  ```

- `RENAME, MODIFY, CHANGE`句の違い

| 句       | 概要                                   |
| -------- | -------------------------------------- |
| `RENAME` | テーブル・インデックス・カラム名の変更 |
| `MODIFY` | カラム定義の変更                       |
| `CHANGE` | カラム名と定義の変更                   |

### AUTO_INCREMENT

- 値の確認（方法1）

  ```sql
  SELECT * FROM information_schema.tables;
  ```

- 値の確認（方法2）

  ```sql
  SHOW TABLE STATUS;
  ```

- 値の再設定（ただし、当該カラムに入っている最大値以上に変更する場合に限る）

  ```sql
  ALTER TABLE テーブル名 AUTO_INCREMENT = 再設定したい値;
  ```

### 制約

- PRIMARY制約は、UNIQUE制約をテーブルに一つしか設定できないようにしたもの
  （どちらかのみ設定すればよい）
- 以下のSQLで、一時的に外部キー制約を無効にできる。

  ```sql
  SET FOREIGN_KEY_CHECKS = 0;
  ```

### SHOW CREATE TABLE

- `SHOW CREATE TABLE`文は、指定されたテーブルを作成する `CREATE TABLE` ステートメントを表示する。

  ```sql
  SHOW CREATE TABLE テーブル名
  ```

## インデックス

### INDEX

- MySQL 8.0から、逆順インデックスがサポートされた。
