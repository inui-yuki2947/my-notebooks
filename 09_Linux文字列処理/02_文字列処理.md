# 文字列処理

## 文字列出力

### echo

- コマンド
  
  | コマンド           | 概要                       |
  | ------------------ | -------------------------- |
  | `echo [文字列...]` | 文字列及び改行を出力する。 |
  
- オプション
  
  |オプション|概要|
  |---|---|
  |`-e`|エスケープシーケンスを解釈する。|
  |`-n`|改行を出力しない。|

### printf

- コマンド

  |コマンド|概要|
  |---|---|
  |`printf 書式文字列 [文字列...]`|文字列を整形して出力する。（改行は出力しない）|

- 書式文字列

  | 書式文字列 | 概要                     |
  | ---------- | ------------------------ |
  | `%s`       | 文字列                   |
  | `%u`       | 10進数の整数（符号なし） |

- オプションとして認識される文字列も、正常に出力できる。

  ```bash
  printf '%s\n' "$1"
  ```

### seq

- コマンド

  |コマンド|概要|
  |---|---|
  |`seq [開始の数 [増分]] 終了の数`|連続する数字を出力する。|

- オプション

  |オプション|概要|
  |---|---|
  |`-w`|ゼロ埋めを行う。|

## 単純文字列加工

### cut

- コマンド

  |コマンド|概要|
  |---|---|
  |`cut ファイル`|各行の指定した部分を切り出す。|

- オプション

  | オプション      | 概要                                                         |
  | --------------- | ------------------------------------------------------------ |
  | `-c 出力リスト` | 切り出し位置のリストを、**文字数**で指定する。               |
  | `-f 出力リスト` | 切り出し位置のリストを、**区切り文字で分けられたフィールド番号**で指定する。 |
  | `-d 区切り文字` | 区切り文字を指定する。（デフォルトはタブ文字）               |

  - 出力リストは、数字をハイフン・カンマつなぎで指定する。（例：`1, 1-10, -10, 10-, 1,2,3`）

### tr

- コマンド

  |コマンド|概要|例|
  |---|---|---|
  |`tr 置換前 置換後`|文字を**一文字ずつ**置換する。|`tr A-Z a-z`|
  |`tr -d 文字`|文字を削除する。||
  |`tr -s 文字`|文字が連続していた場合1つにまとめる。||
  |`tr -ds 文字`|文字が連続していた場合1つにまとめ、文字を削除する。||

- 文字クラス

  | 文字クラス  | 概要     |
  | ----------- | -------- |
  | `[:alpha:]` | 英字     |
  | `[:lower:]` | 英小文字 |
  | `[:upper:]` | 英大文字 |
  | `[:digit:]` | 数字     |
  | `[:alnum:]` | 英数字   |

## 正規表現文字列加工

### grep

- コマンド

  | コマンド                              | 概要                                   |
  | ------------------------------------- | -------------------------------------- |
  | `grep [検索パターン] [ファイル名...]` | 検索パターンにマッチする行を出力する。 |

- 正規表現変更系オプション

  | オプション | 概要                                                |
  | ---------- | --------------------------------------------------- |
  | `-F`       | 正規表現を使わず検索する。（`fgrep`コマンドと同じ） |
  | `-E`       | 拡張正規表現を使用する。（`egrep`コマンドと同じ）   |
  | `-P`       | Perl拡張を行う。（GNU版のみ）                       |

- 表示系オプション

  | オプション            | 概要                                 |
  | --------------------- | ------------------------------------ |
  | `-c, --count`         | マッチした数のみ表示する。           |
  | `-v, --invert-match`  | マッチしなかった結果のみを表示する。 |
  | `-o, --only-matching` | マッチした部分のみを出力する。       |
  | `-q, --quiet`         | 実行結果を画面に表示しない。         |

- ファイル名の表示系オプション

  | オプション                  | 概要                                             |
  | --------------------------- | ------------------------------------------------ |
  | `-H, --with-filename`       | ファイル名を併せて表示する。                     |
  | `-h, --no-filename`         | ファイル名を非表示にする。（複数ファイル指定時） |
  | `-l, --files-with-matches`  | マッチしたファイル名のみを出力する。             |
  | `-L, --files-without-match` | マッチしなかったファイル名のみを出力する。       |

- その他オプション

  | オプション              | 概要                                                         |
  | ----------------------- | ------------------------------------------------------------ |
  | `-e 検索パターン`       | 検索パターンを追加で指定する。                               |
  | `-f, --file ファイル名` | 検索パターンをファイルから読み込む。                         |
  | `-R, -r, --recursive`   | サブディレクトリを再帰的に検索する。                         |
  | `-i, --ignore-case`     | 大文字小文字を区別しない。（デフォルトでは区別する）         |
  | `-a`                    | テキストファイルであることを明示する。<br />（`binary file matches`と言われた場合などに使用する） |

### sed

- コマンド

  |コマンド|概要|
  |---|---|
  |`sed スクリプトコマンド1[;スクリプトコマンド2;...] [ファイル名...]`|入力をなにかしら処理して出力する。|

- オプション

  | オプション                                  | 概要                                                         |
  | ------------------------------------------- | ------------------------------------------------------------ |
  | `-e スクリプトコマンド`                     | スクリプトコマンドを追加で指定する。                         |
  | `-r`（GNU）<br />`-E`（BSD）                | 拡張正規表現を使用する。                                     |
  | `-i[拡張子]`（GNU）<br />`-i 拡張子`（BSD） | 引数の拡張子でバックアップを取り、ファイルの上書きを行う。<br /><https://it-ojisan.tokyo/mac-linux-sed/> |
  | `-n, --quiet, --silent`                     | 出力コマンド以外の出力を行わない。                           |
  | `-z`                                        | 改行コードを操作する。                                       |

### sedスクリプトコマンド

- sedスクリプトコマンド

  ```text
  [アドレス]コマンド
  ```

- アドレス

  | アドレス     | 概要                   | 例    |
  | ------------ | ---------------------- | ----- |
  | `行`         | 指定行                 | `1`   |
  | `行1,行2`    | 行1から行2までの行     | `1,3` |
  | `$`          | 最終行                 |       |
  | `/正規表現/` | 正規表現に当てはまる行 |       |
  | （省略時）   | 全ての行               |       |

- コマンド

  | コマンド                    | 概要                                                         |
  | --------------------------- | ------------------------------------------------------------ |
  | `i 文字列` ※1,2             | 指定した行の**前に**文字列を追加する。                       |
  | `a 文字列` ※1,2             | 指定した行の**後ろに**文字列を追加する。                     |
  | `c 文字列` ※1,2             | 指定した行を**文字列で置換する**。                           |
  | `d`                         | 指定した行を削除する。                                       |
  | `p`                         | 指定した行を出力する。                                       |
  | `=`                         | 指定した行の行番号を出力する。                               |
  | `y/置換前/置換後/` ※3       | 置換前を置換後の**同じ位置の文字**に置換する。               |
  | `s/置換前/置換後/フラグ` ※3 | 置換前を置換後に置換する。<br /> `&`で文字列全体、`\1, \2, ...`で括弧で囲んだ部分の後方参照／後方置換ができる。 <br />最短一致は使えないので、代わりにクラスの否定を使う。 |

  - ※1 BSDでは、文字列を改行して入力する必要がある。
  - ※2 空白から始まる文字列を指定したい場合は、先頭にバッククォートを付ける。
  - ※3 `y, s`の次の任意の文字がデリミタとなる。（例：`s@置換前@置換後@`）
  - コマンド文字列内で変数展開を行う場合、変数内に改行を含むことはできない。（ベタ書きで改行文字を含むことはできる）
    [sedコマンド](https://www.yutry.net/pc/program/sed-shellscript#mulchline-sed-insert)

- フラグ

  | フラグ | 概要                    |
  | ------ | ----------------------- |
  | `g`    | 1行で複数回置換を行う。 |
  | `p`    | 出力を行う。            |

## awk

### 概要

- コマンド

  |コマンド|概要|
  |---|---|
  |`awk 'スクリプト' [ファイル名...]`|指定したファイル（省略時は標準入力）に対して、指定したスクリプトを実行する。|
  |`awk -f スクリプトファイル名 [ファイル名...]`|指定したファイル（省略時は標準入力）に対して、スクリプトファイルの内容えお実行する。|

- オプション

  | オプション      | 概要                                         |
  | --------------- | -------------------------------------------- |
  | `-v 変数名=値`  | 変数を定義し、スクリプト内で使用可能とする。 |
  | `-F 区切り文字` | 区切り文字を指定する。                       |

### スクリプト

- スクリプト

  | スクリプト              | 概要                                               | 例                           |
  | ----------------------- | -------------------------------------------------- | ---------------------------- |
  | `パターン {アクション}` | パターンに当てはまる行について、アクションを行う。 | `$5 >= 1000000 { print $2 }` |
  | `パターン`              | パターンに当てはまる行について、行全体を出力する。 |                              |
  | `{アクション}`          | 全ての行について、アクションを行う。               |                              |
  | `BEGIN {アクション}`    | 処理前にアクションを行う。                         |                              |
  | `END {アクション}`      | 処理後にアクションを行う。                         |                              |

### 変数

- 変数

  | 変数  | 概要                                      | デフォルト値 |
  | ----- | ----------------------------------------- | ------------ |
  | `$0`  | 行全体                                    |              |
  | `$n`  | 行を空白文字で区切ったn番目のフィールド。 |              |
  | `NR`  | 現在処理しているレコード番号（行番号）    |              |
  | `FS`  | 入力時のフィールドの区切り文字            | 半角スペース |
  | `OFS` | 出力時のフィールドの区切り文字            | 半角スペース |

### パターン

- パターン

  | パターン     | 概要                     | 例              |
  | ------------ | ------------------------ | --------------- |
  | `比較式`     | 比較式を評価する。       | `$5 >= 1000000` |
  | `/正規表現/` | 拡張正規表現を評価する。 | `/^l/`          |

- パターンの組み合わせ

  | 書式                   | 概要                       |
  | ---------------------- | -------------------------- |
  | `パターン && パターン` | AND条件で評価する。        |
  | `パターン ｜｜ パターン` | OR条件で評価する。         |
  | `! パターン`           | パターンの否定で評価する。 |

### アクション

- アクション（出力系）

  | アクション           | 概要                                         |
  | -------------------- | -------------------------------------------- |
  | `print`              | 行全体を出力する。                           |
  | `print 値1 値2 ...`  | 値を**直接連結して**出力する。               |
  | `print 値1,値2, ...` | 値を**区切り文字で連結して**出力する。       |
  | `printf "書式", 値`  | 値を書式の通り出力する。（改行は行われない） |

- アクション（制御系）

  | アクション                     | 概要                                         |
  | ------------------------------ | -------------------------------------------- |
  | `if (条件) 処理1 [else 処理2]` | 条件を満たす場合に、処理を実行する。         |
  | `while (条件) 処理`            | 条件を満たす場合に、繰り返し処理を実行する。 |
  | `for (変数名 in 配列名) 処理`  | 配列の要素について、繰り返し処理を実行する。 |

### その他

- awkスクリプトのシバン

  ```text
  #!/usr/bin/awk -f
  ```

## perl

### 概要

- コマンド

  | コマンド                          | 概要                                                         |
  | --------------------------------- | ------------------------------------------------------------ |
  | `perl -e スクリプト [ファイル名]` | 指定したファイル（省略時は標準入力）に対して、Perlスクリプトを実行する。 |

- オプション

  | オプション   | 概要                                                         |
  | ------------ | ------------------------------------------------------------ |
  | `-n`         | 入力の各行に対して、コマンドを実行する。<br />（`while (<>) { スクリプト }`とする） |
  | `-p`         | 入力の各行に対して、コマンドを実行して出力する。<br/>（`while (<>) { スクリプト } continue { print; }`とする） |
  | `-i[拡張子]` | 拡張子を付けたファイルに出力する。                           |
  | `-l`         | 出力後に改行を行う。                                         |
  | `-0`         | 入力レコードの区切り文字を指定する。（未指定時はヌル文字）   |

- [日本語 perl texinfo - Option](https://flex.phys.tohoku.ac.jp/texi/perl/perl_4.html)

- [Perl Lesson 1](https://www.gsid.nagoya-u.ac.jp/ohna/perl_lesson/perl01.html)
- [Perlワンライナー - eオプションの解説 - Perlゼミ|Perlの基礎をインストールからサンプルで丁寧に解説](https://perlzemi.com/blog/20161121147982.html)
- [awkユーザーのためのPerlワンライナー - 忘れないようにメモっとく](https://akiniwa.hatenablog.jp/entry/2014/12/20/194640)
- [マッチした部分文字列の取得 - Perlにおける正規表現](https://www.javadrive.jp/perl/regex/ref/)

### 変数

- 変数

  | 変数     | 概要                                          |
  | -------- | --------------------------------------------- |
  | `$_`     | 最後に読み込んだレコード                      |
  | `$.`     | レコード番号                                  |
  | `$&`     | マッチした文字列全体                          |
  | `` $` `` | マッチした文字列の、前の文字列                |
  | `$'`     | マッチした文字列の、後の文字列                |
  | `$n`     | マッチした文字列の、括弧で囲ったn番目の文字列 |

### 制御構造

- 記法

  | 記法                                   | 概要                                 |
  | -------------------------------------- | ------------------------------------ |
  | `if (条件) {処理}`<br />`処理 if 条件` | 条件を満たす場合に、処理を実行する。 |

### 正規表現

- 式

  | 式                                              | 概要                                                     |
  | ----------------------------------------------- | -------------------------------------------------------- |
  | `変数 =~ /正規表現/`<br />`変数 =~ m/正規表現/` | 変数の文字列が正規表現にマッチしたかを、真偽値で返す。   |
  | `変数 =~ s/置換前/置換後/`                      | 変数の文字列を置換した結果を、変数に代入する。           |
  | `変数 =~ y/置換前/置換後/`                      | 変数の文字列を文字単位で置換した結果を、変数に代入する。 |

- `変数 =~`を省略すると、`$_ =~`となる。

- 改行の扱い

  | モード                     | 概要                                                         |
  | -------------------------- | ------------------------------------------------------------ |
  | デフォルト                 | `^, $`は、文字列全体の開始・終了にマッチする。<br />`.`は、改行文字を除く文字列にマッチする。 |
  | `/m`修飾子（複数行モード） | `^, $`が、各行の開始・終了にもマッチするようになる。         |
  | `/s`修飾子（単一行モード） | `.`が、改行文字を除む文字列にマッチするようになる。          |

- [Perl：正規表現を用いた文字列の検索・置換](https://www.bold.ne.jp/engineer-club/perl-regular-expression)

## jq

### 概要

- コマンド

  | コマンド                    | 概要                       |
  | --------------------------- | -------------------------- |
  | `jq jq表現 [ファイル名...]` | JSON形式文字列を解析する。 |

- オプション

  | オプション | 概要                                     |
  | ---------- | ---------------------------------------- |
  | `-r`       | 両端のダブルクォーテーションを除去する。 |

- [jq Manual (development version)](https://stedolan.github.io/jq/manual/)
- [jq コマンドを使う日常のご紹介 - Qiita](https://qiita.com/takeshinoda@github/items/2dec7a72930ec1f658af)

### jq表現

- jq表現は、JSONで使える表現に加え、後述の特有の表現が使用可能である。

- jq表現

  | jq表現                                 | 概要                                                         |
  | -------------------------------------- | ------------------------------------------------------------ |
  | `.`                                    | ルートの値を出力する。                                       |
  | `オブジェクト.プロパティ名` ※1<br />`オブジェクト.["プロパティ名"]` ※1 | オブジェクトのプロパティの値を出力する。<br />（見つからない場合は`null`）     |
  | `配列.[インデックス]`                 | 配列のインデックス（0始まり）の要素を出力する。<br />（見つからない場合は`null`） |
  | `配列またはオブジェクト[]` ※1           | 配列の全ての要素、またはオブジェクトの全ての値について、別の行で出力する。 |
  | `配列またはオブジェクト[]jq表現` ※1 | 配列の全ての要素、またはオブジェクトの全ての値について、jq表現を実行する。 |
  
  - ※1 末尾に`?`をつけると、プロパティやインデックスが見つからない場合に、エラーを出さないようにできる。

- jq表現（組み合わせ）

  | jq表現               | 概要                                             |
  | -------------------- | ------------------------------------------------ |
  | `jq表現1, jq表現2`   | それぞれのjq表現を、別の行で出力する。           |
  | `jq表現1 ｜ jq表現2` | jq表現1の出力の各行について、jq表現2を実行する。 |

### 型と値

- jq表現

  | jq表現                              | 概要                         |
  | ----------------------------------- | ---------------------------- |
  | `[jq表現, jq表現, ...]`             | 配列形式で出力する。         |
  | `{キー: jq表現, キー: jq表現, ...}` | オブジェクト形式で出力する。 |

### 演算子

- 演算子

  | 演算子         | 概要                                                         | 例                                                           |
  | -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | `to_entries`   | オブジェクトをキーバリュー型の配列に変換して出力する。       | `{"a": 1, "b": 2} | to_entries`<br />-> `[{"key":"a", "value":1}, {"key":"b", "value":2}]` |
  | `from_entries` | キーバリュー型の配列をオブジェクトに変換して出力する。       | `[{"key":"a", "value":1}, {"key":"b", "value":2}] | to_entries`<br />-> `{"a": 1, "b": 2}` |
  | `keys`         | オブジェクトのキーの配列を出力する。                         |                                                              |
  | `length`       | 文字列の長さ、配列の要素数、またはオブジェクトのプロパティ数を出力する。 |                                                              |

### その他

- 演算子

  | 演算子              | 概要                         |
  | ------------------- | ---------------------------- |
  | `jq表現 as $変数名` | jq表現の値を変数に代入する。 |
