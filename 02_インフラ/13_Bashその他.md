# Bashその他

## ライブラリ

### 静的ライブラリと共有ライブラリ

| 項目               | 静的ライブラリ     | 共有ライブラリ              |
| ------------------ | ------------------ | --------------------------- |
| リンク             | スタティックリンク | ダイナミックリンク          |
| 読み込みタイミング | コンパイル時       | 実行時                      |
| 拡張子（Linux）    | .a                 | .so (Shared Object)         |
| 拡張子（Windows）  | .lib               | .dll (Dynamic Link Library) |

### 共有ライブラリの読み込み順

1. 環境変数`LD_LIBRARY_PATH`
1. `/etc/ld.so.cache`ファイル
1. `/lib, /usr/lib`ディレクトリ

### ldd

- `ldd`（list dynamic dependecies）コマンドは、実行ファイルが必要としている共有ライブラリを表示する。

  ```bash
  ldd 実行ファイル（PATHは考慮されない）
  ```

### ldconfig

- `ldconfig`コマンドは、`/etc/ld.so.conf`ファイルをもとに、`/etc/ld.so.cache`ファイルを生成する。

## 実行されるコマンド

### 内部コマンドと外部コマンド

- 内部コマンド（ビルトインコマンド）は、シェル自体に埋め込まれたコマンド。（`cd`や`echo`など）
- 外部コマンドは、独立したプログラムとして存在するコマンド。

### コマンドの優先順位

1. エイリアス
2. 内部コマンド
3. PATH

### PATH

- 環境変数`PATH`は、サブディレクトリは検索されない。

### type

- `type`コマンドは、コマンドがエイリアスなのか内部コマンドなのか等を表示すが分かる。

  ```bash
  type コマンド
  ```

### which

- `which`コマンドで、コマンドがPATHのどこにあるかを表示する。

  ```bash
  which コマンド
  ```

### builtin

- `builtin`コマンドは、内部コマンドから、コマンドを探して実行する。

  ```bash
  builtin コマンド
  ```

### command

- `command`コマンドは、内部コマンドとPATHから、コマンドを探して実行する。

  ```bash
  command コマンド
  ```

### alias

- `alias`コマンドは、コマンドのエイリアス一覧を表示する。

  ```bash
  alias
  ```

### alias エイリアス名=コマンド

- `alias エイリアス名=コマンド`コマンドで、コマンドのエイリアスを登録する。

  ```bash
  alias エイリアス名=コマンド
  ```

### unalias

- `unalias`コマンドで、コマンドのエイリアスを削除する。

  ```bash
  unalias エイリアス名
  ```

## マニュアル

### man

- `man`コマンドは、コマンドやファイルなどのマニュアルを表示する。

  ```bash
  man [セクション] コマンド名やキーワード
  ```

- セクション
  - 1：ユーザーコマンド
  - 5：設定ファイル
  - 8：システム管理コマンド
- `-a`オプションで、全てのセクションを表示する。（未指定時は、最初に見つかったセクションのみ表示する）

### whatis, apropos

- `whatis, apropos`コマンドは、コマンドの簡易的な説明（NAME）を表示する。

  ```bash
  whatis コマンド名キーワード
  ```

- `whatis`コマンドは、コマンド名を検索する。（`man -f`と同じ）
- `apropos`コマンドは、コマンド名または概要を検索する。（`man -k`と同じ）

### help

- `help`コマンドは、内部コマンドのマニュアルを表示する。

  ```bash
  help コマンド
  ```

## 権限

### su

- `su`コマンドは、ユーザーを切り替える。

  ```bash
  su [ユーザー（省略時はroot）]
  ```

- 当コマンド実行後、**切り替え先ユーザー**のパスワードが求められる。
- `-, -l`オプションで、シェルをログインシェルにする。（カレントディレクトリや環境変数を初期化する）

### sudo

- `sudo`コマンドは、rootユーザーの権限でコマンドを実行する。

  ```bash
  sudo [コマンド]
  ```

- 当コマンド実行後、**今のユーザー**のパスワードが求められる。
- `sudo`コマンドを使うと、`/var/log/secure`にログが残る。

### visudo

- `visudo`コマンドで、sudoの権限を管理できる。（`/etc/sudoers`ファイルを安全に編集できる）

### /etc/sudoersファイル

- 書式

  ```text
  誰が どのコンピュータで=(誰として)何を実行する
  ```

- 例

  ```text
  root ALL=(ALL) ALL
  ```

## ユーザー管理

### passwd

- `passwd`コマンドで、ユーザーのパスワードを変更できる。（rootユーザー以外は自分のパスワードに限る）

  ```bash
  passwd [ユーザー名]
  ```

### vipw

- `vipw`コマンドで、ユーザー一覧情報を編集できる。（`/etc/passwd`ファイルを安全に編集できる）

### useradd, userdel, usermod

- `useradd, userdel, usermod`コマンドは、**非対話的に**ユーザーを追加・削除・変更する。

  ```bash
  useradd ユーザー名
  ```

### adduser, deluser

- `adduser, deluser`コマンドは、**対話的に**ユーザーを追加・削除する。

### who

- `who`コマンドは、ログインしているユーザー一覧を表示する。

### w

- `w`コマンドは、ログインしているユーザー一覧と**その実行中プロセス**を表示する。

## コマンド実行

### bash

- `bash`コマンドは、**子プロセス**で、指定したファイルまたは標準入力のコマンドを実行する。

  ```bash
  bash [ファイル（省略時は標準入力）]
  ```

- `-c コマンド文字列`オプションで、文字列をコマンドとして実行する。

### source

- `.`、`source`コマンドは、**カレントシェル**で、指定したファイルにあるコマンドを実行する。

   ```bash
   . ファイル [引数]
   ```

### eval

- `eval`コマンドは、**カレントシェル**で、文字列をコマンドとして実行する。

  ```bash
  eval コマンド文字列
  ```

- 変数にコマンド文字列を代入して実行したい場合や、**パイプやリダイレクトを含む場合**に使用する。（それ以外の場合は、変数をそのまま書いて実行すればよい）
  [技術メモメモ: シェルスクリプトで変数に入れたコマンドを実行する方法の比較(evalコマンドなどの動作比較)](https://tech-mmmm.blogspot.com/2017/11/eval.html)

### exec

- `exec`コマンドは、**現在のプロセス**で、引数で指定したコマンドを実行する。

  ```bash
  exec コマンド 引数1 引数2 ...
  ```

- 引数を渡さずリダイレクトだけ指定することで、現在のプロセスのリダイレクト先を変更できる

  ```bash
  exec > result.txt
  ```

## 端末

### tty

- `tty`コマンドは、**標準入出力**となっている端末デバイスの名前を表示する。
- `/dev/pts/0`は、SSH接続している場合の仮想端末。

### stty

- `stty`コマンドは、端末オプションを表示・編集する。

## その他

### ヌルコマンド

- `:`コマンド（ヌルコマンド）は、何もせず**終了ステータス0**を返す。

### complete

- `complete`コマンドは、任意のコマンドに対して補完の動作を定義する。

### printf

- `printf`コマンドは、入力データを整形して表示する。

  ```bash
  printf 書式文字列 引数1 引数2 ...
  ```

- 書式文字列
  - `%s`は、文字列。
  - `%u`は、10進数の整数（符号なし）。
- `printf`コマンドは、`echo`コマンドと違って、
  - 末尾に改行が追加されない。
  - オプションとして認識される文字列も、正常に出力できる。

    ```bash
    printf '%s\n' "$1"
    ```

### wall

- `wall`コマンドは、ログインしている全てのユーザーの端末に、一斉にメッセージを送信する。
- GNU系

  ```bash
  wall [メッセージ]
  ```

- BSD系

  ```bash
  wall [メッセージのあるファイル]
  ```

### pbcopy, pbpaste

- `pbcopy`コマンドは、標準入力をクリップボードにコピーする。
- `pbpaste`コマンドは、クリップボードを標準出力に出力する。

### date

- `date`コマンドは、現在日時を表示する。

  ```bash
  date
  ```

- `+フォーマット`オプションで、フォーマットを指定できる。
- `YYYY/MM/DD hh:mm:ss`形式で出力したい場合

  ```bash
  date "+%Y/%m/%d %H:%M:%S"
  ```

- `-s, --set 日時`オプションで、日時を変更できる。

### read

- `read`コマンドは、**標準出力から1行分**文字列を読み取って、引数の変数に代入する。
- エスケープ文字をそのまま読み取るために`-r`オプションを指定し、スペースをそのまま読み取るためにIFS変数を空文字にするとよい。

  ```bash
  while IFS= read -r line do
    処理
  done
  ```

### trap

- `trap`コマンドは、送られたシグナルを捕捉して処理を行う。
- 書式

  ```bash
  trap 処理 シグナル名...
  ```

- 例

  ```bash
  trap 'echo message!!' INT
  ```

### getopts

- `getopts`コマンドは、先頭の位置パラメータを解析し、解析結果は引数で指定した変数に出力される。

  ```bash
  getopts 短いオプションとなる文字列 代入先の変数
  ```

### getopt

- `getopt`コマンドは、引数で解析したい文字列を指定し、解析結果は標準出力に出力される。

  ```bash
  getopt 短いオプションとなる文字列 解析したいオプション文字列
  ```

- `getopt`は高機能であるが外部コマンドであるため、環境を選ばず利用したい場合は`getopts`を利用するとよい。
