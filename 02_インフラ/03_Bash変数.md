# Bash変数

## 変数

### シェル変数と環境変数

- シェル変数は、カレントシェル・サブシェルの中で有効である。
- 環境変数は、カレントシェル・サブシェル、及び**子プロセス**で有効である。

### set

- `set`コマンドは、シェル変数及び環境変数の一覧を表示する。

### set（設定変更）

- `set`コマンドでオプションを付与すると、シェルの設定を変更できる。
- シェルの設定を有効にする場合

  ```bash
  set -o オプション
  set -オプション一文字
  ```

- シェルの設定を無効にする場合

  ```bash
  set +o オプション
  set +オプション一文字
  ```

- `-e`オプションで、コマンドが1つでもエラーになったら、直ちにシェルを終了する。
- `-u`オプションで、パラメーター展開中に、設定していない変数があったらエラーとする。
- `-x`オプションで、実際に実行されたコマンドを表示する。
- `-v`オプションで、書いたままのコマンドを表示する。

### set（位置パラメータ変更）

- 書式

  ```bash
  set hoge fuga piyo
  ```

### printenv

- `printenv`コマンドで、環境変数の一覧を確認できる。

### declare, readonly

- `declare`コマンドで、明示的に変数を定義することができる。

  ```bash
  declare 変数名[=値]
  ```

- `-r`オプションで、読み取り専用の変数を定義する。（`readonly`コマンドと同じ）
- `-i`オプションで、整数型の変数を定義する。
  - これで定義した変数は、**代入文の右辺は計算**して代入される。

  ```bash
  $ declare -i sum
  $ sum=2+9
  $ echo $sum
  11
  ```

- `-a`オプションで、配列の変数を定義する。
- `-A`オプションで、連想配列の変数を定義する。

### local

- `local`コマンドで、ローカル変数を定義できる。

  ```bash
  local 変数名=値
  ```

- ローカル変数は、それを定義した関数、及び**その関数から呼び出した関数**で有効である。

### export

- `export`コマンドで、環境変数を定義できる。
- 2行で書く場合

  ```bash
  変数名=値
  export 変数名
  ```

- 1行で書く場合

  ```bash
  export 変数名=値
  ```

- 永続的に環境変数を追加する場合は、`bash_profile`にexport文（下記など）を追加する。

  ```bash
  export PATH=$PATH:追加するPATH
  ```

### env

- `env`コマンドで、その1回のプロセスだけで有効な環境変数を定義できる。

  ```bash
  [env] 環境変数=値 コマンド
  ```

### unset

- `unset`コマンドは、変数や関数を削除する。

## 配列

### 作成

- 配列の作成

  ```bash
  変数名=(値1 値2 ...)
  ```

- 配列要素の代入

  ```bash  
  変数名[インデックス]=値
  ```

### 取得

- `${変数名[インデックス]}`で、要素を取得する。
- `${変数名[@]}`で、すべての要素を取得する。
- `${#変数名[@]}`で、要素数を取得する。
- `${!変数名[@]}`で、インデックス一覧を取得する。

### 連想配列

- 連想配列の作成

  ```bash
  変数名=([キー1]=値1 [キー2]=値2 ...)
  ```

- 連想配列要素の代入

  ```bash  
  変数名[キー]=値
  ```

## 定義済み変数

### 環境変数

- `$IFS`は、「Internal Filed Separator」の略で、シェルの**区切り文字**のこと。
  - デフォルトでは、半角スペース・タブ・改行文字が設定されている。
  - fileコマンドの結果など、半角文字を含む文字列を分割したくない場合は、readコマンドで1行ずつ処理するというテクニックがある。
- `$RANDOM`で、0から32767の範囲でランダムな数値を取得できる。
- `$FUNCNAME`で、関数名を取得できる。

### 特殊変数

- `$0`は、起動したシェルスクリプトの名前。
- `$1`、`$2`のような形で、実行時に指定された引数を**それぞれ**参照できる。
  - 10個目以降は`${10}`のように記述する必要がある。
- `$#`は、実行時に指定された引数の数。
- `$@`または`$*`は、位置パラメータを先頭から末尾まで並べた文字列。
  - `$*`は区切り文字で連結した文字列となるため、あまり使うことはない。
- `$$`は、現在のシェルのプロセスID。
- `$!`は、バックグラウンドで実行した直前のプロセスID。
- `$?`は、直前に実行したコマンドの終了ステータス（成功時は`0`、失敗時は`1~255`）。
