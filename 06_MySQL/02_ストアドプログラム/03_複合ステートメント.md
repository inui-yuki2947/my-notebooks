# MySQL/ストアドプログラム/複合ステートメント

## 共通

### 概要

- 複合ステートメント構文は、ストアドプロシージャ、ストアドファンクション、トリガー、およびイベント内で使用する。

- 記法

  ```sql
  BEGIN
      ステートメント
      ステートメント
      ...
  END
  ```

### DELIMITER

- `DELIMITER`コマンドは、SQLの区切り文字を変更する。

  ```sql
  DELIMITER 区切り文字
  ```

- `//`を区切り文字として使うことが多い。

- 例

  ```mysql
  DELIMITER //
  ...
  BEGIN
      ステートメント
      ステートメント
      ...
  END
  ...//
  DELIMITER ;
  ```

## 条件分岐

### IF

- 記法

  ```sql
  IF 条件 THEN ステートメント
  [ELSEIF 条件 THEN ステートメント] ...
  [ELSE ステートメント]
  END IF
  ```

### CASE

- 記法

  ```sql
  CASE 判断値
      WHEN 値 THEN ステートメント
      WHEN 値 THEN ステートメント
      ...
      ELSE ステートメント
  END CASE
  ```

## 繰り返し

### LOOP

- 記法

  ```sql
  LOOP
      ステートメント
  END LOOP
  ```

### WHILE

- 記法

  ```sql
  WHILE 継続条件 DO
      ステートメント
  END WHILE
  ```

### REPEAT

- 記法

  ```sql
  REPEAT
      ステートメント
  UNTIL 終了条件 END REPEAT
  ```

### ラベル

- `LOOP`, `WHILE`, `REPEAT`文には、開始・終了ラベルを付与できる。

  ```sql
  ラベル: LOOP
      ステートメント
  END LOOP ラベル
  ```

### ITERATE, LEAVE, RETURN

- `ITERATE`文は、指定したラベルのループを再び開始する。

  ```sql
  ITERATE ラベル
  ```

- `LEAVE`文は、特定のラベルを持つフロー制御構文を終了する。（最も外側の場合は、プログラムを終了する）

  ```sql
  LEAVE ラベル
  ```

- `RETURN`文は、ストアドファンクションの実行を終了し、戻り値を返す。

  ```sql
  RETURN 値
  ```

## カーソル

### DECLARE

- 記法

| 記法                                       | 概要                                       |
| ------------------------------------------ | ------------------------------------------ |
| `DECLARE カーソル名 CURSOR FOR セレクト文` | カーソルを宣言し、セレクト文と関連付ける。 |

### OPEN, CLOSE

- 記法

| 記法               | 概要               |
| ------------------ | ------------------ |
| `OPEN カーソル名`  | カーソルを開く。   |
| `CLOSE カーソル名` | カーソルを閉じる。 |

### FETCH

- 記法

| 記法                              | 概要                                                         |
| --------------------------------- | ------------------------------------------------------------ |
| `FETCH カーソル名 INTO 変数名...` | 開いているカーソルを次の行に進め、値を変数に代入する。<br />（変数の数は、セレクトするカラムの数と一致する必要がある） |
