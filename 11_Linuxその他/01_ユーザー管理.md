# ユーザー管理

## 共通

### /etc/passwd

- `/etc/passwd`ファイルには、ユーザー情報が記述される。

- 書式

  ```text
  ユーザー名:パスワード:UID:プライマリグループID:コメント:ホームディレクトリ:ログインシェル
  ```

- 例

  ```text
  user01:x:500:500::/home/user01:/bin/bash
  ```

- UIDは、rootユーザーは`0`、一般ユーザーは`1000`以降の番号となる。

### /etc/shadow

- `/etc/shadow`ファイルには、ユーザーのシャドウパスワードが記述される。
- rootユーザーのみ読み取りできる。

### /etc/group

- `/etc/group`ファイルには、グループ情報が保存される。

- 書式

  ```text
  グループ名:グループパスワード:GID:グループメンバー
  ```

- 例

  ```text
  hoge_group:x:501:hoge_user3,hoge_user2
  ```

### vipw

- `vipw`コマンドで、ユーザー一覧情報を編集できる。（`/etc/passwd`ファイルを安全に編集できる）

  ```bash
  vipw
  ```

## 表示

### whoami

- `whoami`コマンドは、自分のユーザー名を表示する。

  ```bash
  whoami
  ```

### groups

- `groups`コマンドは、自分が所属するグループ一覧を表示する。

  ```bash
  groups
  ```

### id

- `id`コマンドは、ユーザーが属しているグループを表示する。

  ```bash
  id [ユーザー名（省略時は実効ユーザー）]
  ```

### who

- `who`コマンドは、ログインしているユーザーの**ログイン名**、使用している端末、ログイン時刻、どこからログインしているかを表示する。

  ```bash
  who
  ```

- `-m`オプションまたは`who am i`コマンドで、標準入力に関連付けられたユーザーのみを表示する。

### w

- `w`コマンドは、ログインしているユーザー一覧と**その実行中プロセス**を表示する。

  ```bash
  w [ユーザー名]
  ```

### getent

- **LDAP（Lightweight Directory Access Protocol）**とは、ディレクトリサービスへ接続するためのプロトコルである。

- LDAPを使用している場合は、`getent`コマンドでユーザー・グループ情報を表示する。

  ```bash
  getent 対象
  ```

## ログイン履歴

### last

- `last`コマンドは、システムのログイン履歴の一覧を表示する。

  ```bash
  last [ユーザー名]
  ```

### lastb

- `lastb`コマンドは、システムのログインエラー履歴の一覧を表示する。

  ```bash
  lastb [ユーザー名]
  ```

### lastlog

- `lastlog`コマンドは、ユーザーごとの最終ログイン情報を表示する。

  ```bash
  lastlog
  ```

## パスワード

### passwd

- `passwd`コマンドで、自身のパスワードを変更できる。

  ```bash
  passwd
  ```

- rootユーザーは、任意のユーザーのパスワードを変更できる。

  ```bash
  passwd ユーザー名
  ```

### chage

- `chsge`コマンドは、パスワード有効期限の管理を行う。

  ```bash
  chage
  ```

- パスワード有効期限の情報は、`/etc/shadow`ファイルに格納される。

## ユーザー編集

### useradd

- `useradd`コマンドは、ユーザーを作成する。

  ```bash
  useradd ユーザー名
  ```

- オプション
  - `-g グループ名|GID`で、プライマリグループを指定する。
  - `-G グループ名|GID`で、プライマリグループ以外に所属するグループを指定する。
  - `-c コメント`で、コメントを指定する。
  - `-d パス`で、ホームディレクトリを指定する。
  - `-s パス`で、デフォルトシェルを指定する。
- ホームディレクトリのデフォルトファイルは、`/etc/skel`ディレクトリに配置する。

### usermod

- `usermod`コマンドは、ユーザーを編集する。

  ```bash
  usermod ユーザー名
  ```

- `-L|--lock`オプションで、パスワードをロックする。

- `-U|--unlock`オプションで、パスワードのロックを解除する。

### userdel

- `userdel`コマンドは、ユーザーを削除する。

  ```bash
  userdel ユーザー名
  ```

- `-r`オプションで、ホームディレクトリも削除する。

### adduser, deluser

- `adduser, deluser`コマンドは、**対話的に**ユーザーを追加・削除する。

### ログインの禁止

- `/etc/nologin`ファイルを作成すると、rootユーザー以外のログインが禁止される。
  - 同ファイルにメッセージを記述すると、ログインしようとした際にそれが表示される。
- ユーザーのログインシェルを`/bin/false`や`/sbin/nologin`にすると、ログインを禁止できる。
  - `/bin/false`は、ログを出さずにログインを拒否する。
  - `/sbin/nologin`は、ログを出してログインを拒否する。

## グループ編集

### groupadd

- `groupadd`コマンドは、グループを作成する。

  ```bash
  groupadd グループ名
  ```

### groupmod

- `groupmod`コマンドは、グループを編集する。

  ```bash
  groupmod グループ名
  ```

- `-n グループ名`オプションで、グループ名を変更する。

### groupdel

- `groupdel`コマンドは、グループを削除する。

  ```bash
  groupdel グループ名
  ```

## ユーザー切り替え

### su

- `su`コマンドは、ユーザーを切り替える。

  ```bash
  su [ユーザー（省略時はroot）]
  ```

- 当コマンド実行後、**切り替え先ユーザー**のパスワードが求められる。
- `exit`コマンドで、元のユーザーに戻ることができる。
- `-, -l`オプションで、シェルをログインシェルにする。（カレントディレクトリや環境変数を初期化する）

### sudo

- `sudo`コマンドは、rootユーザーの権限でコマンドを実行する。

  ```bash
  sudo [コマンド]
  ```

- 当コマンド実行後、**今のユーザー**のパスワードが求められる。
- `sudo`コマンドを使うと、`/var/log/secure`にログが残る。
- `-l`オプションで、自分に許可されているコマンド一覧を表示する。

### visudo

- `visudo`コマンドで、sudoの権限を管理できる。（`/etc/sudoers`ファイルを安全に編集できる）

### /etc/sudoersファイル

- 書式

  ```text
  ユーザー名 ホスト名=(実行ユーザー名) [NOPASSWORD:] コマンド
  ```

- 例

  ```text
  student ALL=(ALL) /sbin/shutdown
  ```

- `NOPASSWORD:`を指定すると、実行時にパスワードを問われない。
