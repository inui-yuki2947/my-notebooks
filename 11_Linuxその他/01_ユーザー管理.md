# ユーザー管理

## 一覧表示

### who

- `who`コマンドは、ログインしているユーザーの**ログイン名**、使用している端末、ログイン時刻、どこからログインしているかを表示する。

  ```bash
  who
  ```

- `-m`オプションまたは`who am i`コマンドで、標準入力に関連付けられたユーザーのみを表示する。

### w

- `w`コマンドは、ログインしているユーザー一覧と**その実行中プロセス**を表示する。

  ```bash
  w [ユーザー名]
  ```

### getent

- **LDAP（Lightweight Directory Access Protocol）**とは、ディレクトリサービスへ接続するためのプロトコルである。

- LDAPを使用している場合は、`getent`コマンドでユーザー・グループ情報を表示する。

  ```bash
  getent 対象
  ```

## 表示

### id

- `id`コマンドは、ユーザーのUIDや所属グループを表示する。

  ```bash
  id [ユーザー名（省略時は実効ユーザー）]
  ```

- `-u`オプションで、UIDのみ表示する。

- `-g`オプションで、プライマリーグループのみ表示する。

- `-G`オプションで、全所属グループのみ表示する。

### whoami

- `whoami`コマンドは、自分のユーザー名を表示する。

  ```bash
  whoami
  ```

### groups

- `groups`コマンドは、自分が所属するグループ一覧を表示する。

  ```bash
  groups
  ```

## ログイン履歴

### last

- `last`コマンドは、システムのログイン履歴の一覧を表示する。

  ```bash
  last [ユーザー名]
  ```

### lastb

- `lastb`コマンドは、システムのログインエラー履歴の一覧を表示する。

  ```bash
  lastb [ユーザー名]
  ```

### lastlog

- `lastlog`コマンドは、ユーザーごとの最終ログイン情報を表示する。

  ```bash
  lastlog
  ```

## ユーザー編集

### /etc/passwd

- `/etc/passwd`ファイルには、ユーザー情報が記述される。

  ```text
  ユーザー名:パスワード:UID:プライマリグループID:コメント:ホームディレクトリ:ログインシェル
  ```

- 例

  ```text
  user01:x:500:500::/home/user01:/bin/bash
  ```

- UIDは、rootユーザーは`0`、一般ユーザーは`1000`以降の番号となる。

- `vipw`コマンドは、`/etc/passwd`ファイルを安全に編集する。

  ```bash
  vipw
  ```

### useradd

- `useradd`コマンドは、ユーザーを作成する。

  ```bash
  useradd ユーザー名
  ```

- オプション
  - `-g グループ名|GID`で、プライマリグループを指定する。
  - `-G グループ名|GID`で、プライマリグループ以外に所属するグループを指定する。
  - `-c コメント`で、コメントを指定する。
  - `-d パス`で、ホームディレクトリを指定する。
  - `-s パス`で、デフォルトシェルを指定する。
- ホームディレクトリのデフォルトファイルは、`/etc/skel`ディレクトリに配置する。

### usermod

- `usermod`コマンドは、ユーザーを編集する。

  ```bash
  usermod ユーザー名
  ```

- `-L|--lock`オプションで、パスワードをロックする。

- `-U|--unlock`オプションで、パスワードのロックを解除する。

### userdel

- `userdel`コマンドは、ユーザーを削除する。

  ```bash
  userdel ユーザー名
  ```

- `-r`オプションで、ホームディレクトリも削除する。

### adduser, deluser

- `adduser, deluser`コマンドは、**対話的に**ユーザーを追加・削除する。

### ログインの禁止

- `/etc/nologin`ファイルを作成すると、rootユーザー以外のログインが禁止される。
  - 同ファイルにメッセージを記述すると、ログインしようとした際にそれが表示される。
- ユーザーのログインシェルを`/bin/false`や`/sbin/nologin`にすると、ログインを禁止できる。
  - `/bin/false`は、ログを出さずにログインを拒否する。
  - `/sbin/nologin`は、ログを出してログインを拒否する。

## グループ編集

### /etc/group

- `/etc/group`ファイルには、グループ情報が保存される。

- 書式

  ```text
  グループ名:グループパスワード:GID:サブグループとして属するメンバー
  ```

- 例

  ```text
  hoge_group:x:501:hoge_user3,hoge_user2
  ```

### groupadd

- `groupadd`コマンドは、グループを作成する。

  ```bash
  groupadd グループ名
  ```

### groupmod

- `groupmod`コマンドは、グループを編集する。

  ```bash
  groupmod グループ名
  ```

- `-n グループ名`オプションで、グループ名を変更する。

### groupdel

- `groupdel`コマンドは、グループを削除する。

  ```bash
  groupdel グループ名
  ```

## パスワード

### /etc/shadow, /etc/gshadow

- `/etc/shadow`ファイルには、ユーザーのシャドウパスワードが記述される。
- `/etc/gshadow`ファイルには、グループのシャドウパスワードが記述される。
- rootユーザーのみ読み取りできる。

### passwd

- `passwd`コマンドは、自身のパスワードを変更する。

  ```bash
  passwd
  ```

- rootユーザーは、任意のユーザーのパスワードを変更できる。

  ```bash
  passwd ユーザー名
  ```

### gpasswd

- `gpasswd`コマンドは、グループのパスワードを変更する。

  ```bash
  gpasswd グループ名
  ```

### chage

- `chage`コマンドは、パスワード有効期限の管理を行う。

  ```bash
  chage ユーザー名
  ```

- パスワード有効期限の情報は、`/etc/shadow`ファイルに格納される。

- `-l, --list`オプションで、現在の状態を表示する。

- `-d, --lastday 日付`オプションで、パスワードの最終更新日を変更できる。

- `-E, --expiredate 日付`オプションで、パスワードが無効になる日付を変更できる。

- `-m, --mindays 日数`オプションで、パスワード変更間隔の最短日数を変更できる。

- `-M, --maxdays 日数`オプションで、パスワードが有効な最長日数を変更できる。
