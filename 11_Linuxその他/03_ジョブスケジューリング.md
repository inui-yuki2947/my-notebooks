# ジョブスケジューリング

## 共通

### アクセス制御

- `/etc/cron.allow`, `/etc/cron.deny`ファイルには、cronの利用を許可・拒否するユーザーを記述する。
- `/etc/at.allow`, `/etc/at.deny`ファイルには、atの利用を許可・拒否するユーザーを記述する。
- `allow`ファイル、`deny`ファイルの順で、どちらかのファイルのみが適用される。
  両方が存在しない場合は、rootユーザーのみが実行可能となる。

## cron

### crontab

- `crontab`コマンドは、定期的に実行するジョブを管理する。（crontabファイルを管理する）

  ```bash
  crontab
  ```

- `-l`オプションで、crontabファイルを表示する。

- `-e`オプションで、crontabファイルを編集する。

- `-r`オプションで、crontabファイルを削除する。

- `-u ユーザー名`オプションで、編集するユーザーを指定できる。（rootユーザーのみ）

### crontabファイル

- `/etc/crontab`ファイルは、システム用のcrontabファイルであり、以下のファイルを呼び出す。

  - `/etc/cron.d/`
  - `/etc/cron.hourly/`
  - `/etc/cron.daily/`
  - `/etc/cron.weekly/`
  - `/etc/cron.monthly/`

- `/var/spool/cron`ディレクトリ以下に、ユーザーのcrontabファイルが格納される。

- 書式

  ```text
  分 時 日 月 曜日 コマンド
  ```

- スケジュールの指定

  - `*`で、すべての値にマッチする。
  - カンマ区切りで、複数の値を指定できる。
  - `*/数値`で、数値の間隔で実行させる。（例：分を`*/10`とすると、10分間隔となる）

- 例

  ```text
  00,30 */2 * * * /usr/local/bin/backup
  ```

## at

### 概要

- `at`コマンドは、1回限りで実行するジョブを対話的に管理する。

  ```bash
  at 日時
  ```

- 日時形式例
  - `22:00`
  - `10pm`
  - `noon`
  - `now + 3 days`
- オプション
  - `-f ファイル名`オプションで、実行するコマンドを記述したファイルを読み込む。
  - `-l`オプションで、予約中のジョブの一覧を表示する。（`atq`コマンドと同じ）
  - `-d|-r ジョブ番号`オプションで、予約中のジョブを削除する。（`atrm`コマンドと同じ）
- [Macでatコマンドが実行できないときの対処法 - Qiita](https://qiita.com/shge/items/6c43947a77abd9d2d1b2)

## systemdによるスケジューリング

### 概要

- systemdのタイマーUnitを使うことでも、スケジューリングを設定できる。
- 種類
  - モノトニックタイマーは、cronに相当。
  - リアルタイムタイマーは、atに相当。
- `systemd-run`コマンドで、スケジュールを予約できる。
