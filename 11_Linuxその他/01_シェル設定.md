# シェル設定

## 基本設定

### 起動前後の設定

- ファイル

  ファイル|読み込みタイミング|用途
  ---|---|---
  `/etc/profile`|ログイン時|基本的な環境変数の設定
  `/etc/bashrc`（RedHat系）<br>`/etc/bash.bashrc`（Debian系）|対話的シェル起動時|
  `~/.bash_profile`<br>`~/.bash_login`<br>`~/.profile`|ログイン時|環境変数の設定
  `~/.bashrc`|対話的シェル起動時|エイリアスの設定、bashオプションの設定
  `~/.bash_logout`|ログアウト時|

- Linuxディストリビューションによって、読み込まれ方は異なる。
- `~/.bash_profile`から`~/.bash_rc`を読み込むよう記述することもある。

  ```bash
  [ -f ~/.bashrc ] && . ~/.bashrc
  ```

- [【初心者向け】エイリアスの設定方法 - Qiita](https://qiita.com/yutat93/items/b5bb9c0366f21bcbea62)
- [本当に正しい .bashrc と .bash_profile の使ひ分け - Qiita](https://qiita.com/magicant/items/d3bb7ea1192e63fba850)
- [bashの.profileや.bashrc等を実行する動作仕様 - sgryjp.log](https://blog.sgry.jp/entry/2019/11/09/232927)

### プロンプト

- 環境変数

| 環境変数         | 概要                                          | デフォルト値 |
| ---------------- | --------------------------------------------- | ------------ |
| `PS1`            | プロンプト                                    | `\h:\W \u\$` |
| `PS2`            | セカンダリプロンプト（2行目以降のプロンプト） |              |
| `PROMPT_COMMAND` | プロンプトを出す前に実行するコマンド          |              |

- プロンプトで使える表現

| 書式           | 概要                                                         | 例                           |
| -------------- | ------------------------------------------------------------ | ---------------------------- |
| `\h`           | ホスト名を出力する。                                         |                              |
| `\u`           | ユーザー名を出力する。                                       |                              |
| `\w`           | カレントディレクトリのフルパスを出力する。                   |                              |
| `\W`           | カレントディレクトリ名を出力する。                           |                              |
| `\$`           | 一般ユーザーの場合は `$`、rootユーザーの場合は `#` を出力する。 |                              |
| `\[制御文字\]` | 制御文字を使用する。                                         | `\[\e[1;33m\]文字列\[\e[m\]` |
| `$(コマンド)`  | コマンドの結果を出力する。                                   |                              |

- プロンプトで使える表現（日時系）

| 書式               | 概要                                         |
| ------------------ | -------------------------------------------- |
| `\t`               | 現在時刻を、12時間形式で出力する。           |
| `\T`               | 現在時刻を、24時間形式で出力する。           |
| `\d`               | 現在日付を出力する。                         |
| `\D{フォーマット}` | 現在日時を、指定したフォーマットで出力する。 |

- [ターミナルプロンプトの表示・色の変更 - Qiita](https://qiita.com/hmmrjn/items/60d2a64c9e5bf7c0fe60)

## シェルオプション

### 共通

- コマンド

| コマンド | 概要                                           | 使用される環境変数 |
| -------- | ---------------------------------------------- | ------------------ |
| `set`    | `set`用のシェルオプションを管理する。          | `SHELLOPTS`        |
| `shopt`  | `set`, `shopt`用のシェルオプションを管理する。 | `BASHOPTS`         |

### set

- コマンド

| コマンド                                                     | 概要                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| `set -o`                                                     | 現在のシェルオプションの設定を表示する。                     |
| `set +o`                                                     | 現在のシェルオプションの設定にするためのコマンドを表示する。 |
| `set -ショートオプション`<br />`set -o ロングオプション` | シェルオプションを有効にする。                               |
| `set +ショートオプション`<br />`set +o ロングオプション` | シェルオプションを無効にする。                               |
| `bash -ショートオプション [ファイル名]`<br />`bash -o ロングオプション [ファイル名]` | シェルオプションを有効にしてスクリプトを実行する。           |
| `bash +ショートオプション [ファイル名]`<br />`bash +o ロングオプション [ファイル名]` | シェルオプションを無効にしてスクリプトを実行する。           |

- シェルオプション

| ショートオプション | ロングオプション | 概要                                                         |
| ------------------ | ---------------- | ------------------------------------------------------------ |
| `a`                | `allexport`      | シェル変数・関数の定義と同時に`export`する。                 |
| `n`                | `noexec`         | コマンドを読み込むだけで実行しない。                         |
| `e`                | `errexit`        | コマンドが1つでもエラーになったら、直ちにシェルを終了する。  |
| `u`                | `nounset`        | パラメーター展開中に、設定していない変数があったらエラーとする。 |
| `c`                | `noclobber`      | リダイレクトで既存のファイルを上書きしない。                 |
| `x`                | `xtrace`         | 実際に実行されたコマンドを表示する。                         |
| `v`                | `verbose`        | 書いたままのコマンドを表示する。                             |

- シェルオプション`x`とヌルコマンドを組み合わせて、デバッグメッセージを出力するテクニックがある。
  （当該コマンドで終了ステータスが変わることに注意）

  ```bash
  : デバッグ出力したい内容
  ```

### shopt

- コマンド

| コマンド                      | 概要                                   |
| ----------------------------- | -------------------------------------- |
| `shopt`                      | シェルオプションの一覧を表示する。     |
| `shopt シェルオプション名`    | 指定したシェルオプションを表示する。   |
| `shopt -s`                    | 有効なシェルオプションのみ表示する。   |
| `shopt -u`                    | 無効なシェルオプションのみ表示する。   |
| `shopt -s シェルオプション名` | 指定したシェルオプションを有効にする。 |
| `shopt -u シェルオプション名` | 指定したシェルオプションを無効にする。 |

- オプション

| オプション | 概要                                            |
| ---------- | ----------------------------------------------- |
| `-o`       | `set`コマンドで使用するオプションについて扱う。 |

- シェルオプション

| シェルオプション | 概要                                 |
| ---------------- | ------------------------------------ |
| `globstar`       | パス名展開で、`**`を使用可能にする。 |
