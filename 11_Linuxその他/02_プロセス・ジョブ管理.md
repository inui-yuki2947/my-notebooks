# プロセス・ジョブ管理

## プロセス表示

### ps, pstree, top

- コマンド

  |コマンド|概要|
  |---|---|
  |`ps`|現在動作しているプロセスを表示する。|
  |`pstree [プロセスIDまたはユーザー名]`|現在動作しているプロセスについて、階層構造を分かりやすく表示する。<br />（`ps f`コマンドと同じ）|
  |`top`|現在実行中のプロセスを継続的に表示する。|

- オプション（`ps`）

  | オプション | 概要                                               |
  | ---------- | -------------------------------------------------- |
  | `a`        | 全てのユーザーのプロセスを表示する。               |
  | `x`        | 実行端末のないプロセスを表示する。                 |
  | `-e`       | 全てのプロセスを表示する。（`ax`オプションと同じ） |
  | `u`        | 実行ユーザー名などを表示する。                     |
  | `l, -l`    | 親プロセスのPID（PPID）やナイス値も表示する。      |
  | `f`        | 階層構造を分かりやすく表示する。                   |

- プロセスは、PID、及びプロセスを開始したユーザーから引き継がれたUIDとGIDを持つ。

### pgrep

- コマンド

  | コマンド           | 概要                                        |
  | ------------------ | ------------------------------------------- |
  | `pgrep プロセス名` | 指定したプロセス名に対応するPIDを表示する。 |

### lsof

- コマンド

  |コマンド|概要|
  |---|---|
  |`lsof [パス名]`|**現在開いているファイル一覧**を表示する。|

- オプション

  | オプション       | 概要                               |
  | ---------------- | ---------------------------------- |
  | `-i :ポート番号` | ポート番号やプロトコルを指定する。 |
  | `-p プロセスID`  | プロセスIDを指定する。             |
  | `-P`             | ポート番号を数字で表示する。       |

- 例（接続を受け付けているポートに絞り込む場合）

  ```bash
  lsof -p プロセスID | grep LISTEN
  ```

### fuser

- コマンド

  |コマンド|概要|
  |---|---|
  |`fuser 名前...`|ファイルやソケットを使用しているプロセスを表示する。|

- オプション

  | オプション                 | 概要                                         |
  | -------------------------- | -------------------------------------------- |
  | `-n, --namespace 名前空間` | `file, udp, tcp`といった名前空間を指定する。 |
  | `-u`                       | ユーザー名を表示する。                       |
  | `-k`                       | プロセスにシグナル`KILL`を送る。             |

## シグナル処理

### シグナル

- 一覧

  | シグナルID | シグナル名 | 意味                                 |
  | ---------- | ---------- | ------------------------------------ |
  | `1`        | `HUP`      | ハングアップ                         |
  | `2`        | `INT`      | 割り込みによる終了（Ctrl + Cと同じ） |
  | `9`        | `KILL`     | 強制終了                             |
  | `15`       | `TERM`     | 終了                                 |

### kill, killall, pkill

- コマンド

  | コマンド                                     | 概要                                                         |
  | -------------------------------------------- | ------------------------------------------------------------ |
  | `kill プロセスID`                            | 指定した**プロセスID**のプロセスに、シグナルを送る。         |
  | `killall プロセス名`<br />`pkill プロセス名` | 指定した**プロセス名（コマンド）**のプロセスに、シグナルを送る。 |

- オプション

  | オプション                     | 概要                                                         |
  | ------------------------------ | ------------------------------------------------------------ |
  | `-l`                           | シグナル一覧を表示する。                                     |
  | `-シグナル`<br />`-s シグナル` | シグナルを指定する。（デフォルトは`TERM`）<br />シグナルは、`シグナルID`, `シグナル名`, `SIGシグナル名`のいずれかで指定する。 |

- 一般ユーザーは、自身が実行したプロセスのみ終了できる。

### trap

- コマンド

  | コマンド                  | 概要                                   | 例                          |
  | ------------------------- | -------------------------------------- | --------------------------- |
  | `trap 処理 シグナル名...` | 送られたシグナルを捕捉して処理を行う。 | `trap 'echo message!!' INT` |

## ジョブ管理

### &, nohup

- コマンド

  | コマンド                | 概要                                                         |
  | ----------------------- | ------------------------------------------------------------ |
  | `コマンド &`            | バックグラウンドでコマンドを実行する。                       |
  | `コマンド1 & コマンド2` | バックグラウンドでコマンド1, 2を実行する。                   |
  | `nohup コマンド &`      | 仮想端末を閉じたりログアウトしたりしても、バックグラウンドでコマンドを実行する。 |

### jobs

- コマンド

  |コマンド|概要|
  |---|---|
  |`jobs [ジョブ番号]`|現在ユーザが設定した**ジョブ一覧**を表示する。|

- 表示内容
  - `+`は、現在実行中のプロセスを表す。
  - `-`は、直前に実行されたプロセスを表す。

### fg, bg

- コマンド

  | コマンド        | 概要                                                         |
  | --------------- | ------------------------------------------------------------ |
  | `fg ジョブ番号` | バックグランドジョブを、フォアグランドジョブに切り替える。   |
  | `bg ジョブ番号` | 一時停止しているジョブを、バックグランドジョブとして再開する。 |

## システム状況管理

### free

- コマンド

  |コマンド|概要|
  |---|---|
  |`free`|メモリの利用状況、空き状況を表示する。|
  
- オプション

  |オプション|概要|
  |---|---|
  |`-m`|MB単位で表示する。|

### uptime

- コマンド

  | コマンド | 概要                                     |
  | -------- | ---------------------------------------- |
  | `uptime` | システムの稼働時間や平均負荷を表示する。 |

### watch

- コマンド

  |コマンド|概要|
  |---|---|
  |`watch コマンド`|コマンドを一定時間ごとに実行する。|

## 優先度管理

### 共通

- ナイス値は`-20`から`19`まであり、その値が大きいほどプロセスの優先度が低くなる。
  （他のプロセスに対してナイスである）
  
- rootユーザーのみ、ナイス値に負数を指定できる。

### nice

- コマンド

  | コマンド        | 概要                                   |
  | --------------- | -------------------------------------- |
  | `nice コマンド` | ナイス値を指定してコマンドを実行する。 |
  
- オプション

  |オプション|概要|
  |---|---|
  |`-n ナイス値`<br />`-ナイス値`|ナイス値を指定する。<br />（指定しなかった場合は`+10`となる）|

### renice

- コマンド

  | コマンド                               | 概要                                 |
  | -------------------------------------- | ------------------------------------ |
  | `renice [-n] ナイス値 [-p] プロセスID` | 実行中プロセスのナイス値を変更する。 |
