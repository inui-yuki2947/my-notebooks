# Ruby

## CLI

### ruby

- `ruby`コマンドは、rubyファイルを実行する。

  ```bash
  ruby [ファイル名] [引数]
  ```

### irb

- `irb`コマンドは、対話的にrubyを実行する。

  ```ruby
  irb
  ```

## 条件判断

### if, unless

- 書式（複数行）

  ```ruby
  if|unless 条件1 [then]
    処理1
  elsif 条件2 [then]
    処理2
  else
    処理3
  end
  ```

- 書式（1行）

  ```ruby
  処理 if|unless 条件
  ```

### case

- 書式

  ```ruby
  case 比較したいオブジェクト
  when 値1 [then]
    処理1
  ...
  else 
    処理n
  end
  ```

- `case`文は、`===`演算子（`==`より判定が緩い演算子）で比較を行う。

## 繰り返し

### while, until

- 書式

  ```ruby
  while|until 条件 [do]
    処理
  end
  ```

### loop

- 書式

  ```ruby
  loop [do]
    処理
  end
  ```

### times

- 書式

  ```ruby
  繰り返す回数.times do
    処理
  end
  ```

### for, each

- 書式（for）

  ```ruby
  for 変数 in オブジェクト [do]
    処理
  end
  ```

- 書式（each）

  ```ruby
  オブジェクト.each do |変数|
    処理
  end
  ```

- `開始..終了`で、範囲を表すオブジェクトを生成する。

## 配列

### 取得

- `配列.size`で配列の大きさを取得できる。

### 繰り返し

- 書式

  ```ruby
  配列.each do |変数|
    処理
  end
  ```

## ハッシュ

### 生成

- 通常の書式

  ```ruby
  {キー:> 値, ...}
  ```

- ハッシュを用いる場合の書式

  ```ruby
  {シンボル名: 値}
  ```

### 取得

- 書式

  ```ruby
  ハッシュ名[キー]
  ```

### 繰り返し

- 書式

  ```ruby
  ハッシュ.each do |キーの変数, 値の変数|
    処理
  end
  ```

## 変数・定数

### 定数

- 名前の先頭が**大文字**から始まるものは定数となる。
- 定数に再代入を行うと、警告が表示される。

## メソッド

### 概要

- メソッドは以下の3つに分類される。
  - インスタンスメソッド
  - クラスメソッド
  - 関数的メソッド

### 作成

- 書式

  ```ruby
  def メソッド名(引数1, 引数2, ...)
    処理
  end
  ```

- 書式（キーワード引数）

  ```ruby
  def メソッド名(引数1: [デフォルト値1], 引数2: [デフォルト値2], ...)
    処理
  end
  ```

- `yield`で、メソッドに与えられたブロックを実行できる。

### 呼び出し

- メソッドの引数としてハッシュを渡す場合、`{}`は省略できる。

### 可変長引数

- メソッド定義の引数を`*変数名`とすると、可変長引数を定義できる。
- メソッド呼び出しの引数を`*配列`とすると、スプレッド展開を行う。

## クラス

### クラスの作成

- 書式

  ```ruby
  class クラス名
    定義
  end
  ```

- `self`は、メソッドのレシーバを表す。
- レシーバを省略してメソッドを呼ぶと、暗黙に`self`をレシーバとする。（`変数名=`メソッドを除く）

- `initialize`という名前でインスタンスメソッドを定義すると、それがコンストラクタとなる。

### インスタンス変数

- `@変数名`で、インスタンス変数を使用できる。
- アクセスメソッドは、`インスタンス変数名`, `インスタンス変数=`メソッドを定義するか、下記のメソッドを定義する。
  - `attr_reader :インスタンス変数名`
  - `attr_writer :インスタンス変数名`
  - `attr_accessor :インスタンス変数名`

### クラス変数

- `@@変数名`で、クラス変数を使用できる。

### クラス定数

- クラス定数は、`クラス名::定数名`で参照できる。

### アクセス修飾子

- アクセス修飾子を用いて、インスタンスメソッドのアクセスを制限できる。

- 書式1

  ```ruby
  アクセス修飾子 :メソッド名1, :メソッド名2, ...
  ```

- 書式2

  ```ruby
  アクセス修飾子
  メソッド定義1
  メソッド定義2
  ...
  ```

- アクセス修飾子
  - `public`
  - `protected`
  - `private`

### クラスメソッド

- 特異クラス定義書式1

  ```ruby
  class << クラス名
    def メソッド名(引数1, 引数2, ...)
      処理
    end
  end
  ```

- 特異クラス定義書式2

  ```ruby
  class クラス名
    class << self
      def メソッド名(引数1, 引数2, ...)
        処理
      end
    end
  end
  ```

- 書式1

  ```ruby
  def クラス名.メソッド名(引数1, 引数2, ...)
    処理
  end
  ```

- 書式2

  ```ruby
  class クラス名
    def self.メソッド名(引数1, 引数2, ...)
      処理
    end
  end
  ```

### 継承

- 書式

  ```ruby
  class クラス名 < スーパークラス名
    定義
  end
  ```

### インスタンスの作成

- `new`メソッドで、インスタンスを生成する。

## モジュール

### 概要

- モジュールは、インスタンスを生成したり、継承したりすることができない。
- 名前空間の分離などの目的で使用するとよい。

### 定義

- 書式

  ```ruby
  module モジュール名
    定義
  end
  ```

### メソッド

- `module_function`でメソッドを指定することで、それを外部から呼び出すことが可能となる。

  ```ruby
  module_function :メソッド名
  ```

### 呼び出し

- 書式

  ```ruby
  モジュール名.メソッド名
  ```

- `include モジュール名`を行うと、モジュール名を省略して呼び出せる。

## その他

### ライブラリ

- `require`メソッドで、ライブラリを読み込める。

  ```ruby
  require ライブラリのファイル名
  ```

### コメント

- 複数行で書く場合

  ```ruby
  =begin
  コメント
  ...
  =end
  ```

### ブロック

- 複数行で書く場合

  ```ruby
  do |変数1, 変数2, ...|
    処理
  end
  ```

- 1行で書く場合

  ```ruby
  {|変数1, 変数2, ...| 処理}
  ```

### クォーテーション

- ダブルクォーテーションで文字列を囲うと、特殊文字を解釈する。
- シングルクォーテーションで文字列を囲うと、特殊文字を解釈しない。

### 文字列出力

- `print`メソッドは、改行せず文字列を出力する。
- `puts`メソッドは、文字列を出力し改行する。
- `p`メソッドは、オブジェクトの内容を表示する。
- `pp`メソッドは、オブジェクトを見やすく表示する。

### ヌル判定

- `nil?`はnilかどうかの判定
- `empty?`は配列や文字列の中身が存在しているかの判定
- [Rubyでnil判定をする方法 | UX MILK](https://uxmilk.jp/22595)

### スクリプト

- スクリプトが受け取った引数は、`ARGV`という変数に格納される。
- `gets`メソッドで、標準入力を1行ずつ読み込める。

### その他

- `&:method_name`で、ブロックの代わりにメソッド名を渡すことができる。
  [Ruby初心者を脱した人が悩みがちな、ちょっと特殊な記法・演算子・イディオム - Qiita](https://qiita.com/nashirox/items/0c885edf7d78fd5a83f1)

- ファイルの書き込み

  ```ruby
  File.open("sample1.txt", "w") {|f| f.puts 内容}
  ```
