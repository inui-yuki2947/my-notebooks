# Go言語_型

## 共通

### 分類

- 値型
  - 数値型
  - 浮動小数点型
  - 複素数型
  - rune型
  - 文字列型
  - 配列型
  - 構造体
- 参照型
  - スライス
  - マップ
  - チャネル
  - ポインタ
  - インターフェース
  - 関数

### 初期値

- 値型の初期値は、`0`や空文字である。
- 参照型の初期値は、`nil`である。

### キャスト

- Go言語では、暗黙的なキャストは行われない。
- 明示的にキャストする場合は、`型名(値)`とする。
- 数値・文字列の変換などには、`strconv`パッケージを使う。

### 型アサーション

- 型アサーションで、`interface{}`型変数の型をチェック・変換できる。

  ```go
  型変換後の値, 型変換が成功したか := 変数.{型}
  ```

### type

- `type`は、型にエイリアスを設定する。

  ```go
  type 新しい型 型
  ```

- エイリアスは派生元と型の互換性があるが、エイリアス同士は互換性がない。

## 値型

### 数値型

- `intビット数, uintビット数`型は、そのビット数の整数を表す。
- `int, uint`型は、実装ビット数に応じた整数を表す。
- `uintptr`型は、ポインタの値をそのまま格納するのに十分な大きさの整数を表す。
- 整数リテラルは、デフォルトで`int`型となる。
- Go言語では、桁数のオーバーフローが生じた際に、ラップアラウンドが起こる（数値が循環する）。

### 浮動小数点型

- 浮動小数点型には、`float32`型と`float64`型がある。
- 小数リテラルは、デフォルトで`float64`型となる。

### 複素数型

- 複素数型には、`complex64`型と`complex128`型がある。
- 複素数型は、`[実部 +　]虚部`で表す。（例：`1.5 + 3i`）
- `real(複素数)`関数で実部が、`imag(複素数)`関数で虚部が取り出せる。

### rune型

- 文字を表す型として、`rune`型（`int32`型の別名）がある。
- ルーンリテラルは、シングルクォーテーションで表す。

### 文字列型

- 文字列型には、`string`型がある。
- ダブルクォーテーションで通常の文字列、バッククォーテーションで複数行の文字列を記述できる。（RAW文字列リテラル）
- 一度生成された文字列は不変である。（その都度新しい文字列が生成される）

### 配列型

- 下記形式で、配列型を表す。

  ```go
  [要素数]型{初期値1, 初期値2, ...}
  ```

- 下記形式で、要素数を省略できる。

  ```go
  [...]型{初期値1, 初期値2, ...}
  ```

- 初期値を多く与えるとコンパイルエラーとなる。
- 配列型に配列型を代入する場合は、すべての要素がコピーされる。
- 要素数の拡張や縮小は不可能である。（代わりにスライスを使用する）

## スライス

### 概要

- スライスは、可変長配列のような型であり、`[]型`で表す。

### 要素数と容量

- `len`関数で、スライスの要素数を表示する。
- `cap`関数で、スライスの容量（メモリに確保された容量）を表示する。

### スライスの生成

- リテラルで生成する場合

  ```go
  []型{値1, 値2, ...}
  ```

- 簡易スライス式は、指定した配列・スライスから、インデックス`low`から`high`までの要素をもつスライスを生成する。（`low, high`は省略可能）

  ```go
  配列またはスライス[low:high]
  ```

- 完全スライス式は、簡易スライス式の挙動に加え、容量が`max - low`となる。

  ```go
  配列またはスライス[low:high:max]
  ```

- スライス式は、文字列にも適用できる。（インデックスはバイト列単位）

### 配列とスライス

- 配列は値渡し、スライスは参照渡しである。
- 配列は`[0, 0], ["", ""]`などが初期値、スライスは`nil`が初期値である。

### append

- `append`関数で、スライスの要素を追加できる。（変数への代入が必須）

  ```go
  変数 = append(スライス, 要素1, 要素2, ...)
  ```

- スライスの自動拡張が起こる場合は、参照メモリ領域が変わる。

### copy

- `copy`関数は、1番目の引数のスライスを、2番目の引数のスライスの内容で塗りつぶすようにコピーする。

  ```go
  copy(コピー先スライス, コピー元スライス)
  ```

## マップ

### 概要

- マップとは、連想配列のような型であり、`map[キーの型]要素の型`で表す。

### マップの生成

- リテラルで生成する場合

  ```go
  map[キーの型]要素の型{
    キー1: 値1,
    キー2: 値2,
    ...
  }
  ```

- マップ内では、スライス・マップ・構造体の型名を省略できる。

### マップの参照

- 参照時2番目の変数には、「キーに対応する値が存在するか」の真偽値（`ok`という名前が慣例）が代入される。

### delete

- `delete`関数は、マップから指定した要素を取り除く。

  ```go
  delete(マップ, キー)
  ```

## チャネル

### 概要

- チャネルは、ゴルーチン間でデータを受け渡すための型である。

### チャネルの種類

- `chan 型`は、受信・送信が可能なチャネルを表す。
- `<-chan 型`は、受信専用のチャネルを表す。
- `chan<- 型`は、送信専用のチャネルを表す。

### バッファ

- チャネルは、キューの性質を持つバッファを持ち、そのサイズは指定できる。
- 以下の場合はランタイムパニックが発生する。
  - バッファが空のチャネルから受信する。
  - バッファに空きがないチャネルに送信する。

### len, cap

- `len`関数は、チャネルのバッファ内に溜められているデータの個数を取得する。
- `cap`関数は、チャネルのバッファサイズを取得する。

### close

- `close`関数は、チャネルをクローズする。
- クローズされたチャネルに送信すると、ランタイムパニックとなる。（受信は可能）
- 受信時の第2引数に、「チャネルのバッファ内が空でないか、またはクローズされていないか」の真偽値を取ることができる。

### select

- `select`文は、caseのうち実行できる処理をランダムで実行する。

  ```go
  select {
  case チャネルへの処理1:
    処理1
  case チャネルへの処理2:
    処理2
  ...
  default:
    処理
  }
  ```

## ポインタ

### 概要

- ポインタ型は`*型`で表し、初期値は`nil`となる。

### アドレス演算子・デリファレンス

- `&変数`で、任意の型からそのポインタ型を生成する。
- `*変数`で、ポインタ型が指し示すデータのデリファレンスができる。
- 配列やスライスは、デリファレンスを省略できる。

### new

- `new`は、指定した型のポインタ型を生成する。

  ```go
  new(型)
  ```

## 構造体

### 概要

- 構造体は値型の一種で、各フィールドは型に合わせた初期値を取る。
- 構造体を参照渡ししたい場合は、ポインタ型にして使う。

### struct

- `struct`は、構造体を定義する。（基本的に`type`と組み合わせて使う）

  ```go
  type 構造体名 struct {
    [フィールド名1] 型1
    [フィールド名2] 型2
    ...
  }
  ```

- フィールド名省略時は、型名（プリフィックスを除く）となる。
- フィールド名を`_`とすると、無名フィールド（参照も代入もできないフィールド）となる。

### タグ

- 構造体には、「タグ」というフィールドのメタ情報を追加できる。

  ```go
  struct {
    [フィールド名1] 型1 "タグ1"
    [フィールド名2] 型2 "タグ2"
    ...
  }
  ```

### 生成

- フィールド名を指定しない場合

  ```go
  構造体名{値1, 値2, ...}
  ```

- フィールド名を指定する場合（推奨）

  ```go
  構造体名{フィールド名1: 値1, フィールド名2: 値2, ...}
  ```

### コンストラクタ

- コンストラクタは存在しないが、`New型名`という関数で実装することが多い。

### 参照

- フィールド名省略時は、一意に定まる場合に限り、中間フィールドを省略してアクセスできる。

## インターフェース

### 概要

- インターフェースは、あるメソッドを持つ型を表す。

### 定義

- 書式

  ```go
  interface {
    メソッド名1(引数1) 戻り値の型1
    メソッド名2(引数2) 戻り値の型2
    ...
  }
  ```

- インターフェースの中にインターフェースを含むこともできる。

### interface{}型

- `interface{}`型は、実装すべきメソッドが一つもないインターフェース＝**全ての型と互換性を持つ型**である。
