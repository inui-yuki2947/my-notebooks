#!/usr/bin/env bash
set -e

# ステージされているファイルのうち、削除されていないものについて、フォーマットをチェックする。
files=$(
  git diff --name-only --cached --diff-filter d |
    grep '\.md' |
    grep -v 'README\.md' |
    grep -v '/_sidebar.md' |
    sed 's/\"//'
)
if [ -n "$files" ]; then
  echo "$files" | xargs markdownlint -f
  echo "$files" | xargs md-h1 -f
  echo "$files" | xargs git add
fi
