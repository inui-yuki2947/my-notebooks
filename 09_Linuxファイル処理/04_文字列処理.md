# 文字列処理

## 文字列出力

### echo

- コマンド
  
  | コマンド           | 概要                       |
  | ------------------ | -------------------------- |
  | `echo [文字列...]` | 文字列及び改行を出力する。 |
  
- オプション
  
  |オプション|概要|
  |---|---|
  |`-n`|改行を出力しない。（`read`コマンドでユーザーに入力させる場合などに便利）|

### printf

- コマンド

  |コマンド|概要|
  |---|---|
  |`printf 書式文字列 [文字列...]`|文字列を整形して出力する。（改行は出力しない）|

- 書式文字列

  | 書式文字列 | 概要                     |
  | ---------- | ------------------------ |
  | `%s`       | 文字列                   |
  | `%u`       | 10進数の整数（符号なし） |

- オプションとして認識される文字列も、正常に出力できる。

  ```bash
  printf '%s\n' "$1"
  ```

### seq

- コマンド

  |コマンド|概要|
  |---|---|
  |`seq [開始の数 [増分]] 終了の数`|連続する数字を出力する。|

- オプション

  |オプション|概要|
  |---|---|
  |`-w`|ゼロ埋めを行う。|

## 単純文字列加工

### cut

- コマンド

  |コマンド|概要|
  |---|---|
  |`cut ファイル`|各行の指定した部分を切り出す。|

- オプション

  | オプション      | 概要                                                         |
  | --------------- | ------------------------------------------------------------ |
  | `-c 出力リスト` | 切り出し位置のリストを、**文字数**で指定する。               |
  | `-f 出力リスト` | 切り出し位置のリストを、**区切り文字で分けられたフィールド番号**で指定する。 |
  | `-d 区切り文字` | 区切り文字を指定する。（デフォルトはタブ文字）               |

  - 出力リストは、数字をハイフン・カンマつなぎで指定する。（例：`1, 1-10, -10, 10-, 1,2,3`）

### tr

- コマンド

  |コマンド|概要|例|
  |---|---|---|
  |`tr 置換前 置換後`|文字を**一文字ずつ**置換する。|`tr A-Z a-z`|
  |`tr -d 文字`|文字を削除する。||
  |`tr -s 文字`|文字が連続していた場合1つにまとめる。||
  |`tr -ds 文字`|文字が連続していた場合1つにまとめ、文字を削除する。||

- 文字クラス

  | 文字クラス  | 概要     |
  | ----------- | -------- |
  | `[:alpha:]` | 英字     |
  | `[:lower:]` | 英小文字 |
  | `[:upper:]` | 英大文字 |
  | `[:digit:]` | 数字     |
  | `[:alnum:]` | 英数字   |

## 正規表現文字列加工

### grep

- コマンド

  | コマンド                              | 概要                                   |
  | ------------------------------------- | -------------------------------------- |
  | `grep [検索パターン] [ファイル名...]` | 検索パターンにマッチする行を出力する。 |

- 正規表現変更系オプション

  | オプション | 概要                                                |
  | ---------- | --------------------------------------------------- |
  | `-F`       | 正規表現を使わず検索する。（`fgrep`コマンドと同じ） |
  | `-E`       | 拡張正規表現を使用する。（`egrep`コマンドと同じ）   |
  | `-P`       | Perl拡張を行う。（GNU版のみ）                       |

- 表示系オプション

  | オプション            | 概要                                 |
  | --------------------- | ------------------------------------ |
  | `-v, --invert-match`  | マッチしなかった結果のみを表示する。 |
  | `-o, --only-matching` | マッチした部分のみを出力する。       |
  | `-q, --quiet`         | 実行結果を画面に表示しない。         |

- ファイル名の表示系オプション

  | オプション                  | 概要                                             |
  | --------------------------- | ------------------------------------------------ |
  | `-H, --with-filename`       | ファイル名を併せて表示する。                     |
  | `-h, --no-filename`         | ファイル名を非表示にする。（複数ファイル指定時） |
  | `-l, --files-with-matches`  | マッチしたファイル名のみを出力する。             |
  | `-L, --files-without-match` | マッチしなかったファイル名のみを出力する。       |

- その他オプション

  | オプション              | 概要                                                         |
  | ----------------------- | ------------------------------------------------------------ |
  | `-e 検索パターン`       | 検索パターンを追加で指定する。                               |
  | `-f, --file ファイル名` | 検索パターンをファイルから読み込む。                         |
  | `-i, --ignore-case`     | 大文字小文字を区別しない。（デフォルトでは区別する）         |
  | `-a`                    | テキストファイルであることを明示する。<br />（`binary file matches`と言われた場合などに使用する） |

### sed

- コマンド

  |コマンド|概要|
  |---|---|
  |`sed スクリプトコマンド1[;スクリプトコマンド2;...] [ファイル名...]`|入力をなにかしら処理して出力する。|

- オプション

  | オプション                                  | 概要                                                         |
  | ------------------------------------------- | ------------------------------------------------------------ |
  | `-e スクリプトコマンド`                     | スクリプトコマンドを追加で指定する。                         |
  | `-r`（GNU）<br />`-E`（BSD）                | 拡張正規表現を使用する。                                     |
  | `-i[拡張子]`（GNU）<br />`-i 拡張子`（BSD） | 引数の拡張子でバックアップを取り、ファイルの上書きを行う。<br /><https://it-ojisan.tokyo/mac-linux-sed/> |
  | `-z`                                        | 改行コードを操作する。                                       |

- sedスクリプトコマンドは、`[アドレス]コマンド`で表現する。

- アドレス

  | アドレス     | 概要                   | 例    |
  | ------------ | ---------------------- | ----- |
  | `行`         | 指定行                 | `1`   |
  | `行1,行2`    | 行1から行2までの行     | `1,3` |
  | `$`          | 最終行                 |       |
  | `/正規表現/` | 正規表現に当てはまる行 |       |
  | （省略時）   | 全ての行               |       |

- コマンド

  | コマンド           | 概要                                           |
  | ------------------ | ---------------------------------------------- |
  | `i 文字列` ※1      | 指定した行の**前に**文字列を追加する。         |
  | `a 文字列` ※1      | 指定した行の**後ろに**文字列を追加する。       |
  | `c 文字列` ※1      | 指定した行を**文字列で置換する**。             |
  | `d`                | 指定した行を削除する。                         |
  | `y/置換前/置換後/` | 置換前を置換後の**同じ位置の文字**に置換する。 |
  | `s/置換前/置換後/` | 置換前を置換後に置換する。                     |

  - ※1 BSDでは、文字列を改行して入力する必要がある。

- `sed s/置換前/置換後/`

  - `s/置換前/置換後/g`で、1行で複数回置換する。

  - `s`の次の任意の文字がデリミタとなる。（例：`s@置換前@置換後@`）

  - `&`で文字列全体、`\1, \2, ...`で括弧で囲んだ部分の後方参照／後方置換ができる。

  - 最短一致は使えないので、代わりにクラスの否定を使う。

  - コマンド文字列内で変数展開を行う場合、変数内に改行を含むことはできない。（ベタ書きで改行文字を含むことはできる）
    <https://www.yutry.net/pc/program/sed-shellscript#mulchline-sed-insert>

### awk

- コマンド

  |コマンド|概要|
      |---|---|
  |`awk 'スクリプト' [ファイル名...]`|指定したスクリプトを実行する。|
  |`awk -f スクリプトファイル名 [ファイル名...]`|ファイルからスクリプトを読み込んで実行する。|

- スクリプト

  | スクリプト              | 概要                                               | 例                           |
      | ----------------------- | -------------------------------------------------- | ---------------------------- |
  | `パターン {アクション}` | パターンに当てはまる行について、アクションを行う。 | `$5 >= 1000000 { print $2 }` |
  | `パターン`              | パターンに当てはまる行について、行全体を出力する。 |                              |
  | `{アクション}`          | 全ての行について、アクションを行う。               |                              |
  | `BEGIN {アクション}`    | 処理前にアクションを行う。                         |                              |
  | `END {アクション}`      | 処理後にアクションを行う。                         |                              |

- 組み込み変数

  | 変数  | 概要                                      | デフォルト値 |
  | ----- | ----------------------------------------- | ------------ |
  | `$0`  | 行全体                                    |              |
  | `$n`  | 行を空白文字で区切ったn番目のフィールド。 |              |
  | `NR`  | 現在処理しているレコード番号（行番号）    |              |
  | `FS`  | フィールドの区切り文字                    | 半角スペース |
  | `OFS` | 出力時のフィールドの区切り文字            | 半角スペース |

- パターン

  | パターン     | 概要                     | 例              |
      | ------------ | ------------------------ | --------------- |
  | `比較式`     | 比較式を評価する。       | `$5 >= 1000000` |
  | `/正規表現/` | 拡張正規表現を評価する。 | `/^l/`          |

- パターンの組み合わせ

  | 書式                   | 概要                       |
      | ---------------------- | -------------------------- |
  | `パターン && パターン` | AND条件で評価する。        |
  | `パターン || パターン` | OR条件で評価する。         |
  | `! パターン`           | パターンの否定で評価する。 |

- アクション（出力系）

  | アクション           | 概要                                         |
      | -------------------- | -------------------------------------------- |
  | `print`              | 行全体を出力する。                           |
  | `print 値1 値2 ...`  | 引数を直接連結して出力する。                 |
  | `print 値1,値2, ...` | 引数を区切り文字で連結して出力する。         |
  | `printf "書式", 値`  | 値を書式の通り出力する。（改行は行われない） |

- アクション（制御系）

  | アクション                     | 概要                                         |
  | ------------------------------ | -------------------------------------------- |
  | `if (条件) 処理1 [else 処理2]` | 条件を満たす場合に、処理を実行する。         |
  | `while (条件) 処理`            | 条件を満たす場合に、繰り返し処理を実行する。 |
  | `for (変数名 in 配列名) 処理`  | 配列の要素について、繰り返し処理を実行する。 |
  
- awkスクリプトのシバン

  ```text
  #!/usr/bin/awk -f
  ```

## perl

### コマンド

- オプション

  | オプション | 概要                                                         |
  | ---------- | ------------------------------------------------------------ |
  | `-e`       | 続く引数をコードとして解釈する。                             |
  | `-n`       | 入力の各行に対してコマンドを実行する。                       |
  | `-p`       | 入力の各行に対してコマンドを実行した後、最後に`print $_`する。<br/>（スクリプトを`while (<>) { ... } continue { print; }`で囲んで実行する） |
  | `-0`       | 入力レコードの区切り文字を指定する。（未指定時はヌル文字）   |

- 例
  
  ```bash
  perl -pe 's/置換前/置換後/'
  ```

### スクリプト

- `m/文字列/`または`/文字列/`とすると、文字列のマッチングができる。
- `s/置換前/置換後/`とすると、文字列の置換ができる。

### 改行の扱い

- デフォルト
  - `^, $`は、文字列全体の開始・終了にマッチする。
  - `.`は、改行文字を除く文字列にマッチする。
- `/m`修飾子（複数行モード）
  - `^, $`が、各行の開始・終了にもマッチするようになる。
- `/s`修飾子（単一行モード）
  - `.`が、改行文字を除む文字列にマッチするようになる。

## その他

### jq

- コマンド

  | コマンド                          | 概要                       |
  | --------------------------------- | -------------------------- |
  | `jq jqフィルター [ファイル名...]` | JSON形式文字列を解析する。 |

- オプション

  | オプション | 概要                                     |
  | ---------- | ---------------------------------------- |
  | `-r`       | 両端のダブルクォーテーションを除去する。 |

- [jq Manual (development version)](https://stedolan.github.io/jq/manual/)
