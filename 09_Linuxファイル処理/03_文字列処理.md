# 文字列処理

## 基本

### echo

- `-n`オプションで、改行を出力しない。
  （`read`コマンドでユーザーに入力させる場合などに便利）

### printf

- `printf`コマンドは、文字列を整形して出力する。

  ```bash
  printf 書式文字列 [文字列...]
  ```

- 書式文字列

  - `%s`は、文字列。
  - `%u`は、10進数の整数（符号なし）。

- `printf`コマンドは、`echo`コマンドと違って、

  - 末尾に改行が追加されない。

  - オプションとして認識される文字列も、正常に出力できる。

    ```bash
    printf '%s\n' "$1"
    ```

### cut

- `cut`コマンドは、各行の指定した部分を切り出す。

  ```bash
  cut ファイル
  ```

- オプション

  - `-c 出力リスト`オプションで、切り出し位置のリストを**文字数**で指定する。
  - `-f 出力リスト`オプションで、切り出し位置のリストを**区切り文字で分けられたフィールド番号**で指定する。
  - `-d 区切り文字`オプションで、区切り文字を指定できる（デフォルトはタブ文字）。

- 出力リストは、数字をハイフン・カンマつなぎで`1, 1-10, -10, 10-, 1,2,3`などと指定する。

### tr

- `tr`コマンドは、文字を**一文字ずつ**置換する。

  ```bash
  tr 置換前 置換後
  ```

- アルファベット大文字を小文字に変換する場合

  ```bash
  tr A-Z a-z
  ```

- 文字クラス

  - `[:alpha:]`：英字
  - `[:lower:]`：英小文字
  - `[:upper:]`：英大文字
  - `[:digit:]`：数字
  - `[:alnum:]`：英数字

- `-d 文字`オプションで、文字列を削除できる。

- `-s 文字`オプションで、文字が連続していた場合1つにまとめる。

### jq

- `jq`コマンドは、JSON形式文字列を解析する。

  ```bash
  jq jqフィルター [ファイル名...]
  ```

- `-r`オプションで、両端のダブルクォーテーションを除去する。

- [jq Manual (development version)](https://stedolan.github.io/jq/manual/)

## awk

### 概要

- `awk`コマンドは、空白類で区切られたテキストを1行ごとに処理する。

  ```bash
  awk [コマンド] [ファイル...]
  ```

- TODO あとで追記

## 正規表現

### 便利ツール

- [正規表現チェッカー PHP: preg_match() / JavaScript: match()](http://okumocchi.jp/php/re.php)
- [Rubular](https://rubular.com/)

### 最長一致・最短一致

- `*, +, ?, {n}`などの量指定子は、デフォルトでは**最長一致**で検索する。
- 量指定子の後に`?`をつけると、最短一致で検索できる。（`*?`など）

### 基本正規表現と拡張正規表現

- 基本正規表現では、`(, ), {, }, +, ?, |`が通常の文字として扱われる。拡張正規表現では、メタ文字は基本的にメタ文字である。
- 基本正規表現はエスケープすべき文字が少なくて済むが、拡張正規表現は表現が多彩。
- 基本正規表現で使えない表現は、`+, ?, |`。ただしGNU拡張が有効な場合は使うことができる。

### 先読み・後読み

- 記述方法は以下の通り。
  - 肯定先読み：`(?=パターン)`
  - 否定先読み：`(?!パターン)`
  - 肯定後読み：`(?<=パターン)`
  - 否定後読み：`(?<!パターン)`
- 先読みはパターンの**先頭**、後読みは**末尾**にマッチし、マッチした文字列としては取得しない。
- 先読み・後読みの中では、量指定子は使えないことが多い。

## 正規表現系コマンド

### grep

- 書式

  ```bash
  grep [検索パターン] [ファイル名...]
  ```

- 正規表現変更系オプション

  - `-F`オプションで、正規表現を使わず検索する。（`fgrep`コマンドと同じ）

  - `-E`オプションで、拡張正規表現を使用する。（`egrep`コマンドと同じ）

  - `-P`オプションで、Perl拡張を行う。（GNU版のみ）

- 表示系オプション

  - `-v, --invert-match`オプションで、マッチしなかった結果のみを表示する。
  - `-o, --only-matching`オプションで、マッチした部分のみを出力できる。
  - `-q, --quiet`オプションで、実行結果を画面に表示しない。

- ファイル名の表示系オプション

  - `-H, --with-filename`オプションで、ファイル名を併せて表示する。
  - `-h, --no-filename`オプションで、ファイル名を非表示にする。（複数ファイル指定時）
  - `-l, --files-with-matches`オプションで、マッチしたファイル名のみを出力する。
  - `-L, --files-without-match`オプションで、マッチしなかったファイル名のみを出力する。

- その他オプション

  - `-e 検索パターン`オプションで、検索パターンを複数指定できる。
  - `-f, --file ファイル名`オプションで、検索パターンをファイルから読み込む。
  - `-a`オプションで、テキストファイルであることを明示できる。
    （`binary file matches`と言われた場合などに使用する）

### sed

- `sed`コマンドは、入力をなにかしら処理して出力する。

  ```bash
  sed スクリプトコマンド [ファイル名...]
  ```

- スクリプトコマンドは、`[アドレス]コマンド`で表現する。

- アドレス

  - `行`：指定行（例：`1`）

  - `行１,行２`：行1から行2までの行（例：`1,3`）

  - `$`：最終行

  - `/正規表現/`：正規表現に当てはまる行

  - （省略時）：全ての行

- `-e スクリプトコマンド`オプション、またはスクリプトコマンドをセミコロンで区切って、スクリプトを複数指定できる。

- GNUでは`-r`、BSDでは`-E`オプションで、拡張正規表現を使用できる。

- `-i`オプションは、引数のバックアップ用拡張子でバックアップを取り、ファイルの上書きを行う。
  - GNUの場合は引数が任意で、間にスペースを入れない。
  - BSDの場合は引数が必須で、間にスペースを入れる。
  - <https://it-ojisan.tokyo/mac-linux-sed/>
  
- `-z`オプションで、改行コードを操作できる。

### sed i|a|c 文字列

- `i 文字列`コマンドは、指定した行の**前に**文字列を追加する。
- `a 文字列`コマンドは、指定した行の**後ろに**文字列を追加する。
- `c 文字列`コマンドは、指定した行を文字列で**置換する**。
- BSDでは、文字列を改行して入力する必要がある。

### sed d

- `d`コマンドで、行を削除する。

### sed y/置換前/置換後/

- `y/置換前/置換後/`コマンドは、置換前を置換後の**同じ位置の文字**に置換する。

### sed s/置換前/置換後/

- `s/置換前/置換後/`コマンドは、置換前を置換後に置換する。
- `s/置換前/置換後/g`で、1行で複数回置換する。
- `s`の次の任意の文字がデリミタとなる。（例：`s@置換前@置換後@`）
- `&`で文字列全体、`\1, \2, ...`で括弧で囲んだ部分の後方参照／後方置換ができる。
- 最短一致は使えないので、代わりにクラスの否定を使う。
- コマンド文字列内で変数展開を行う場合、変数内に改行を含むことはできない。（ベタ書きで改行文字を含むことはできる）
  <https://www.yutry.net/pc/program/sed-shellscript#mulchline-sed-insert>

## Perl

### コマンド

- `-e`オプションで、続く引数をコードとして解釈する。
- `-n`オプションで、入力の各行に対してコマンドを実行する。
- `-p`オプションで、入力の各行に対してコマンドを実行した後、最後に`print $_`する。
  （スクリプトを`while (<>) { ... } continue { print; }`で囲んで実行する）

  ```bash
  perl -pe 's/置換前/置換後/'
  ```

- `-0`オプションを使うと、入力レコードの区切り文字を指定できる。（未指定時はヌル文字）

### スクリプト

- `m/文字列/`または`/文字列/`とすると、文字列のマッチングができる。
- `s/置換前/置換後/`とすると、文字列の置換ができる。

### 改行の扱い

- デフォルト
  - `^, $`は、文字列全体の開始・終了にマッチする。
  - `.`は、改行文字を除く文字列にマッチする。
- `/m`修飾子（複数行モード）
  - `^, $`が、各行の開始・終了にもマッチするようになる。
- `/s`修飾子（単一行モード）
  - `.`が、改行文字を除む文字列にマッチするようになる。
