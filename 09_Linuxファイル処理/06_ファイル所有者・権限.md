# ファイル所有者・権限

## 所有者

### chown

- `chown`コマンドは、ファイルの所有者・所有グループを変更する。

  ```bash
  chown 新しい所有者[:新しい所有グループ] ファイル名...
  ```

- 所有者は、ユーザー名またはユーザーIDで指定する。

- `-R`オプションで、指定したディレクトリ及びその中のファイル全てを対象とする。

### chgrp

- `chgrp`コマンドは、ファイルの所有グループを変更する。

  ```bash
  chgrp 新しい所有グループ ファイル名...
  ```

- 一般ユーザーは、変更前後のグループ両方に属している場合のみ変更できる。

## ファイル権限

### ディレクトリの権限

- 比較

  | 権限         | 概要                                               | 使用可能になるコマンド例 |
  | ------------ | -------------------------------------------------- | ------------------------ |
  | 読み取り権限 | ディレクトリ内の内容を参照できる。                 | `ls`, `find`             |
  | 書き込み権限 | ディレクトリ内ファイルの作成・変更・削除ができる。 | `touch`, `mv`, `rm`      |
  | 実行権限     | ディレクトリへの移動ができる。                     | `cd`                     |

- 読み取り・実行権限があると、IntelliJでディレクトリ内ファイルが表示される。

### 特殊な権限

- 比較

  | 項目                 | 概要                                                         | アルファベット表記 | 数値表記 |
  | -------------------- | ------------------------------------------------------------ | ------------------ | -------- |
  | SUID（Set User ID）  | ファイル実行時、所有者の権限で実行される。                   | `u+s`              | `4000`   |
  | SGID（Set Group ID） | ファイル実行時、所有グループの権限で実行される。             | `g+s`              | `2000`   |
  | スティッキービット   | 所有者とrootユーザーのみ、ファイルのリネームや削除ができる。 | `o+t`              | `1000`   |

### chmod

- `chmod`コマンドは、ファイルの権限を変更する。

  ```bash
  chmod モード ファイル名
  ```

### chmod（数字指定）

- 書式

  ```bash
  chmod 744 ファイル名
  ```

- 権限の指定順
  - ファイルの所有者
  - ファイルのグループ
  - その他
- 権限の数値表現
  - 4：読み取り
  - 2：書き込み
  - 1：実行

### chmod（アルファベット指定）

- 書式

  ```bash
  chmod 対象・操作・許可の種別 ファイル名
  ```

- 例

  ```bash
  chmod g+x ファイル名
  ```

- 対象を`a`とするか指定しなかった場合は、全てが対象となる。
- モードは、カンマ区切りで複数指定できる。

  ```bash
  chmod g+x,o+x ファイル名
  ```

## ユーザー切り替え

### su

- `su`コマンドは、ユーザーを切り替える。

  ```bash
  su [ユーザー（省略時はroot）]
  ```

- 当コマンド実行後、**切り替え先ユーザー**のパスワードが求められる。

- `exit`コマンドで、元のユーザーに戻ることができる。

- `-, -l`オプションで、シェルをログインシェルにする。（カレントディレクトリや環境変数を初期化する）

### sudo

- `sudo`コマンドは、rootユーザーの権限でコマンドを実行する。

  ```bash
  sudo [コマンド]
  ```

- 当コマンド実行後、**今のユーザー**のパスワードが求められる。

- `sudo`コマンドを使うと、`/var/log/secure`にログが残る。

- `-l`オプションで、自分に許可されているコマンド一覧を表示する。

### /etc/sudoers

- `/etc/sudoers`ファイルには、sudoの権限を記述する。

  ```text
  ユーザー名 ホスト名=(実行ユーザー名) [NOPASSWORD:] コマンド
  ```

- 例

  ```text
  student ALL=(ALL) /sbin/shutdown
  ```

- `NOPASSWORD:`を指定すると、実行時にパスワードを問われない。

- `visudo`コマンドは、`/etc/sudoers`ファイルを安全に編集する。

  ```bash
  visudo
  ```

## その他

### umask

- `umask`コマンドは、umask値の設定を行う。

  ```bash
  umask マスク値
  ```

- ファイルは`666`から、ディレクトリは`777`からumask値を引いた値が、デフォルトのアクセス権として設定される。
- umask値のデフォルトは、CentOSは`002`、Ubuntu, Macは`022`である。

### ulimit

- `ulimit`コマンドは、ユーザーが利用できるリソースを管理する。

  ```bash
  ulimit [値]
  ```

- オプション

  | オプション | 概要                             |
  | ---------- | -------------------------------- |
  | `-a`       | 設定値を全て表示する。           |
  | `-c`       | コアファイルのサイズを制限する。 |
  | `-f`       | 出力ファイルのサイズを制限する。 |
