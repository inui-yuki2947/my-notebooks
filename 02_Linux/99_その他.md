# その他

## 端末

### tty

- `tty`コマンドは、**標準入出力**となっている端末デバイスの名前を表示する。
- `/dev/tty/1`は、コンソールログインしている場合の端末。
- `/dev/pts/0`は、SSH接続している場合の仮想端末。（pseudo terminal）

### stty

- `stty`コマンドは、端末オプションを表示・編集する。

## 印刷

### CUPS

- 多くのLinuxディストリビューションでは、印刷サブシステムとして、
  **CUPS（Common Unix Printing System）**を採用している。
- ネットワーク上のプリンタをサポートするプロトコルとして、**IPP（Internet Printer Protocol）**を採用している。
- **PPD（PostScript Printer Description）形式**のファイルで、デバイスドライバの設定ができる。

### 設定

- `/etc/cups/cupsd.conf`ファイルで、ポート番号やアクセス許可の設定を記述する。
- `/etc/cups/printers.conf`ファイルで、プリンタに関する情報を記述する。

### lpr

- `lpr`コマンドは、指定したファイルを印刷する。

  ```bash
  lpr [ファイル名]
  ```

- `-P プリンタ名`オプションで、プリンタを指定できる。
- `-#部数`オプションで、部数を指定できる。

### lpq

- `lpq`コマンドは、プリントキューを表示する。

  ```bash
  lpq [ユーザー名] [ジョブ番号]
  ```

### lprm

- `lprm`コマンドは、プリントキューを削除する。

  ```bash
  lprm [ジョブ番号]
  ```

- `-`オプションで、全てのプリントキューを削除する。

## ログ

### 概要

- システムのログを取得して処理するソフトウェアとしては、syslog, rsyslog, syslog-ngなどがある。

### ログファイル

- `/var/log/messages`は、カーネルログなどが記録される、メインのログファイル。
- `/var/log/secure`は、セキュリティに関するログが記録される。
- `/var/log/maillog`は、メールに関するログが記録される。

### /etc/rsyslog.conf

- rsyslogの設定は、`/etc/rsyslog.conf`ファイル、及び`/etc/rsyslog.d`ディレクトリ以下のファイルで行う。

- 書式

  ```text
  ファシリティ.プライオリティ 出力先
  ```

- 「ファシリティ」は、メッセージの生成元を表す。
- 「プライオリティ」は、（表示を行う最低の）メッセージの重要度を表す。
  - `*`を設定すると、全てのプライオリティとなる。
  - `none`を設定すると、ログを除外する。

### logger

- `logger`コマンドは、ログメッセージを生成する。

  ```bash
  logger メッセージ
  ```

- `-p ファシリティ.プライオリティ`オプションで、ファシリティ・プライオリティを指定できる。

- `-t タグ`オプションで、タグを指定できる。

### systemd-cat

- `systemd-cat`コマンドは、systemdを採用したシステムで、コマンドの実行結果をジャーナルに書き込む。

  ```bash
  systemd-cat コマンド
  ```

### ローテーション

- ログのローテーション機能は、logrotateユーティリティが提供している。
- `/etc/logrotate.conf`ファイルで設定を行う。

## その他標準コマンド

### true, false, ヌルコマンド

- `true`コマンド、 `:`コマンド（ヌルコマンド）は、何もせず**終了ステータス0**を返す。
- `false`コマンドは、何もせず**終了ステータス1**を返す。
- シェルオプション`-x`とヌルコマンドを組み合わせて、デバッグメッセージを出力するテクニックがある。
  （当該コマンドで終了ステータスが変わることに注意）

  ```bash
  : デバッグ出力したい内容
  ```

### complete

- `complete`コマンドは、任意のコマンドに対して補完の動作を定義する。

### echo

- `-n`オプションで、改行を出力しない。
  （`read`コマンドでユーザーに入力させる場合などに便利）

### printf

- `printf`コマンドは、文字列を整形して出力する。

  ```bash
  printf 書式文字列 [文字列...]
  ```

- 書式文字列
  - `%s`は、文字列。
  - `%u`は、10進数の整数（符号なし）。
- `printf`コマンドは、`echo`コマンドと違って、
  - 末尾に改行が追加されない。
  - オプションとして認識される文字列も、正常に出力できる。

    ```bash
    printf '%s\n' "$1"
    ```

### wall

- `wall`コマンドは、ログインしている全てのユーザーの端末に、一斉にメッセージを送信する。
- GNU系

  ```bash
  wall [メッセージ]
  ```

- BSD系

  ```bash
  wall [メッセージのあるファイル]
  ```

### pbcopy, pbpaste

- `pbcopy`コマンドは、標準入力をクリップボードにコピーする。
- `pbpaste`コマンドは、クリップボードを標準出力に出力する。

### read

- `read`コマンドは、**標準入力から1行分**文字列を読み取って、変数に代入する。

  ```bash
  read [代入する変数]
  ```

- `-r`オプションで、エスケープ文字をそのまま読み取る。
- スペースをそのまま読み取るために、環境変数`IFS`を空文字にするとよい。
- 例

  ```bash
  while IFS= read -r line; do
    処理
  done
  ```

### trap

- `trap`コマンドは、送られたシグナルを捕捉して処理を行う。
- 書式

  ```bash
  trap 処理 シグナル名...
  ```

- 例

  ```bash
  trap 'echo message!!' INT
  ```

### getopts

- `getopts`コマンドは、呼び出す度に位置パラメータを順に解析し、解析結果を変数に代入する。

  ```bash
  getopts 短いオプションとなる文字列 代入先の変数
  ```

- 次に解析を行うインデックス（1始まり）は、変数`OPTIND`に代入される。

- オプション解析が終わった後に、`$OPTIND - 1`の分だけ位置パラメータを`shift`するとよい。

  ```bash
  shift $((OPTIND - 1))
  ```

- 短いオプション文字の後に`:`をつけると、引数を取るオプションとして解析し、その値は変数`OPTARG`に代入される。

- オプションが見つからない場合は、終了ステータス`1` を返す。

- 不正なオプションが指定された、あるいはオプション引数が必要なのに指定されなかった場合は、変数に`?` が代入される。

- 例

  ```bash
  while getopts ab: opt; do
    case $opt in
      a) 処理1;;
      b) 処理2;;
      *) exit 1;;
    esac
  done
  ```

### getopt

- `getopt`コマンドは、文字列を解析し、オプション・引数に分けて標準出力する。

  ```bash
  getopt [-o] 短いオプション文字列 解析したい文字列
  ```

- 短いオプション文字の後に`:`をつけると、引数を取るオプションとして解析する。

- 例

  ```bash
  getopt ab:c -a -b hoge -c fuga
  ```

- `getopt`は高機能であるが外部コマンドであるため、環境を選ばず利用したい場合は`getopts`を利用するとよい。

## ライブラリ

### peco

- [peco/peco: Simplistic interactive filtering tool](https://github.com/peco/peco)

- `peco`コマンドは、ファイルまたは標準入力を対話的にフィルタリングし、標準出力する。

  ```bash
  peco [ファイル名]
  ```

- `Ctrl + Space`で、行を選択し次の行に進む。
  - Macで選択できない場合は、下記を参考。
    [[Mac] peco で複数選択ができないときの対処法 - Qiita](https://qiita.com/noraworld/items/6143e54dc844719eccde)

### jq

- `jq`コマンドは、JSON形式文字列を解析する。

  ```bash
  jq jqフィルター [ファイル名...]
  ```

- `-r`オプションで、両端のダブルクォーテーションを除去する。

- [jq Manual (development version)](https://stedolan.github.io/jq/manual/)
