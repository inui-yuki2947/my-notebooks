# ネットワーク

## SSH

### 概要

- sshクライアントには、TeraTermやPuTTYなどがある。
- sshを受け付けるサーバーには、「sshd」をインストールしておく。

### authorized_keys

- サーバー側の`~/.ssh/authorized_keys`には、公開鍵を記載する。
- 特定のコマンドしか実行させたくない場合

  ```text
  command=コマンド
  ```

### sshd_config

- SSHの設定は、`/etc/ssh/sshd_config`で行う。
- 設定を反映するには、

  ```bash
  sudo systemctl restart sshd
  ```

### sshd_configのよく使う設定

- SSHの**22番ポート**は攻撃を受けやすいので、別の番号に変更すべき。

  ```text
  Port 10022
  ```

- SSHでは、rootユーザーのログインは禁止すべき。

  ```text
  PermitRootLogin no
  ```

- 危険な認証方式の無効化。

  ```text
  PasswordAuthentication no 
  ChallengeResponseAuthentication no
  ```

- SSHでは、パスワード認証ではなく、公開鍵認証を使うべき。

  ```text
  PubkeyAuthentication yes
  ```

### ssh

- 書式

  ```bash
  ssh [ユーザー名@]ホスト名　[コマンド]
  ```

- ポートフォワード
  - ポート番号としては、49152-65535までの番号を使うと良い。
  - `-L`オプション
    - ローカルフォワードを行うことができる。
    - 入り口がローカル、出口が踏み台に置かれる。

    ```bash
    ssh 踏み台ホスト -L 入り口のポート:出口のホスト:出口のポート
    ```

  - `-R`オプション
    - リモートフォワードを行うことができる。
    - 入り口が踏み台、出口がローカルに置かれる。

    ```bash
    ssh 踏み台ホスト -R 入り口のポート:出口のホスト:出口のポート
    ```

- `-i 秘密鍵ファイル`オプションで、秘密鍵を指定できる。（デフォルトは`~/.ssh/id_rsa`）
- `-g`オプションで、ローカル以外でもポートフォワードを行うことができる。
- `-N`オプションで、シェルを開かないようにできる。
- `-f`オプションで、プロセスがバックグラウンドで実行される。
- `-A`オプションで、エージェント転送を行うことができる。
  （1つ目のサーバに接続後、続けて別のサーバに接続する際に、最初に使った秘密鍵をそのまま使用する）

### autossh

- `autossh`コマンドは、自動で再接続を行うように`ssh`を実行できる。

## その他

### curl

- `-X, --request メソッド`オプションで、メソッドを指定できる。
- `-d, -data データ`オプションで、リクエストパラメータを指定できる。
- `-L, --location`オプションで、リダイレクトに追従する。
- `-H, --header ヘッダー`オプションで、ヘッダーを指定できる。

  ```bash
  curl -H 'Content-Type: application/json' ...
  ```

### wget

- `wget`コマンドは、指定したURLのファイルをダウンロードする。

  ```bash
  wget URL
  ```

- `curl`コマンドと違って、再帰的なダウンロードが可能である。

### ping

- `ping`コマンドは、宛先までIPパケットが届くか確認できる。

  ```bash
  ping 接続先
  ```

### nslookup, host, dig

- `nslookup, host, dig`コマンドは、ドメイン名からIPアドレスを取得する。
- `dig`コマンド

  ```bash
  dig [@DNSサーバ] ドメイン名 [クエリタイプ] [クエリクラス] [クエリオプション]
  ```

### ip

- `ip`コマンドは、ネットワークデバイスやルーティング、ポリシーなどの表示と変更を行う。

  ```bash
  ip オブジェクト [サブコマンド]
  ```

- オブジェクト
  - `addr, a`：IPアドレス
- 「eth0」などを「インタフェース名」と呼び、環境によって様々な種類がある。また「lo」は「ローカルループバック」のことである。
- Windowsでは代わりに`ipconfig`、Macでは`ifconfig`コマンドを使う。
- 従来はifconfig、netstat、routeコマンドなどを使用していたが、現在はいずれもipコマンドへの移行が進んでいる。
  [【 ip 】コマンド（基礎編）――ネットワークデバイスのIPアドレスを表示する：Linux基本コマンドTips（146） - ＠IT](https://www.atmarkit.co.jp/ait/articles/1709/22/news019.html)

### nethogs, iftop

- `nethogs`コマンドで、どのプロセスの通信量が多いかを調べることができる。
- `iftop`コマンドで、どの通信相手との通信量が多いかを調べることができる。
