# シェルスクリプト

## 共通

### シバン

- 直接指定する場合

  ```bash
  #!/bin/bash
  ```

- 環境変数`PATH`をもとに指定する場合

  ```bash
  #!/usr/bin/env ruby
  ```

- シバンは、スクリプトファイルを直接実行する場合のみ読み込まれる。

### シェルスクリプトの実行

- シェルスクリプトは、ファイルを直接実行するか、`bash, source, .`コマンドを使用して実行できる。
- ファイルを直接実行する場合は、実行権限が必要。

  ```bash
  ./hello.sh
  ```

### カレントディレクトリ

- シェルスクリプトのカレントディレクトリは、それを呼び出した際のカレントディレクトリとなるので、以下でシェルスクリプトのカレントディレクトリを統一すると便利。

  ```bash
  cd "$(dirname "$0")" || exit
  ```

### exit, return

- `exit [終了ステータス]`で、**シェルスクリプト全体**の終了ステータスを指定する。
- `return [終了ステータス]`で、**関数**の終了ステータスを指定する。
- 終了ステータス省略時は、`0`となる。

## オプション解析

### getopts

- `getopts`コマンドは、呼び出す度に位置パラメータを順に解析し、解析結果を変数に代入する。

  ```bash
  getopts 短いオプションとなる文字列 代入先の変数
  ```

- 次に解析を行うインデックス（1始まり）は、変数`OPTIND`に代入される。

- オプション解析が終わった後に、`$OPTIND - 1`の分だけ位置パラメータを`shift`するとよい。

  ```bash
  shift $((OPTIND - 1))
  ```

- 短いオプション文字の後に`:`をつけると、引数を取るオプションとして解析し、その値は変数`OPTARG`に代入される。

- オプションが見つからない場合は、終了ステータス`1` を返す。

- 不正なオプションが指定された、あるいはオプション引数が必要なのに指定されなかった場合は、変数に`?` が代入される。

- 例

  ```bash
  while getopts ab: opt; do
    case $opt in
      a) 処理1;;
      b) 処理2;;
      *) exit 1;;
    esac
  done
  ```

### getopt

- `getopt`コマンドは、文字列を解析し、オプション・引数に分けて標準出力する。

  ```bash
  getopt [-o] 短いオプション文字列 解析したい文字列
  ```

- 短いオプション文字の後に`:`をつけると、引数を取るオプションとして解析する。

- 例

  ```bash
  getopt ab:c -a -b hoge -c fuga
  ```

- `getopt`は高機能であるが外部コマンドであるため、環境を選ばず利用したい場合は`getopts`を利用するとよい。
