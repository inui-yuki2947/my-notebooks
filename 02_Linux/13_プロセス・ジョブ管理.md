# プロセス・ジョブ管理

## プロセス管理

### ps

- `ps`コマンドは、現在動作しているプロセスを表示する。
- オプション
  - `a`オプションで、全てのユーザーのプロセスを表示する。
  - `u`オプションで、実行ユーザー名などを表示する。
  - `x`オプションで、実行端末のないプロセスを表示する。
  - `-e`オプションで、全てのプロセスを表示する。（axオプションと同じ）
- プロセスは、PID、及びプロセスを開始したユーザーから引き継がれたUIDとGIDを持つ。

### pstree

- `pstree`コマンドは、現在動作しているプロセスについて、階層構造を分かりやすく表示する。（`ps f`コマンドと同じ）
- Macではインストールが必要。

### top

- `top`コマンドは、現在実行中のプロセスを継続的に表示する。

### kill, killall, pkill

- `kill`コマンドは、指定した**プロセスID**のプロセスを終了させる。（シグナルを送る）

  ```bash
  kill プロセスID
  ```

- `killall, pkill`コマンドは、指定した**プロセス名（コマンド）**のプロセスを終了させる。

  ```bash
  killall プロセス名
  ```

- 一般ユーザーは、自身が実行したプロセスのみ終了できる。

- `-l`オプションで、シグナル一覧を確認できる。

- シグナルを指定する場合
  - 書式1
  
    ```bash
    kill -シグナル名またはシグナルID プロセスID
    ```
  
  - 書式2
  
    ```bash
    kill -s シグナル名またはシグナルID プロセスID
    ```
  
  - シグナル名は、先頭に`SIG`を付けてもよい。

### シグナル

| シグナルID | シグナル名 | 意味               |
| ---------- | ---------- | ------------------ |
| 1          | HUP        | ハングアップ       |
| 9          | KILL       | 終了（デフォルト） |
| 15         | TERM       | 強制終了           |

### pgrep

- `pgrep`コマンドは、指定したプロセス名に対応するPIDを表示する。

    ```bash
    pgrep プロセス名
    ```

### lsof

- `lsof`コマンドは、**現在開いているファイル一覧**を表示する。
- `-i :ポート番号`オプションで、**ポート番号やプロトコル**を指定できる。
- `-p プロセスID`オプションで、プロセスIDを指定できる。
  - 接続を受け付けているポートに絞り込む場合

    ```bash
    lsof -p プロセスID | grep LISTEN
    ```

- `-P`オプションで、ポート番号が数字で表示されるようになる。

## ジョブ管理

### &

- コマンドをバックグラウンドで実行する場合。

  ```bash
  コマンド &
  ```

- バックグラウンドでコマンド1を実行しつつ、コマンド2も実行する場合

  ```bash
  コマンド1 & コマンド2
  ```

### nohup

- `nohup`コマンドは、仮想端末を閉じたりログアウトしたりしても、コマンドをバックグラウンド実行させる。

  ```bash
  nohup コマンド &
  ```

### jobs

- `jobs`コマンドは、現在ユーザが設定した**ジョブ一覧**を表示する。
- +は現在実行中のプロセスを、-は直前に実行されたプロセスを表す。

### fg, bg

- `fg`コマンドは、バックグランドジョブを、フォアグランドジョブに切り替える。
- `bg`コマンドは、一時停止しているジョブを、バックグランドジョブとして再開する。

  ```bash
  fg jobsで表示された番号
  ```

### crontab

- `-e`オプションで、crontabファイルを編集する。
- `-l`オプションで、crontabファイルを表示する。

## システム状況管理

### free

- `free`コマンドは、メモリの利用状況、空き状況を表示する。
- `-m`オプションで、MB単位で表示する。
- Macでは使用不可。

### uptime

- `uptime`コマンドは、システムの稼働時間や平均負荷を表示する。

### watch

- `watch`コマンドは、コマンドを一定時間ごとに実行する。
- Macでは使用不可。

## 優先度管理

### ナイス値

- ナイス値は-20から19まであり、その値が大きいほどプロセスの優先度が低くなる。
  （他のプロセスに対してナイスである）

### nice

- `nice`コマンドは、ナイス値を指定してコマンドを実行する。

  ```bash
  nice コマンド
  ```

- `-n ナイス値`オプションで、ナイス値を指定できる。（指定しなかった場合は+10となる）
- rootユーザーのみ、ナイス値に負数を指定できる。

### renice

- `renice`コマンドは、実行中プロセスのナイス値を変更する。

  ```bash
  renice [-n] ナイス値 [-p] プロセスID
  ```
