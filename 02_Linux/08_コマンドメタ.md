# コマンドメタ

## ライブラリ

### 静的ライブラリと共有ライブラリ

|項目|リンク|読み込みタイミング|拡張子（Linux）|拡張子（Windows）|
|---|---|---|---|---|
|静的ライブラリ|スタティックリンク|コンパイル時|.a|.lib|
|共有ライブラリ|ダイナミックリンク|実行時|.so (Shared Object)|.dll (Dynamic Link Library)|

### 共有ライブラリの読み込み順

1. 環境変数`LD_LIBRARY_PATH`
1. `/etc/ld.so.cache`ファイル
1. `/lib, /usr/lib`ディレクトリ

### ldd

- `ldd`（list dynamic dependecies）コマンドは、実行ファイルが必要としている共有ライブラリを表示する。

  ```bash
  ldd 実行ファイル（PATHは考慮されない）
  ```

### ldconfig

- `ldconfig`コマンドは、`/etc/ld.so.conf`ファイルをもとに、`/etc/ld.so.cache`ファイルを生成する。

## 実行されるコマンド

### 内部コマンドと外部コマンド

| 種類         | 概要                                     | 例             | マニュアル |
| ------------ | ---------------------------------------- | -------------- | ---------- |
| 内部コマンド | シェル自体に埋め込まれたコマンド         | `cd`, `echo`   | `help`     |
| 外部コマンド | 独立したプログラムとして存在するコマンド | `find`, `gzip` | `man`      |

### コマンドの優先順位

1. エイリアス
2. 内部コマンド
3. PATH

### PATH

- 環境変数`PATH`は、コロン区切りでディレクトリを指定する。
- 左側から優先して検索される。
- サブディレクトリは検索されない。
- 例（`PATH`を追加する場合）

  ```bash
  export PATH=追加するPATH:$PATH
  ```

### type, which

- `type`コマンドは、実行されるコマンドを表示する。

  ```bash
  type コマンド
  ```

- `which`コマンドは、コマンドが**PATHのどこにあるか**を表示する。

  ```bash
  which コマンド
  ```

### whereis

- `whereis`コマンドは、コマンドのバイナリファイル・ソースコード・マニュアルファイルが置かれている場所を表示する。

  ```bash
  whereis コマンド
  ```

### builtin, command

- `builtin`コマンドは、内部コマンドから、コマンドを探して実行する。

  ```bash
  builtin コマンド
  ```

- `command`コマンドは、内部コマンドとPATHから、コマンドを探して実行する。

  ```bash
  command コマンド
  ```

## エイリアス

### alias

- `alias`コマンドは、コマンドのエイリアス一覧を表示する。

  ```bash
  alias
  ```

### alias エイリアス名=コマンド

- `alias エイリアス名=コマンド`コマンドで、コマンドのエイリアスを登録する。

  ```bash
  alias エイリアス名=コマンド
  ```

### unalias

- `unalias`コマンドで、コマンドのエイリアスを削除する。

  ```bash
  unalias エイリアス名
  ```

### unalias -a

- `unalias -a`コマンドで、コマンドのエイリアスを全て削除する。

  ```bash
  unalias -a
  ```

### 一時的な無視

- コマンド名の1文字目がクォートされていると、エイリアスは適用されない。
- `\コマンド`などとすると、エイリアスを一時的に無視してコマンドを実行できる。

  ```bash
  \コマンド
  ```

## マニュアル

### man

- `man`コマンドは、コマンドやファイルなどのマニュアルを表示する。

  ```bash
  man [セクション] コマンド名やキーワード
  ```

- セクション
  - 1：ユーザーコマンド
  - 5：設定ファイル
  - 8：システム管理コマンド
- `-a`オプションで、全てのセクションを表示する。（未指定時は、最初に見つかったセクションのみ表示する）

### whatis, apropos

- `whatis, apropos`コマンドは、コマンドの簡易的な説明（NAME）を表示する。

  ```bash
  whatis コマンド名キーワード
  ```

- `whatis`コマンドは、コマンド名を検索する。（`man -f`と同じ）
- `apropos`コマンドは、コマンド名または概要を検索する。（`man -k`と同じ）

### help

- `help`コマンドは、内部コマンドのマニュアルを表示する。

  ```bash
  help コマンド
  ```

## コマンド実行

### bash

- `bash`コマンドは、**子プロセス**で、指定したファイルまたは標準入力のコマンドを実行する。

  ```bash
  bash [ファイル（省略時は標準入力）]
  ```

- `-c コマンド文字列`オプションで、文字列をコマンドとして実行する。

### source

- `.`、`source`コマンドは、**カレントシェル**で、指定したファイルにあるコマンドを実行する。

   ```bash
   . ファイル [引数]
   ```

### eval

- `eval`コマンドは、**カレントシェル**で、文字列をコマンドとして実行する。

  ```bash
  eval コマンド文字列
  ```

- 変数にコマンド文字列を代入して実行したい場合や、**パイプやリダイレクトを含む場合**に使用する。（それ以外の場合は、変数をそのまま書いて実行すればよい）
  [技術メモメモ: シェルスクリプトで変数に入れたコマンドを実行する方法の比較(evalコマンドなどの動作比較)](https://tech-mmmm.blogspot.com/2017/11/eval.html)

### exec

- `exec`コマンドは、**現在のプロセス**で、引数で指定したコマンドを実行する。

  ```bash
  exec コマンド 引数1 引数2 ...
  ```

- 引数を渡さずリダイレクトだけ指定することで、現在のプロセスのリダイレクト先を変更できる

  ```bash
  exec > result.txt
  ```

## コマンド履歴

### コマンド履歴のフロー

1. Bash起動時に、`~/.bash_history`から読み込まれる。
1. Bash使用中は、キャッシュが使用される。
1. Bash終了時に、`~/.bash_history`に書き込まれる。

### HISTFILE

- 環境変数`HISTFILE`で、コマンド履歴を記録するファイルを指定できる。（デフォルトは`~/.bash_history`）

### history

- `history`コマンドは、コマンド履歴を表示する。
- 削除
  - `-d 削除したい番号`オプションで、特定のコマンド履歴を削除できる。
  - `-c`オプションで、全コマンド履歴を削除できる。
- 上書き
  - `-w [ファイル名]`オプションで、ファイルに上書きできる。
  - `-r [ファイル名]`オプションで、ファイルから上書きできる。
- 追記
  - `-a [ファイル名]`オプションで、ファイルに追記できる。
  - `-n [ファイル名]`オプションで、ファイルから追記できる。
