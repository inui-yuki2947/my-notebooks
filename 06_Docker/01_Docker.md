# Docker

## 共通

### 概要

- Dockerを使うメリット

  - 誰でも簡単に同じ環境を構築できる。

  - 一つの物理サーバーで、セキュアでリソースの分離された、複数アプリケーション運用をすることができる。
    [Kubernetesとは何か？ | Kubernetes](https://kubernetes.io/ja/docs/concepts/overview/what-is-kubernetes/)

### インストール

- [Get Docker | Docker Documentation](https://docs.docker.com/get-docker/)

### ドキュメント

- [Orientation and setup | Docker Documentation](https://docs.docker.com/get-started/)
- [Docker 概要 — Docker-docs-ja 19.03 ドキュメント](https://docs.docker.jp/get-started/overview.html)
- [Docker入門（第一回）～Dockerとは何か、何が良いのか～ | さくらのナレッジ](https://knowledge.sakura.ad.jp/13265/)

### docker

- コマンド

  | コマンド              | 概要                       |
  | --------------------- | -------------------------- |
  | `docker サブコマンド` | Dockerの種々の管理を行う。 |

- サブコマンド

  |コマンド|概要|
  |---|---|
  |`リソース ls`|当該リソースの一覧を表示する。|
  |`リソース inspect 識別子...`|当該リソースの詳細を表示する。|
  |`リソース rm 識別子...`|当該リソースを削除する。|

- 2017年1月18日にリリースされたDocker v1.13以降、コマンドが再編成されている。
  [docker container / image コマンド新旧比較 - Qiita](https://qiita.com/zembutsu/items/6e1ad18f0d548ce6c266)

## コンテナ管理

### 概要

- コンテナには、IDと名前（それぞれ一意）がある。
- コンテナのステータスには、以下の７種類がある。
  [[Docker入門] Dockerコンテナのステータスを調べてみよう | Skyarch Broadcasting](https://www.skyarch.net/blog/?p=16702)
  - created
  - restarting
  - running
  - removing
  - paused
  - exited
  - dead
- コンテナ内のファイルは、コンテナが破棄されるときに破棄される。

### container ls

- オプション

  |オプション|概要|
  |---|---|
  |`-a, --all`|実行中以外のコンテナも表示する。|

### container run, create

- コマンド

  |コマンド|概要|
  |---|---|
  |`container run イメージ [コマンド] [引数]`|コンテナを**起動状態**で作成し、標準出力に繋ぐ。（`create`と`start`の組み合わせ）|
  |`container create イメージ [コマンド] [引数]`|コンテナを**停止状態**で作成し、作成したコンテナIDを標準出力に出力する。|

- 起動方法に関するオプション

  | オプション          | 概要                                                         |
  | ------------------- | ------------------------------------------------------------ |
  | `-d, --detach`      | コンテナを**デタッチド・モード**で起動する。<br />（現在のターミナルを占有しないようにする） |
  | `-i, --interactive` | ホストの標準入力を、コンテナの標準入力につなげる。           |
  | `-t, --tty`         | コンテナの標準出力を、ホストの標準出力につなげる。           |

- その他のオプション
  
  | オプション                                                   | 概要                                                         |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | `-p, --publish ホストのポート:コンテナのポート`              | ポートフォワーディングを行う。                               |
  | `-v, --volume [ボリュームまたはホスト側パス:]コンテナ側送信先` | ホスト側とコンテナの**ディレクトリを共有**させる。<br />ボリューム省略時は、匿名ボリュームとなる。 |
  | `-w, --workdir ディレクトリ`                                 | コンテナ内での作業ディレクトリを指定できる。                 |
  | `--network ネットワーク名`                                   | コンテナをネットワークに接続する。                           |
  | `--name コンテナ名`                                          | コンテナ名を指定する。<br />（指定しない場合は、適当な名前が与えられる） |
  | `--rm`                                                       | 終了時にコンテナを破棄する。                                 |

### container commit

- コマンド

  |コマンド|概要|
  |---|---|
  |`container commit コンテナ [リポジトリ[:タグ]]`|コンテナのファイル変更や設定をもとに、新しいイメージを作成する。|

- これでイメージを作成すると、何の操作をしてできたものなのかが分かりにくいため、**暫定的に**Dockerイメージにしておきたい場合などのみ使うべき。（Dockerfileをできるだけ使うべき）

### container attach, exec

- コマンド

  |コマンド|概要|
  |---|---|
  |`container attach コンテナ`|実行中のコンテナで起動している**PID=1**のプロセスの標準入出力に接続する。<br />（exitするとコンテナが停止する）|
  |`container exec コンテナ コマンド`|実行中のコンテナ内で新しいコマンドを実行する。|

- [Dockerコンテナ内で操作 attachとexecの違い - Qiita](https://qiita.com/RyoMa_0923/items/9b5d2c4a97205692a560)

### container cp

- コマンド

  |コマンド|概要|
  |---|---|
  |`container cp 移動元 移動先`|ファイルを移動する。|

- `コンテナ名:ファイル名`でコンテナを指定できる。

## イメージ管理

### 概要

- イメージには、ID・リポジトリ名・タグがある。
- イメージは、`DockerHubのアカウント名/イメージ名[:タグ]`の形式で表す。
- タグ省略時は`latest`となる。

### image build

- コマンド

  |コマンド|概要|
  |---|---|
  |`image build Dockerfileのあるディレクトリ`|**Dockerfile**などをもとにイメージを作成する。|

- オプション

  | オプション         | 概要                           |
  | ------------------ | ------------------------------ |
  | `-t イメージ`      | イメージ名とタグ名を指定する。 |
  | `--progress=plain` | ログを出力する。               |

### image tag

- コマンド

  |コマンド|概要|
  |---|---|
  |`image tag イメージ 新しいイメージ`|イメージにタグを付与する。|

### image pull, push

- コマンド

  |コマンド|概要|
  |---|---|
  |`image pull イメージ`|レジストリからイメージを取得する。|
  |`image push イメージ`|レジストリにイメージをプッシュする。|

### image history

- コマンド

  |コマンド|概要|
  |---|---|
  |`image history イメージ`|イメージがどう構築されたかを表示する。|

## ボリューム管理

### 概要

- ボリュームは、ホストのファイルシステムの一部としてデータが保存される。
- 保存先は`/var/lib/docker/volumes/`であるが、そのパスでなく任意に付けた名前を使用する。

### volume create

- コマンド

  |コマンド|概要|
  |---|---|
  |`volume create ボリューム名`|ボリュームを作成する。|

## ネットワーク管理

### 概要

- 複数のコンテナを一つのネットワークに繋げると、それらは通信できるようになる。
- Dockerインストール時に、自動的に3つのネットワークが作成されている。

### network create

- コマンド

  |コマンド|概要|
  |---|---|
  |`network create ネットワーク名`|新しいネットワークを作成する。|
