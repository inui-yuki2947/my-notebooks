# MySQL_文法

## 共通

### コメント

- コメントの記法は以下の通り。

  ```sql
  -- コメント
  /* コメント */
  ```

### delimiter

- `delimiter`コマンドで、SQLの区切り文字を変更できる。

  ```sql
  delimiter 区切り文字
  ```

- `//`を区切り文字として使うことが多い。

- ストアドプロシージャやトリガーの定義時などに使うと良い。

## データ型

### 日時型

- 比較表

  |項目|概要|表せる範囲|
  |---|---|---|
  |`datetime`型|タイムゾーンを意識しない型|`1000-01-01 00:00:00`～`9999-12-31 23:59:59`|
  |`timestamp`型|タイムゾーンを意識した型|`1970-01-01 00:00:01`〜`2038-01-19 03:14:07`|

- 日付の演算には、`INTERVAL`関数が使える。

  ```sql
  SELECT NOW() - INTERVAL 1 MONTH
  ```
  
- `yyyyMM`形式の数値には、`PERIOD_ADD`関数が使える。

### 文字列型

- 文字列型のリテラル値は、**シングルクォーテーション**で囲う。
- 文字列の結合は、`+`もしくは`CONCAT`で行う。
- バイト数は、非バイナリ文字列型の場合は**文字数**、バイナリ文字列型の場合は**バイト数**となる。
- CHARとVARCHAR

  - `CHAR`型は、**常に指定したバイト数**を消費する。

  - `VARCHAR`型は、「文字列のバイト数＋**バイト長のプリフィックス**（1バイトあるいは2バイト）」を消費する。

### 型のキャスト

- 書式1

  ```sql
  CAST(expr AS type)
  ```

- 書式2

  ```sql
  CONVERT(expr, type)
  ```

### 文字コードの変換

- 書式

  ```sql
  CONVERT(expr USING transcoding_name)
  ```

## 比較

### NULLとの比較

- NULLを比較演算子で比較しても**結果はNULLとなる**ため、`IS NULL`、`IS NOT NULL`演算子を使う。

### LIKE句

- `%`は、任意の文字列**0文字以上**。
- `_`は、任意の文字列**1文字**。

### 照合順序

- `COLLATE`句で、照合順序をオーバーライドできる。

  ```sql
  SELECT k
  FROM t1
  ORDER BY k COLLATE latin1_german2_ci;
  ```

## 変数

### ユーザー定義変数

- ユーザー定義変数は、`@var_name`と記述する。

- 書式1

  ```sql
  SET @var_name = expr
  ```

- 書式2

  ```sql
  @t4 := @t1+@t2+@t3;
  ```

- IN句などで変数を使いたい場合は、代わりに以下のようにするとよい。

  ```sql
  WHERE FIND_IN_SET(値, @カンマ区切り文字列を格納する変数)
  ```

## 複合ステートメント

### 概要

- 複合ステートメント構文は、ストアドプロシージャ、ストアドファンクション、トリガー、およびイベント内で使用する。

  ```sql
  BEGIN
      処理
  END;
  ```

### IF

- 記法

  ```sql
  IF 判定条件1 THEN
      処理内容1
  ELSEIF 判定条件2 THEN
      処理内容2
  ELSE
      処理内容3
  END IF;
  ```

### WHILE

- 記法

  ```sql
  WHILE 継続条件 DO
      繰り返したい処理
  END WHILE;
  ```

### REPEAT

- 記法

  ```sql
  REPEAT
      繰り返したい処理
  UNTIL 終了条件 END REPEAT;
  ```
