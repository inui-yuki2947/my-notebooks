# Gitブランチ

## 共通

### 概要

- [GitのHEADとは何者なのか - Qiita](https://qiita.com/ymzk-jp/items/00ff664da60c37458aaa)
- Gitにおけるブランチは、単にコミットを指す軽量なポインタに過ぎない。
- ブランチ・タグ名は、コミットIDのエイリアスである。
- 「detached HEAD」とは、HEADがブランチを指していない状態のことである。

### チルダとキャレット

- [【やっとわかった！】gitのHEAD^とHEAD~の違い - Qiita](https://qiita.com/chihiro/items/d551c14cb9764454e0b9)

- 一覧

  | 記法         | 概要                                                         |
  | ------------ | ------------------------------------------------------------ |
  | `コミット~n` | 親1つ目をn世代遡ったもの                                     |
  | `コミット^n` | 複数親がいる場合に、n番目の親<br />（マージコミットを遡りたい場合などに使う） |

- 例
  
  - `HEAD~~`：親1つ目の親1つ目
  - `HEAD~2`：親1つ目の親1つ目
  - `HEAD^^`：親1つ目の親1つ目
  - `HEAD^2`：親2つ目
  - `HEAD^2^`：親2つ目の親1つ目

## ブランチ・タグ操作

### branch

- `git branch`コマンドは、ブランチを管理する。

  | コマンド                                            | 概要                                                         |
  | --------------------------------------------------- | ------------------------------------------------------------ |
  | `git branch`                                        | ブランチ一覧を表示する。                                     |
  | `git branch ブランチ名 [派生元コミット]`            | ブランチを作成する。<br />派生元コミットでリモートブランチを指定すると、それが上流ブランチとなる。 |
  | `git branch -m [変更前ブランチ名] 変更後ブランチ名` | ブランチ名を変更する。                                       |

- オプション（`branch`コマンド）

  | オプション            | 概要                                                 |
  | --------------------- | ---------------------------------------------------- |
  | `-a`                  | リモートブランチも表示する。                         |
  | `-v`                  | 詳細情報を表示する。                                 |
  | `-vv`                 | 更に上流ブランチの情報も表示する。                   |
  | `--merged [コミット]` | 指定したコミットにマージ済みのブランチのみ表示する。 |

### tag

- `git tag`コマンドは、タグを管理する。

  | コマンド                                | 概要                 |
  | --------------------------------------- | -------------------- |
  | `git tag`                               | タグ一覧を表示する。 |
  | `git tag タグ名 [タグを付けるコミット]` | タグを作成する。     |

## チェックアウト・リセット

### 概要

- [Git の Reset, Checkout, Revert の違い - yu8mada](https://yu8mada.com/2018/06/01/the-difference-between-reset-checkout-and-revert-in-git/)

- 一覧

  | コマンド   | 概要                                                         |
  | ---------- | ------------------------------------------------------------ |
  | `checkout` | ブランチ・ワークツリー・インデックスを変更する。             |
  | `reset`    | ブランチを変更せず、（ワークツリー・）インデックスを変更する。 |

### checkout（ファイル未指定）

- 書式

  ```bash
  git checkout コミット
  ```

- ブランチの移動
  - 引数でローカルブランチを指定した場合、そのブランチに切り替わる。
  - 引数でローカルブランチ以外を指定した場合、「detached HEAD」状態となる。
- 未コミットの変更があればエラーとなる。

### checkout（ファイル指定）

- 書式

  ```bash
  git checkout [コミット] ファイル
  ```

- ファイルのみ指定した場合、ワークツリーがインデックスの状態となる。
- コミット・ファイルを指定した場合、ワークツリー・インデックスが、指定したコミットのファイルの状態となる。

### checkout（-bオプション指定）

- 書式

  ```bash
  git checkout -b 新しいブランチ [派生元コミット]
  ```

- 新しいブランチを作成してチェックアウトする。
- 派生元コミットでリモートブランチを指定すると、それが上流ブランチとなる。

### reset（ファイル未指定）

- 書式

  ```bash
  git reset [コミット]
  ```

- HEADは、指定したコミットに移動する。

- オプション
  
  | オプション | 概要                                                         |
  | ---------- | ------------------------------------------------------------ |
  | `--soft`   | ワークツリー・インデックスを変更しない。                     |
  | `--mixed`  | ワークツリーは変更せず、インデックスを変更する。（デフォルト） |
  | `--hard`   | ワークツリー・インデックスを変更する。                       |

### reset（ファイル指定）

- 書式

  ```bash
  git reset [コミット] ファイル
  ```

- インデックスは、指定したコミットのファイルの状態となる。
- `git reset ファイル`と`git add ファイル`は、逆の操作である。

## マージ・リベース

### merge

- コマンド

  |コマンド|概要|
  |---|---|
  |`git merge [マージするコミット（省略時は上流ブランチ）]`|コミットをマージする。|

- `--no-edit`オプションで、メッセージの編集を省略できる。

### rebase

- コマンド

  |コマンド|概要|
  |---|---|
  |`git rebase [リベースするコミット（省略時は上流ブランチ）]`|コミットをリベースする。|

- オプション

  | オプション     | 概要                                                    |
  | -------------- | ------------------------------------------------------- |
  | `-i`           | 対話的にリベースを行う。                                |
  | `--autosquash` | メッセージに`fixup!`を付けたコミットを、`fixup`とする。 |

## リモートブランチ・タグ操作

### fetch

- コマンド

  |コマンド|概要|
  |---|---|
  |`git fetch [リポジトリ [<refspec>]]`|リモートブランチ・タグを更新する。|

- 引数省略時は、HEADの上流ブランチのリポジトリ、または`origin`の、全ブランチ・タグを更新する。
- 第1引数でリポジトリを指定すると、そのリポジトリの全ブランチ・タグを更新する。
- 第2引数でブランチ・タグを指定すると、更新対象をそれに限定できる。
- リモートのタグがローカルに存在する場合、ローカルのタグは更新されない。

### pull

- `pull`コマンドは、リモートブランチ・タグを更新した後、それをHEADにマージする。
  （`fetch` + `merge FETCH_HEAD`である）

  ```bash
  git pull [リポジトリ [<refspec>]]
  ```

- 引数省略時は、HEADの上流ブランチを更新した後、それをHEADにマージする。
- 第1引数でリポジトリを指定すると、そのリポジトリでの上流ブランチを更新した後、それをHEADにマージする。
- 第2引数でブランチ・タグを指定すると、そのブランチ・タグを更新した後、それをHEADにマージする。
- `--prune`オプションで、リモートで削除されたブランチを削除する。

### push

- コマンド

  |コマンド|概要|
  |---|---|
  |`git push [リポジトリ [<refspec>]]`|リモートリポジトリの指定したブランチ・タグを、ローカルの状態へ更新する。|

- オプション

  | オプション     | 概要                                                 |
  | -------------- | ---------------------------------------------------- |
  | `-u`           | 今回指定するブランチを、上流ブランチとして設定する。 |
  | `--tags`       | 全タグをプッシュする。                               |
  | `-d, --delete` | 指定したリモートブランチを削除する。                 |

### refspec

- TODO あとで調べる
