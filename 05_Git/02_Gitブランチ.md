# Gitブランチ

## 共通

### 概要

- [GitのHEADとは何者なのか - Qiita](https://qiita.com/ymzk-jp/items/00ff664da60c37458aaa)
- Gitにおけるブランチは、単にコミットを指す軽量なポインタに過ぎない。
- ブランチ・タグ名は、コミットIDのエイリアスである。
- 「detached HEAD」とは、HEADがブランチを指していない状態のことである。

### チルダとキャレット

- [【やっとわかった！】gitのHEAD^とHEAD~の違い - Qiita](https://qiita.com/chihiro/items/d551c14cb9764454e0b9)

- 一覧

  | 記法         | 概要                                                         |
  | ------------ | ------------------------------------------------------------ |
  | `コミット~n` | 親1つ目をn世代遡ったもの                                     |
  | `コミット^n` | 複数親がいる場合に、n番目の親<br />（マージコミットを遡りたい場合などに使う） |

- 例
  
  - `HEAD~~`：親1つ目の親1つ目
  - `HEAD~2`：親1つ目の親1つ目
  - `HEAD^^`：親1つ目の親1つ目
  - `HEAD^2`：親2つ目
  - `HEAD^2^`：親2つ目の親1つ目

## ブランチ・タグ操作

### branch

- `git branch`コマンドは、ブランチを管理する。

  | コマンド                                        | 概要                                                         |
  | ----------------------------------------------- | ------------------------------------------------------------ |
  | `branch`                                        | ブランチ一覧を表示する。                                     |
  | `branch -m [変更前ブランチ名] 変更後ブランチ名` | ブランチ名を変更する。                                       |
  | `branch ブランチ名 [派生元コミット]`            | ブランチを作成する。<br />派生元コミットでリモートブランチを指定すると、それが上流ブランチとなる。 |
  | `checkout -b ブランチ名 [派生元コミット]`       | ブランチを作成して、チェックアウトする。 <br />派生元コミットでリモートブランチを指定すると、それが上流ブランチとなる。 |

- オプション

  | オプション            | 概要                                                 |
  | --------------------- | ---------------------------------------------------- |
  | `-a`                  | リモートブランチも表示する。                         |
  | `-v`                  | 詳細情報を表示する。                                 |
  | `-vv`                 | 更に上流ブランチの情報も表示する。                   |
  | `--merged [コミット]` | 指定したコミットにマージ済みのブランチのみ表示する。 |

### tag

- `git tag`コマンドは、タグを管理する。

  | コマンド                                | 概要                 |
  | --------------------------------------- | -------------------- |
  | `git tag`                               | タグ一覧を表示する。 |
  | `git tag タグ名 [タグを付けるコミット]` | タグを作成する。     |

## ブランチの移動

### 共通

- コマンド

  | コマンド                     | ブランチ    | HEAD       | インデックス | ワークツリー | 概要                                                         |
  | ---------------------------- | ----------- | ---------- | ------------ | ------------ | ------------------------------------------------------------ |
  | `checkout [コミット]`        | ○ ※1 | ○   | △ ※2 | △ ※2 | 指定コミットの状態に変更する。                            |
  | `reset [コミット]`           | ×  | ○   | ○ ※3 | × ※3 | 指定コミットの状態に変更する。                           |
  | `checkout コミット ファイル` | ×  | × | ○     | ○     | 指定コミットの状態に変更する。                 |
  | `reset コミット ファイル`  | ×  | × | ○     | ×   | 指定コミットの状態に変更する。 |
  | `checkout ファイル` | × | × | × | ○ | インデックスの状態に変更する。 |

  - ※1 ローカルブランチ以外を指定した場合は、「detached HEAD」状態となる。
  - ※2 既存の変更点は引き継がれる。
  - ※3 オプションにより可変。

- [Git の Reset, Checkout, Revert の違い - yu8mada](https://yu8mada.com/2018/06/01/the-difference-between-reset-checkout-and-revert-in-git/)

### reset [コミット]

- オプション

  | オプション              | インデックス | ワークツリー |
  | ----------------------- | ------------ | ------------ |
  | `--soft`                | 変更しない   | 変更しない   |
  | `--mixed`（デフォルト） | 変更する     | 変更しない   |
  | `--hard`                | 変更する     | 変更する     |

## ブランチの合流

### 共通

- コマンド

  |コマンド|概要|
  |---|---|
  |`git merge [コミット]`|指定したコミット（省略時は上流ブランチ）をマージする。|
  |`git rebase [コミット]`|指定したコミット（省略時は上流ブランチ）をリベースする。|

### rebase

- オプション

  | オプション          | 概要                                                    |
  | ------------------- | ------------------------------------------------------- |
  | `-i, --interactive` | 対話的にリベースを行う。                                |
  | `--autosquash`      | メッセージに`fixup!`を付けたコミットを、`fixup`とする。 |

## リモートブランチ・タグ操作

### fetch

- コマンド

  |コマンド|概要|
  |---|---|
  |`git fetch [リポジトリ [<refspec>]]`|リモートブランチ・タグを更新する。|

- 引数省略時は、HEADの上流ブランチのリポジトリ、または`origin`の、全ブランチ・タグを更新する。
- 第1引数でリポジトリを指定すると、そのリポジトリの全ブランチ・タグを更新する。
- 第2引数でブランチ・タグを指定すると、更新対象をそれに限定できる。
- リモートのタグがローカルに存在する場合、ローカルのタグは更新されない。

### pull

- `pull`コマンドは、リモートブランチ・タグを更新した後、それをHEADにマージする。
  （`fetch` + `merge FETCH_HEAD`である）

  ```bash
  git pull [リポジトリ [<refspec>]]
  ```

- 引数省略時は、HEADの上流ブランチを更新した後、それをHEADにマージする。
- 第1引数でリポジトリを指定すると、そのリポジトリでの上流ブランチを更新した後、それをHEADにマージする。
- 第2引数でブランチ・タグを指定すると、そのブランチ・タグを更新した後、それをHEADにマージする。
- オプション

  |オプション|概要|
  |---|---|
  |`--prune`|リモートで削除されたブランチを削除する。|

### push

- コマンド

  |コマンド|概要|
  |---|---|
  |`git push [リポジトリ [<refspec>]]`|リモートリポジトリの指定したブランチ・タグを、ローカルの状態へ更新する。|

- オプション

  | オプション     | 概要                                                 |
  | -------------- | ---------------------------------------------------- |
  | `-u`           | 今回指定するブランチを、上流ブランチとして設定する。 |
  | `--tags`       | 全タグをプッシュする。                               |
  | `-d, --delete` | 指定したリモートブランチを削除する。                 |

### refspec

- TODO あとで調べる
