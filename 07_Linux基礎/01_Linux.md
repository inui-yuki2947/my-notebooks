# Linux

## 共通

### Linuxディストリビューション

- 一覧

  | 項目            | 例             | 特徴                       |
  | --------------- | -------------- | -------------------------- |
  | RedHat (RHEL)系 | Fedora, CentOS | 有償で安定性がある。       |
  | Debian系        | Ubuntu         | 無償で開発スピードが速い。 |

- 「Alpine Linux」は、軽量なLinuxディストリビューション。
- 「WSL」（Windows Subsystem for Linux）とは、Linuxのバイナリ実行ファイルを、Windows 10およびWindows Server上でネイティブ実行するための互換レイヤー。

### Linux起動の流れ

1. BIOS/UEFI
1. ブートローダ
1. カーネル
1. 初期プロセス（SysVinit, Upstart, systemd）

## ハードウェア

### 接続形態

- 一覧

  | 名称                                    | 概要                                                         |
  | --------------------------------------- | ------------------------------------------------------------ |
  | IDE                                     | SATA以前にメインであった規格。                               |
  | SATA (Serial ATA)                       | 現在主流となっている規格。                                   |
  | SAS (Serial Attached SCSI)              | SATAよりも高速で信頼性も高い規格。                           |
  | SCSI                                    | さまざまな周辺機器を接続するための一般的な規格。             |
  | DMA                                     | CPUを介することなく、メインメモリと周辺機器の間で直接的に情報転送を行う方式。 |
  | PCI (Peripheral Component Interconnect) | コンピュータ内部で装置間を結ぶデータ伝送路の規格の一つ。     |

### BIOS/UEFI

- BIOSは、キーボードやハードディスクなどのデバイスを制御する、もっとも基本的な制御プログラムである。
- 現在では、BIOSの後継となるファームウェア規格の、UEFI (Unified Extensible Firmware Interface)が普及している。

### ブロックデバイスとキャラクタデバイス

- ブロックデバイスは、HDDやSSDなど、メディア上の任意の場所にアクセスできるデバイス。
- キャラクタデバイスは、キーボードやシリアルポートなど、文字単位でアクセスするデバイス。

### lscpu

- `lscpu`コマンドは、CPUの情報を表示する。
  （`/proc/cpuinfo`ファイルを見やすく表示する）

### lspci

- `lspci`コマンドは、PCIデバイスの情報を表示する。

  ```bash
  lspci
  ```

### lsusb

- `lsusb`コマンドは、USBデバイスの情報を表示する。

  ```bash
  lsusb
  ```

### lsblk

- `lsblk`コマンドは、ブロックデバイスの一覧を表示する。

  ```bash
  lsblk [デバイス...]
  ```

### blkid

- `blkid`コマンドは、ブロックデバイスの情報を表示する。

  ```bash
  blkid [デバイス...]
  ```

## パーティション

### 概要

- Linuxでは、ハードディスクをいくつかの**パーティション**に分割して利用する。
- `/home, /usr, /var, /opt`ディレクトリは、別パーティションに分割するべき。
- システムによっては、ディスクの先頭パーティションとして、数100MB程度を`/boot`パーティションに割り当てたほうがよい場合がある。
- UEFIを使ったシステムでは、FATファイルシステムでフォーマットされた、EFIシステムパーティション（ESP）が必要である。

### パーティションの種類

- ディスクには最大4個の基本パーティションを作成できる。（`/dev/sda1~4`）
- 基本パーティションのうちの一つを、拡張パーティションにすることができる。
- 論理パーティションは、拡張パーティションの中に作成されたパーティションのこと。（`/dev/sda5~`）

### スワップ領域

- スワップ領域は、仮想メモリ（物理メモリが不足した場合のメモリの延長）として利用される。
- サイズの目安は、物理メモリの1〜2倍程度。

### MBRとGPT

- 一覧

  | 方式                              | 概要                               | コマンド |
  | --------------------------------- | ---------------------------------- | -------- |
  | MBR（マスターブートレコード）     | 従来のパーティションテーブルの方式 | `fdisk`  |
  | GPT（GUIDパーティションテーブル） | 新しいパーティションテーブルの方式 | `gdisk`  |

### fdisk, gdisk

- `fdisk, gdisk`コマンドは、パーティションの管理を対話的に行う。

  ```bash
  fdisk デバイス名
  ```

- `-l`オプションで、そのデバイスのパーティションテーブルの状態を表示する。

### parted

- `parted`コマンドは、MBR, GPT方式の両方に対応した、パーティション管理を行う。

  ```bash
  parted デバイス名 [-s サブコマンド]
  ```

### LVM

- 最近では、LVMと呼ばれるディスク管理が行われることもある。

## ファイルシステム

### 概要

- ファイルを保存するためには、パーティション上にファイルシステムを作る必要がある。

- 種類

  | 名称                         | 概要                                                         | コマンド     |
  | ---------------------------- | ------------------------------------------------------------ | ------------ |
  | ext4（extended file system） | 多くのLinuxディストリビューションの標準ファイルシステム      | `mke2fs`     |
  | Btrfs（B-tree file system）  | Linux向けの新しいファイルシステム                            | `mkfs.btrfs` |
  | XFS（eXtents File System）   | CentOS 7などで標準となっている、ジャーナリングファイルシステム | `mkfs.xfs`   |

### mkfs

- `mkfs`コマンドは、パーティション上にファイルシステムを作成する。（各種ファイルシステムのフロントエンド）

  ```bash
  mkfs デバイス名
  ```

- `-t ファイルシステムタイプ`オプションで、ファイルシステムタイプを指定できる。

### mkswap

- `mkswap`コマンドは、パーティション上にスワップ領域を作成する。

  ```bash
  mkswap デバイス名
  ```

### XFS

- `xfs_db`コマンドは、XFSファイルシステムのデバッグを行う。
- `xfs_fsr`コマンドは、XFSファイルシステムのデフラグを行う。

### fsck, e2fsck

- `fsck, e2fsck`コマンドは、ディスクのチェックを行い、必要であれば修復を試みる。

  ```bash
  fsck デバイス名
  ```

- ext2, ext3, ext4には、`e2fsck`コマンドを使う。
- `-A`オプションで、`/etc/fstab`ファイルに記述されている全ファイルシステムをチェックする。

### tune2fs

- `tune2fs`コマンドは、ext2, ext3, ext4の様々なパラメータを指定する。

  ```bash
  tune2fs デバイス名
  ```

- オプション

  | オプション | 概要                                                   |
  | ---------- | ------------------------------------------------------ |
  | `-c 回数`  | 何回マウント後にファイルシステムを検査するか指定する。 |
  | `-i 間隔`  | ファイルシステムを検査する間隔を指定する。             |

## マウントとアンマウント

### mount

- `mount`コマンドは、マウント状況を表示する。

  ```bash
  mount
  ```

### mount デバイス名 マウントポイント

- `mount`コマンドの下記書式は、ファイルシステムをマウントする。

  ```bash
  mount [デバイス名] [マウントポイント]
  ```

- オプション

  | オプション                  | 概要                                                 |
  | --------------------------- | ---------------------------------------------------- |
  | `-a, --all`                 | `/etc/fstab`ファイルの全てのデバイスをマウントする。 |
  | `-t ファイルシステムタイプ` | ファイルシステムタイプを指定する。                   |

- 引数のどちらかを省略すると、`/etc/fstab`ファイルの記述が参照される。

### umount

- `umount`コマンドは、ファイルシステムをアンマウントする。

  ```bash
  umount デバイス名またはマウントポイント
  ```

### /etc/fstab

- `/etc/fstab`ファイルには、マウントするファイルシステムの情報を記述する。

  ```text
  デバイス名   マウントポイント   ファイルシステムの種類   マウントオプション   dumpフラグ   fsckフラグ
  ```

- 例

  ```text
  /dev/sda1        /home           ext4    defaults        1 1
  ```

### /etc/mtab

- `/etc/mtab`ファイルには、マウントされたファイルシステムの情報が格納される。

## ディレクトリ

### 概要

- [Linuxディレクトリ構造 - Qiita](https://qiita.com/nys9302/items/a8ddeedd3cd9d0deb332)

### /dev

- `/dev`ディレクトリには、デバイスファイルが格納される。

- udev (Userspace DEVice management)という仕組みによって、自動的に作成される。

- デバイスファイル
  
  | ファイル                  | 概要                               |
  | ------------------------- | ---------------------------------- |
  | `/dev/sda, sdb, sdc, sdd` | SCSI接続の1〜4番目のハードディスク |
  | `/dev/hda, hdb, hdc, hdd` | IDE接続の1〜4番目のハードディスク  |
  | `/dev/sr0`                | CD/DVDドライブの1番目              |
  | `/dev/st0`                | テープドライブの1番目              |
  
- 疑似デバイス
  
  | ファイル       | 概要                                   |
  | -------------- | -------------------------------------- |
  | `/dev/null`    | あらゆる入力を受け付け、それを捨てる。 |
  | `/dev/zero`    | NULL文字                               |
  | `/dev/random`  | 乱数を再利用しない、真の乱数文字列     |
  | `/dev/urandom` | 乱数を再利用した、擬似乱数文字列       |

### /media

- `/media`ディレクトリには、DVD-ROMなど、リムーバブルメディアのマウントポイントが配置される。

### /mnt

- `/mnt`ディレクトリには、一時的にマウントするファイルシステムのマウントポイントが配置される。

### /opt

- `/opt`ディレクトリには、パッケージ管理の仕組みによって、プログラムがインストールされる。

### /proc

- `/proc`ディレクトリには、カーネルが認識しているデバイスの情報が確認できる。

  | ファイル          | 概要                                           |
  | ----------------- | ---------------------------------------------- |
  | `/proc/cpuinfo`   | CPUに関する情報                                |
  | `/proc/meminfo`   | メモリに関する情報                             |
  | `/proc/modules`   | ロードされているカーネルモジュールに関する情報 |
  | `/proc/dma`       | 使用中のDMAチャネルに関する情報                |
  | `/proc/scsi/scsi` | SCSIデバイスに関する情報                       |
  | `/proc/bus/usb/*` | USBデバイスの情報                              |
  | `/proc/bus/pci/*` | PCIデバイスの情報                              |

### /home, /root

- `/home`ディレクトリには、一般ユーザーがそれぞれ利用するファイルが格納される。

- `/root`ディレクトリには、rootユーザーが利用するファイルが格納される。

### /var

- `/var`ディレクトリには、各種ログファイルやメールスプールなど、更新頻度の高いファイルが格納される。

### /usr

- `/usr`ディレクトリには、システムの起動には必須でない、プログラムやライブラリ、ドキュメントが格納される。

  | ディレクトリ          | 概要                                                         |
  | --------------------- | ------------------------------------------------------------ |
  | `/usr/bin, /usr/sbin` | 緊急時のシステム管理に必須でないコマンドが配置される。       |
  | `/usr/local`          | 更に`bin, sbin lib`などのディレクトリに細分化され、<br/>ローカルシステムで必要とされるコマンド、自作のコマンドなどが配置される。 |
  | `/usr/share`          | アーキテクチャに依存しないファイルが配置される。             |
  | `/usr/share/man`      | マニュアルが配置される。                                     |
