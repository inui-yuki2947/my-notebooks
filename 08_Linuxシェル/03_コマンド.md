# コマンド

## 共通

### コマンドの種類

- コマンドの種類

  | コマンドの種類 | 概要                                     | 例             | マニュアル |
  | -------------- | ---------------------------------------- | -------------- | ---------- |
  | 内部コマンド   | シェル自体に埋め込まれたコマンド         | `cd`, `echo`   | `help`     |
  | 外部コマンド   | 独立したプログラムとして存在するコマンド | `find`, `gzip` | `man`      |

### 優先順

- コマンドは、以下の優先順で実行される。

  1. エイリアス
  2. 内部コマンド
  3. 環境変数`PATH`配下のコマンド（左側から優先）

### 環境変数`PATH`

- 環境変数`PATH`配下（サブディレクトリを除く）のコマンドは、ファイル名のみを指定して実行できる。

- コロン区切りでパスを指定する。

- 例

  ```text
  任意のパス...:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:
  ```

### type, which, whereis

- コマンド

  | コマンド           | 概要                                                         |
  | ------------------ | ------------------------------------------------------------ |
  | `type コマンド`    | **実行されるコマンド**を表示する。                           |
  | `which コマンド`   | コマンドが**PATHのどこにあるか**を表示する。                 |
  | `whereis コマンド` | コマンドのバイナリファイル・ソースコード・マニュアルファイルが置かれている場所を表示する。 |

### 定義方法

- 定義方法

  | 定義方法         | 引数の使用 | シェルスクリプトでの使用 | 実行環境       | 適する用途                                             |
  | ---------------- | ---------- | ------------------------ | -------------- | ------------------------------------------------------ |
  | エイリアス       | できない   | できない                 | カレントシェル | 対話的環境でよく実行するコマンド                       |
  | function         | できる     | できない                 | カレントシェル | 対話的環境でよく実行する、エイリアスより複雑なコマンド |
  | シェルスクリプト | できる     | できる                   | サブシェル     | カレントシェルに影響を与えたくないコマンド             |

- [When to Use an Alias vs Script vs a New Function in Bash | Baeldung on Linux](https://www.baeldung.com/linux/bash-alias-vs-script-vs-new-function)
- [In Bash, when to alias, when to script, and when to write a function? - Unix & Linux Stack Exchange](https://unix.stackexchange.com/questions/30925/in-bash-when-to-alias-when-to-script-and-when-to-write-a-function)

## コマンド実行

### builtin, command

- コマンド

  | コマンド           | 概要                                               |
  | ------------------ | -------------------------------------------------- |
  | `builtin コマンド` | 内部コマンドから、コマンドを探して実行する。       |
  | `command コマンド` | 内部コマンドとPATHから、コマンドを探して実行する。 |

### eval, bash, exec

- コマンド

  | コマンド                     | 概要                                                         |
  | ---------------------------- | ------------------------------------------------------------ |
  | `コマンド [引数...]`         | **カレントシェル**で、コマンドを実行する。                   |
  | `eval コマンド [引数...]`    | **カレントシェル**で、コマンドを実行する。<br />変数の値にパイプやリダイレクトを含む場合も、正常に解釈される。 |
  | `bash -c コマンド [引数...]` | **子プロセス**で、コマンドを実行する。                       |
  | `exec コマンド [引数...]`    | **現在のプロセス**で、コマンドを実行する。                   |

- [技術メモメモ: シェルスクリプトで変数に入れたコマンドを実行する方法の比較(evalコマンドなどの動作比較)](https://tech-mmmm.blogspot.com/2017/11/eval.html)

### source, bash

- コマンド

  |コマンド|概要|
  |---|---|
  |`. ファイル名 [引数...]`<br />`source ファイル名 [引数...]`|**カレントシェル**で、指定したファイルのコマンドを実行する。|
  |`bash`|**子プロセス**で、標準入力のコマンドを実行する。|
  |`bash ファイル名 [引数...]`|**子プロセス**で、指定したファイルのコマンドを実行する。|
  |`./ファイル名 [引数...]`<br />`ファイルの絶対パス [引数...]`|**子プロセス**で、指定したファイルのコマンドを実行する。<br />（ファイルの実行権限が必要）|

### グループコマンド

- コマンド

  | 記法                                | 概要                                                         |
  | ----------------------------------- | ------------------------------------------------------------ |
  | `{ コマンド1 ; コマンド2 ; ... ; }` | **カレントシェル**で、複数のコマンドを実行し、まとめて標準出力する。 |
  | `( コマンド1 ; コマンド2 ; ... )`   | **サブシェル**で、複数のコマンドを実行し、まとめて標準出力する。 |

- サブシェルでは、シェル変数・環境変数は引き継がれるが、サブシェル内での変更は反映されない。

## エイリアス

### alias, unalias

- コマンド

  | コマンド                      | 概要                                 |
  | ----------------------------- | ------------------------------------ |
  | `alias`                       | コマンドのエイリアス一覧を表示する。 |
  | `alias エイリアス名=コマンド` | コマンドのエイリアスを登録する。     |
  | `unalias エイリアス名`        | コマンドのエイリアスを削除する。     |
  | `unalias -a`                  | コマンドのエイリアスを全て削除する。 |

### エイリアスの無視

- コマンド名の1文字目がクォートされていると、エイリアスは適用されない。

  ```bash
  \コマンド
  ```

## シェルスクリプト

### シバン

- 直接指定する場合

  ```bash
  #!/bin/bash
  ```

- 環境変数`PATH`をもとに指定する場合

  ```bash
  #!/usr/bin/env ruby
  ```

- シバンは、ファイルを直接実行する場合のみ読み込まれる。

### その他

- シェルスクリプトのカレントディレクトリは、それを呼び出した際のカレントディレクトリとなるので、
  以下でシェルスクリプトのカレントディレクトリを統一すると便利。

  ```bash
  cd "$(dirname "$0")" || exit
  ```

## マニュアル

### help

- コマンド

  |コマンド|概要|
  |---|---|
  |`help キーワード`|内部コマンドのマニュアルを表示する。|

### man

- コマンド

  | コマンド                      | 概要                                           |
  | ----------------------------- | ---------------------------------------------- |
  | `man [セクション] キーワード` | コマンドやファイルなどのマニュアルを表示する。 |
  
- セクション

  | セクション | 概要                 |
  | ---------- | -------------------- |
  | `1`        | ユーザーコマンド     |
  | `5`        | 設定ファイル         |
  | `8`        | システム管理コマンド |

- オプション

  |オプション|概要|
  |---|---|
  |`-a`|全てのセクションを表示する。（未指定時は、最初に見つかったセクションのみ表示する）|
  |`-f`|`whatis`コマンドと同じ。|
  |`-k`|`apropos`コマンドと同じ。|

### whatis, apropos

- コマンド

  | コマンド             | 概要                                                         |
  | -------------------- | ------------------------------------------------------------ |
  | `whatis キーワード`  | コマンドの簡易的な説明（NAME）を表示する。（**コマンド名**を検索） |
  | `apropos キーワード` | コマンドの簡易的な説明（NAME）を表示する。（**コマンド名または概要**を検索） |

## その他

### complete

- `complete`コマンドは、任意のコマンドに対して補完の動作を定義する。
