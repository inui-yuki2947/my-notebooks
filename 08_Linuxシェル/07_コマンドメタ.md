# コマンドメタ

## 実行されるコマンド

### 内部コマンドと外部コマンド

- 比較表

  | 種類         | 概要                                     | 例             | マニュアル |
  | ------------ | ---------------------------------------- | -------------- | ---------- |
  | 内部コマンド | シェル自体に埋め込まれたコマンド         | `cd`, `echo`   | `help`     |
  | 外部コマンド | 独立したプログラムとして存在するコマンド | `find`, `gzip` | `man`      |

### コマンドの優先順位

1. エイリアス
2. 内部コマンド
3. PATH

### PATH

- 環境変数`PATH`は、コロン区切りでディレクトリを指定する。
- 左側から優先して検索される。
- サブディレクトリは検索されない。

### type, which, whereis

- コマンド

  | コマンド           | 概要                                                         |
  | ------------------ | ------------------------------------------------------------ |
  | `type コマンド`    | **実行されるコマンド**を表示する。                           |
  | `which コマンド`   | コマンドが**PATHのどこにあるか**を表示する。                 |
  | `whereis コマンド` | コマンドのバイナリファイル・ソースコード・マニュアルファイルが置かれている場所を表示する。 |

### builtin, command

- コマンド

  | コマンド           | 概要                                               |
  | ------------------ | -------------------------------------------------- |
  | `builtin コマンド` | 内部コマンドから、コマンドを探して実行する。       |
  | `command コマンド` | 内部コマンドとPATHから、コマンドを探して実行する。 |

## エイリアス

### alias, unalias

- コマンド

  | コマンド                      | 概要                                 |
  | ----------------------------- | ------------------------------------ |
  | `alias`                       | コマンドのエイリアス一覧を表示する。 |
  | `alias エイリアス名=コマンド` | コマンドのエイリアスを登録する。     |
  | `unalias エイリアス名`        | コマンドのエイリアスを削除する。     |
  | `unalias -a`                  | コマンドのエイリアスを全て削除する。 |

### エイリアスの無視

- コマンド名の1文字目がクォートされていると、エイリアスは適用されない。

  ```bash
  \コマンド
  ```

## マニュアル

### help

- コマンド

  |コマンド|概要|
  |---|---|
  |`help キーワード`|内部コマンドのマニュアルを表示する。|

### man

- コマンド

  | コマンド                      | 概要                                           |
  | ----------------------------- | ---------------------------------------------- |
  | `man [セクション] キーワード` | コマンドやファイルなどのマニュアルを表示する。 |
  
- セクション

  | セクション | 概要                 |
  | ---------- | -------------------- |
  | `1`        | ユーザーコマンド     |
  | `5`        | 設定ファイル         |
  | `8`        | システム管理コマンド |

- オプション

  |オプション|概要|
  |---|---|
  |`-a`|全てのセクションを表示する。（未指定時は、最初に見つかったセクションのみ表示する）|
  |`-f`|`whatis`コマンドと同じ。|
  |`-k`|`apropos`コマンドと同じ。|

### whatis, apropos

- コマンド

  | コマンド             | 概要                                                         |
  | -------------------- | ------------------------------------------------------------ |
  | `whatis キーワード`  | コマンドの簡易的な説明（NAME）を表示する。（**コマンド名**を検索） |
  | `apropos キーワード` | コマンドの簡易的な説明（NAME）を表示する。（**コマンド名または概要**を検索） |

## コマンド実行

### eval, bash, exec

- コマンド

  | コマンド                     | 概要                                                         |
  | ---------------------------- | ------------------------------------------------------------ |
  | `コマンド [引数...]`         | **カレントシェル**で、コマンドを実行する。                   |
  | `eval コマンド [引数...]`    | **カレントシェル**で、コマンドを実行する。<br />変数の値にパイプやリダイレクトを含む場合も、正常に解釈される。 |
  | `bash -c コマンド [引数...]` | **子プロセス**で、コマンドを実行する。                       |
  | `exec コマンド [引数...]`    | **現在のプロセス**で、コマンドを実行する。                   |

- [技術メモメモ: シェルスクリプトで変数に入れたコマンドを実行する方法の比較(evalコマンドなどの動作比較)](https://tech-mmmm.blogspot.com/2017/11/eval.html)

### source, bash

- コマンド

  |コマンド|概要|
  |---|---|
  |`. ファイル名 [引数...]`<br />`source ファイル名 [引数...]`|**カレントシェル**で、指定したファイルのコマンドを実行する。|
  |`bash`|**子プロセス**で、標準入力のコマンドを実行する。|
  |`bash ファイル名 [引数...]`|**子プロセス**で、指定したファイルのコマンドを実行する。|
  |`./ファイル名 [引数...]`<br />`ファイルの絶対パス [引数...]`|**子プロセス**で、指定したファイルのコマンドを実行する。<br />（ファイルの実行権限が必要）|

### グループコマンド

- コマンド

  | 記法                                | 概要                                                         |
  | ----------------------------------- | ------------------------------------------------------------ |
  | `{ コマンド1 ; コマンド2 ; ... ; }` | **カレントシェル**で、複数のコマンドを実行し、まとめて標準出力する。 |
  | `( コマンド1 ; コマンド2 ; ... )`   | **サブシェル**で、複数のコマンドを実行し、まとめて標準出力する。 |

- サブシェルでは、シェル変数・環境変数は引き継がれるが、サブシェル内での変更は反映されない。

### シバン

- 直接指定する場合

  ```bash
  #!/bin/bash
  ```

- 環境変数`PATH`をもとに指定する場合

  ```bash
  #!/usr/bin/env ruby
  ```

- シバンは、ファイルを直接実行する場合のみ読み込まれる。

### カレントディレクトリ

- シェルスクリプトのカレントディレクトリは、それを呼び出した際のカレントディレクトリとなるので、
  以下でシェルスクリプトのカレントディレクトリを統一すると便利。

  ```bash
  cd "$(dirname "$0")" || exit
  ```

## コマンド履歴

### コマンド履歴のフロー

1. Bash起動時に、`~/.bash_history`から読み込まれる。
1. Bash使用中は、キャッシュが使用される。
1. Bash終了時に、`~/.bash_history`に書き込まれる。

### 環境変数

- 比較表

  | 環境変数         | 概要                                              | デフォルト値      |
  | ---------------- | ------------------------------------------------- | ----------------- |
  | `HISTFILE`       | コマンド履歴を記録するファイル。                  | `~/.bash_history` |
  | `HISTSIZE`       | シェルのコマンド履歴での保存数。                  |                   |
  | `HISTFILESIZE`   | コマンド履歴ファイルでの保存数。                  |                   |
  | `HISTCONTROL`    | コマンドの保存方法。（`:`で区切って複数指定可能） |                   |
  | `HISTTIMEFORMAT` | コマンド履歴の日時フォーマット。                  |                   |

- `HISTCONTROL`

  | 値            | 概要                                                   |
  | ------------- | ------------------------------------------------------ |
  | `ignorespace` | 空白で始まるコマンドを保存しない。                     |
  | `ignoredups`  | 直前の履歴と一致するコマンドを保存しない。             |
  | `ignoreboth`  | `ignoredups` + `ignorespace`                           |
  | `erasedups`   | 現在のコマンドと一致する履歴を保存前にすべて削除する。 |

- [history コマンドに日時を付与する - Qiita](https://qiita.com/bezeklik/items/56a597acc2eb568860d7)

### history

- コマンド

  |コマンド|概要|
  |---|---|
  |`history`|コマンド履歴を**全て**表示する。|
  |`history 件数`|コマンド履歴を**件数分**表示する。|

- オプション

  | オプション            | 概要                                                         |
  | --------------------- | ------------------------------------------------------------ |
  | `-r [ファイル名]`     | 履歴ファイルからキャッシュに、**全て追記**する。             |
  | `-n [ファイル名]`     | 履歴ファイルからキャッシュに、**読み込んでいないものを追記**する。 |
  | `-w [ファイル名]`     | キャッシュから履歴ファイルに、**上書き**する。               |
  | `-a [ファイル名]`     | キャッシュから履歴ファイルに、**書き込んでいないものを追記**する。 |
  | `-d コマンド履歴番号` | 指定したコマンド履歴を削除する。（`history -w`すると、ファイルに反映される） |
  | `-c`                  | 全コマンド履歴を削除する。（シェル終了時に、ファイルに反映される） |

### fc

- コマンド（実行系）

  | コマンド                       | 概要                                                         |
  | ------------------------------ | ------------------------------------------------------------ |
  | `fc [対象]`                    | 対象（省略時は直前）のコマンド履歴を編集し、実行する。       |
  | `fc 対象開始 対象終了`         | 対象開始から対象終了までのコマンド履歴を編集し、**全て**実行する。 |
  | `fc -s [置換前=置換後] [対象]` | 対象（省略時は直前）のコマンド履歴を置換し、実行する。       |

- コマンド（表示系）

  | コマンド                    | 概要                                               |
  | --------------------------- | -------------------------------------------------- |
  | `fc -l`                     | 直近16件のコマンド履歴を表示する。                 |
  | `fc -l 対象開始 [対象終了]` | 対象開始から対象終了までのコマンド履歴を表示する。 |
  | `fc -l -件数`               | 件数分のコマンド履歴を表示する。                   |

- 対象

  | 対象     | 概要                               |
  | -------- | ---------------------------------- |
  | `文字列` | 文字列から始まる直近のコマンド履歴 |
  | `番号`   | 該当番号のコマンド履歴             |

## その他

### complete

- `complete`コマンドは、任意のコマンドに対して補完の動作を定義する。
