# 変数・関数

## 共通

### 変数の種類

- 比較表

  | 変数         | 概要                                                         |
  | ------------ | ------------------------------------------------------------ |
  | 環境変数     | カレントシェル・サブシェル、及び**子プロセス**で有効である。 |
  | シェル変数   | カレントシェル・サブシェルの中で有効である。                 |
  | ローカル変数 | それを定義した関数、及び**その関数から呼び出した関数**で有効である。 |

- [Bashの変数スコープについてのメモ - Qiita](https://qiita.com/kurukuruz/items/77b329f1c2e5e645de58)

- [シェル変数と環境変数の違い - 座敷牢日誌](https://zashikiro.hateblo.jp/entry/2017/03/31/001900)

### 表示系コマンド

- 比較表

  | コマンド                         | 環境変数       | シェル変数 | 関数 |
  | -------------------------------- | -------------- | ---------- | ---- |
  | `env`<br>`printenv [環境変数名]` | ○              | ×          | ×    |
  | `export`                         | ○（declare文） | ×          | ×    |
  | `set`<br>`declare`               | ○              | ○          | ○    |
  
- [printenv、env、set、exportコマンドの違いに関して](http://tooljp.com/windows/chigai/html/Linux/printenv-env-set-export-chigai.html)

### declare

- オプション

  | オプション    | 概要                                     |
  | ------------- | ---------------------------------------- |
  | `-p [変数名]` | （指定した）シェル変数のみ表示する。     |
  | `-f [関数名]` | （指定した）関数の名前と内容を表示する。 |
  | `-F [関数名]` | （指定した）関数の名前のみ表示する。     |

### unset

- コマンド

  |コマンド|概要|
  |---|---|
  |`unset 変数名や関数名`|変数や関数を削除する。|

## 環境変数

### export 変数名

- `export 変数名`コマンドは、環境変数を定義する。
- 2行で書く場合

  ```bash
  変数名=値
  export 変数名
  ```

- 1行で書く場合

  ```bash
  export 変数名=値
  ```

### env 環境変数=値 コマンド

- `env 環境変数=値 コマンド`コマンドで、その1回だけで有効な環境変数を定義して、コマンドを実行する。

  ```bash
  [env] 環境変数=値 コマンド
  ```

### 定義済み環境変数

- `$IFS`は、「Internal Filed Separator」の略で、シェルの**区切り文字**のこと。
  - デフォルトでは、半角スペース・タブ・改行文字が設定されている。
  - fileコマンドの結果など、半角文字を含む文字列を分割したくない場合は、readコマンドで1行ずつ処理するというテクニックがある。
- `$RANDOM`で、0から32767の範囲でランダムな数値を取得できる。

## シェル変数

### declare 変数名[=値]

- コマンド

  |コマンド|概要|
  |---|---|
  |`declare 変数名[=値]`|明示的に変数を定義する。|

### readonly

- `readonly`コマンドで、読み取り専用の変数を定義できる。（`declare -r`コマンドと同じ）

  ```bash
  readonly 変数名[=値]
  ```

## ローカル変数

### local

- `local`コマンドで、ローカル変数を定義できる。

  ```bash
  local 変数名=値
  ```

## 配列

### 作成

- 配列の作成

  ```bash
  変数名=(値1 値2 ...)
  ```

- `declare -a`コマンドで、明示的に配列の変数を定義できる。

  ```bash
  declare -a 変数名[=(値1 値2 ...)]
  ```

### 代入

- 配列要素の代入

  ```bash  
  変数名[インデックス]=値
  ```

### 取得

- 比較

  | 記法                      | 概要                                   |
  | ------------------------- | -------------------------------------- |
  | `$変数名`                 | インデックス0の要素                    |
  | `${変数名[インデックス]}` | 指定したインデックスの要素             |
  | `${変数名[@]}`            | 全ての要素をスペースで連結した文字列   |
  | `${変数名[*]}`            | 全ての要素を区切り文字で連結した文字列 |
  | `${#変数名[@]}`           | 要素数                                 |
  | `${!変数名[@]}`           | インデックス一覧                       |

## 連想配列

### 作成

- 連想配列の作成

  ```bash
  変数名=([キー1]=値1 [キー2]=値2 ...)
  ```

- `declare -A`コマンドで、明示的に連想配列の変数を定義できる。

  ```bash
  declare -A 変数名[=([キー1]=値1 [キー2]=値2 ...)]
  ```

### 代入

- 連想配列要素の代入

  ```bash  
  変数名[キー]=値
  ```

## 特殊変数

### 位置パラメータ

- 比較

  | 記法               | 概要                                                         |
  | ------------------ | ------------------------------------------------------------ |
  | `$0`               | 起動したシェルスクリプトの名前                               |
  | `$数字`, `${数字}` | 数字の位置の引数<br />10個目以降は`${10}`のように記述する必要がある。 |
  | `$#`               | 引数の数                                                     |
  | `$@`               | 引数をスペースで連結した文字列                               |
  | `$*`               | 引数を区切り文字で連結した文字列                             |
  | `$$`               | 現在のシェルのプロセスID                                     |
  | `$!`               | バックグラウンドで実行した直前のプロセスID                   |
  | `$?`               | 直前に実行したコマンドの終了ステータス                       |

### set 引数

- コマンド

  |コマンド|概要|
  |---|---|
  |`set 引数1 引数2...`|位置パラメータを上書き設定する。|

### shift

- コマンド

  |コマンド|概要|
  |---|---|
  |`shift [ずらす数（省略時は1）]`|位置パラメータの番号を前にずらす。|

## 関数

### function

- `function`コマンドは、関数を定義する。

  ```bash
  [function] 関数名() { 
    処理
  }
  ```

- `$1, $2, ...`で引数を、環境変数`FUNCNAME`で関数名を取得できる。

### 呼び出し

- 書式

  ```bash
  関数名 引数1 引数2 ...
  ```

- 関数呼び出しより関数定義を先に書く。
