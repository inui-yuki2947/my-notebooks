# コマンドメタ

## ライブラリ

### 静的ライブラリと共有ライブラリ

- 比較表

  |項目|リンク|読み込みタイミング|拡張子（Linux）|拡張子（Windows）|
  |---|---|---|---|---|
  |静的ライブラリ|スタティックリンク|コンパイル時|`.a`|`.lib`|
  |共有ライブラリ|ダイナミックリンク|実行時|`.so` (Shared Object)|`.dll` (Dynamic Link Library)|

### 共有ライブラリの読み込み順

1. 環境変数`LD_LIBRARY_PATH`
1. `/etc/ld.so.cache`ファイル
1. `/lib, /usr/lib`ディレクトリ

### ldd

- コマンド

  |コマンド|概要|
  |---|---|
  |`ldd 実行ファイル（PATHは考慮されない）`|実行ファイルが必要としている共有ライブラリを表示する。|

### ldconfig

- `ldconfig`コマンドは、`/etc/ld.so.conf`ファイルをもとに、`/etc/ld.so.cache`ファイルを生成する。

## 実行されるコマンド

### 内部コマンドと外部コマンド

- 比較表

  | 種類         | 概要                                     | 例             | マニュアル |
  | ------------ | ---------------------------------------- | -------------- | ---------- |
  | 内部コマンド | シェル自体に埋め込まれたコマンド         | `cd`, `echo`   | `help`     |
  | 外部コマンド | 独立したプログラムとして存在するコマンド | `find`, `gzip` | `man`      |

### コマンドの優先順位

1. エイリアス
2. 内部コマンド
3. PATH

### PATH

- 環境変数`PATH`は、コロン区切りでディレクトリを指定する。
- 左側から優先して検索される。
- サブディレクトリは検索されない。
- 例（`PATH`を追加する場合）

  ```bash
  export PATH=追加するPATH:$PATH
  ```

### type, which, whereis

- コマンド

  | コマンド           | 概要                                                         |
  | ------------------ | ------------------------------------------------------------ |
  | `type コマンド`    | **実行されるコマンド**を表示する。                           |
  | `which コマンド`   | コマンドが**PATHのどこにあるか**を表示する。                 |
  | `whereis コマンド` | コマンドのバイナリファイル・ソースコード・マニュアルファイルが置かれている場所を表示する。 |

### builtin, command

- コマンド

  | コマンド           | 概要                                               |
  | ------------------ | -------------------------------------------------- |
  | `builtin コマンド` | 内部コマンドから、コマンドを探して実行する。       |
  | `command コマンド` | 内部コマンドとPATHから、コマンドを探して実行する。 |

## エイリアス

### alias, unalias

- コマンド

  | コマンド                      | 概要                                 |
  | ----------------------------- | ------------------------------------ |
  | `alias`                       | コマンドのエイリアス一覧を表示する。 |
  | `alias エイリアス名=コマンド` | コマンドのエイリアスを登録する。     |
  | `unalias エイリアス名`        | コマンドのエイリアスを削除する。     |
  | `unalias -a`                  | コマンドのエイリアスを全て削除する。 |

### エイリアスの無視

- コマンド名の1文字目がクォートされていると、エイリアスは適用されない。

  ```bash
  \コマンド
  ```

## マニュアル

### man

- コマンド

  |コマンド|概要|
  |---|---|
  |`man [セクション] コマンド名やキーワード`|コマンドやファイルなどのマニュアルを表示する。|

- セクション
  
  | セクション | 概要                 |
  | ---------- | -------------------- |
  | `1`        | ユーザーコマンド     |
  | `5`        | 設定ファイル         |
  | `8`        | システム管理コマンド |
  
- `-a`オプションで、全てのセクションを表示する。（未指定時は、最初に見つかったセクションのみ表示する）

### help

- コマンド

  |コマンド|概要|
  |---|---|
  |`help コマンド`|内部コマンドのマニュアルを表示する。|

### whatis, apropos

- コマンド

  | コマンド                       | 概要                                                         |
  | ------------------------------ | ------------------------------------------------------------ |
  | `whatis コマンド名キーワード`  | コマンド名を検索して、コマンドの簡易的な説明（NAME）を表示する。<br />（`man -f`と同じ） |
  | `apropos コマンド名キーワード` | コマンド名または概要を検索して、コマンドの簡易的な説明（NAME）を表示する。<br />（`man -k`と同じ） |

## コマンド実行

### bash

- コマンド

  |コマンド|概要|
  |---|---|
  |`bash [ファイル（省略時は標準入力）]`|**子プロセス**で、指定したファイルまたは標準入力のコマンドを実行する。|

- `-c コマンド文字列`オプションで、文字列をコマンドとして実行する。

### source

- `.`、`source`コマンドは、**カレントシェル**で、指定したファイルにあるコマンドを実行する。

   ```bash
   . ファイル [引数]
   ```

### eval

- コマンド

  |コマンド|概要|
  |---|---|
  |`eval コマンド文字列`|**カレントシェル**で、文字列をコマンドとして実行する。|

- 変数にコマンド文字列を代入して実行したい場合や、**パイプやリダイレクトを含む場合**に使用する。（それ以外の場合は、変数をそのまま書いて実行すればよい）
  [技術メモメモ: シェルスクリプトで変数に入れたコマンドを実行する方法の比較(evalコマンドなどの動作比較)](https://tech-mmmm.blogspot.com/2017/11/eval.html)

### exec

- コマンド

  |コマンド|概要|
  |---|---|
  |`exec コマンド 引数1 引数2 ...`|**現在のプロセス**で、引数で指定したコマンドを実行する。|

- 引数を渡さずリダイレクトだけ指定することで、現在のプロセスのリダイレクト先を変更できる

  ```bash
  exec > result.txt
  ```

## コマンド履歴

### コマンド履歴のフロー

1. Bash起動時に、`~/.bash_history`から読み込まれる。
1. Bash使用中は、キャッシュが使用される。
1. Bash終了時に、`~/.bash_history`に書き込まれる。

### 環境変数

- 比較表

  | 環境変数       | 概要                             | デフォルト値      |
  | -------------- | -------------------------------- | ----------------- |
  | `HISTFILE`     | コマンド履歴を記録するファイル。 | `~/.bash_history` |
  | `HISTSIZE`     | シェルのコマンド履歴での保存数   |                   |
  | `HISTFILESIZE` | コマンド履歴ファイルでの保存数   |                   |

### history

- コマンド

  |コマンド|概要|
  |---|---|
  |`history`|コマンド履歴を表示する。|

- オプション

  | オプション          | 概要                           |
  | ------------------- | ------------------------------ |
  | `-d 削除したい番号` | 特定のコマンド履歴を削除する。 |
  | `-c`                | 全コマンド履歴を削除する。     |
  | `-w [ファイル名]`   | ファイルに上書きする。         |
  | `-r [ファイル名]`   | ファイルから上書きする。       |
  | `-a [ファイル名]`   | ファイルに追記する。           |
  | `-n [ファイル名]`   | ファイルから追記する。         |

## その他

### complete

- `complete`コマンドは、任意のコマンドに対して補完の動作を定義する。
