# 文法

## 基本

### コマンド

- [【Linux】コマンドまとめ 〜コマンド名の由来を添えて〜 - Qiita](https://qiita.com/taji-taji/items/0b4bcccf097371bc143c)

### オプション

- [Linux系システムのコマンドラインオプションについて調べたメモ - Qiita](https://qiita.com/rubytomato@github/items/2ee2fd4127eadc1f1193)
- ハイフン1つの場合
  - オプション同士は、連結できる。

    ```bash
    ls -tr
    ```

  - オプション→オプション引数の順は連結でき、オプション引数→オプションの順は連結できない。

    ```bash
    ls -tw100 -r
    ```

- ハイフンが2つの場合
  - オプション引数が必須の場合、半角スペースまたは`=`で区切る。

    ```bash
    ls --sort none
    ls --sort=none
    ```

  - オプション引数が任意の場合、`=`で区切る。

    ```bash
    ls --color=always
    ```

- ハイフンをつける文化の前から存在していたコマンドでは、ハイフンをつけなくてもよいオプションもある。

### GNUとBSD

- LinuxはGNU系、MacはBSD系であり、挙動が異なるコマンドがある。
- MacでGNU版のコマンドを利用するには、GNU版のコマンドをインストールするとよい。

  ```bash
  brew install grep
  brew install gnu-sed
  ```

## 展開とクォーティング

### 概要

- シェルは、クォーテーションで囲まれていないコマンド引数について、パス名展開・チルダ展開・ブレース展開を行う。

- クォーテーション

  | 種類                     | 概要                                          |
  | ------------------------ | --------------------------------------------- |
  | シングルクォーテーション | 全ての特殊文字がエスケープされる。            |
  | ダブルクォーテーション   | ``$, `, \``以外の特殊文字がエスケープされる。 |

### パス名展開

- 以下のメタキャラクタは、**ファイル名**に置き換えられる。

  | 記法                     | 概要                     | 例       |
  | ------------------------ | ------------------------ | -------- |
  | `*`                      | 任意の0文字以上          |          |
  | `?`                      | 任意の1文字              |          |
  | `[文字1文字2...]`        | 指定した文字のいずれか   | `[abc]`  |
  | `[文字1-文字2]`          | 文字1から文字2までの文字 | `[a-z]`  |
  | `[^文字]`<br />`[!文字]` | 指定した文字以外の文字   | `[^abc]` |

### チルダ展開

- `~ユーザー名`は、指定ユーザーのホームディレクトリに展開される。
- クォーテーション内でホームディレクトリを記述したい場合は、環境変数`HOME`を使うとよい。

### ブレース展開

- `{文字列1,文字列2,...}`で、文字列をそれぞれ展開する。

### パラメータ展開

- 比較

  | 記法                       | 概要                                              |
  | -------------------------- | ------------------------------------------------- |
  | `${変数名:-デフォルト値}`  | デフォルト値を設定する。                          |
  | `${変数名:n:m}`            | 変数のn文字目からm文字目まで切り出す。（0始まり） |
  | `${変数名#文字列}`         | 変数の一部分を、**前方最短一致**で取り除く。      |
  | `${変数名##文字列}`        | 変数の一部分を、**前方最長一致**で取り除く。      |
  | `${変数名%文字列}`         | 変数の一部分を、**後方最短一致**で取り除く。      |
  | `${変数名%%文字列}`        | 変数の一部分を、**後方最長一致**で取り除く。      |
  | `${変数名/置換前/置換後}`  | 変数を置換する。                                  |
  | `${変数名//置換前/置換後}` | 変数を複数回置換する。                            |

- [【シェル芸人への道】Bashの変数展開と真摯に向き合う - Qiita](https://qiita.com/t_nakayama0714/items/80b4c94de43643f4be51#parameterpattern-%E5%A4%A7%E6%96%87%E5%AD%97%E5%8C%96)

### プロセス置換

- プロセス置換は、コマンドの結果を仮想的なファイルとして利用できる。
（コマンドの結果が、自動的に作成された**ファイルパス名**に置換される）
- 使い道としては、2つ以上ファイルを指定するコマンド（「diff」コマンドなど）で使用する。

  ```bash
  diff <(ls .) <(ls ..)
  ```

### 履歴展開

- 履歴展開は、対話的シェルでのみ行われる。

  | 記法                | 概要                             |
  | ------------------- | -------------------------------- |
  | `!コマンド履歴番号` | コマンド履歴の当該番号           |
  | `!!`                | 直前のコマンド                   |
  | `!文字列`           | 当該文字列で始まる最後のコマンド |

### その他

- 信頼できない変数（下記など）を参照する場合は、単語分割やパス名展開を防ぐため、またセキュリティ対策のため、**`""`で囲んでおく**。
  - 外側から渡される引数
  - 環境変数
  - コマンドの実行結果

## 算術計算

### 整数型変数

- コマンド

  |コマンド|概要|
  |---|---|
  |`declare -i 変数名[=値]`|整数型の変数を定義できる。|

- 整数型変数への代入

  - 右辺は、算術式評価される。
  - 右辺は、スペースを含めない。
  
- 例

  ```bash
  declare -i a
  a=b+1
  ```

### 算術式評価

- コマンド

  | コマンド                     | 概要                                                         |
  | ---------------------------- | ------------------------------------------------------------ |
  | `((式または式を含む代入式))` | 式の算術式評価結果が`0`の場合は、終了ステータス`1`を返す。<br />式の算術式評価結果が`0`以外の場合は、終了ステータス`0`を返す。 |
  | `$((式))`                    | 式の算術式評価の結果に展開される。（算術式展開）             |

- 式の記法

  - スペースは含めても含めなくてもよい。

  - `*, >>, |`などは、算術式の演算子とみなされる。

  - 変数名の前の`$`は、付けなくてもよい。

### expr, let, bc

- コマンド

  |コマンド|概要|式|
  |---|---|---|
  |`expr 式`|式を評価し標準出力する。|式には、スペースを含める。 <br />`*`を使う場合は、パス名展開されないようクォートする。|
  |`let 変数=式`|式を評価し代入する。|式には、スペースを含めない。|
  |`bc [ファイル名]`|ファイルまたは標準入力から読み込んで計算を行う。||

- `bc`コマンドでは、標準では小数点以下を表示しないが、`scale=小数点以下の桁数`と入力することで、表示されるようになる。

## 制御構造

### test, [ 条件 ], [[ 条件 ]]

- 一覧

  | 記法                   | AND,OR条件       | その他                                                       |
  | ---------------------- | ---------------- | ------------------------------------------------------------ |
  | `test`<br />`[ 条件 ]` | `-a, -o`を使う。 | `<, >, (, )`などの記号は、クォートする必要がある。           |
  | `[[ 条件 ]]`（推奨）   | `&&, ||`を使う。 | 条件部分で、単語分割は行われない。<br />条件部分で、パス名展開は行われない。（比較時の右辺にある場合を除く） |

- `test, [ 条件 ], [[ 条件 ]]`は、判定した結果を**終了ステータス**として返す。

### 評価演算子

- 文字列評価
  
  | コマンド             | 概要                                 |
  | -------------------- | ------------------------------------ |
  | `文字列1 = 文字列2`  | 文字列が等しいかどうか               |
  | `文字列 =~ 正規表現` | 文字列が正規表現にマッチするかどうか |
  | `-n 文字列`          | 文字列が空文字でないかどうか         |
  | `-z 文字列`          | 文字列が空文字であるかどうか         |
  
- 整数評価
  
  | コマンド          | 概要                           |
  | ----------------- | ------------------------------ |
  | `整数1 -eq 整数2` | 整数が等しいかどうか           |
  | `整数1 -ne 整数2` | 整数が等しくないかどうか       |
  | `整数1 -lt 整数2` | 整数1が整数2より小さいかどうか |
  | `整数1 -le 整数2` | 整数1が整数2以下であるかどうか |
  
- ファイル・ディレクトリ評価
  
  | コマンド                      | 概要                                             |
  | ----------------------------- | ------------------------------------------------ |
  | `-e パス`                     | パスが存在するかどうか                           |
  | `-f パス`                     | ファイルとして存在するかどうか                   |
  | `-d パス`                     | ディレクトリとして存在するかどうか               |
  | `-L パス`                     | シンボリックリンクとして存在するかどうか。       |
  | `-r, -w, -x パス`             | 読み取り・書き込み・実行権限があるかどうか       |
  | `-nt ファイル名1 ファイル名2` | ファイル1の更新日時がファイル2より新しいかどうか |
  | `-ot ファイル名1 ファイル名2` | ファイル1の更新日時がファイル2より古いかどうか   |

### true, false, ヌルコマンド

- コマンド

  | コマンド                         | 概要                                |
  | -------------------------------- | ----------------------------------- |
  | `true`<br /> `:`（ヌルコマンド） | 何もせず**終了ステータス0**を返す。 |
  | `false`                          | 何もせず**終了ステータス1**を返す。 |

### if文

- 複数行で書く場合

  ```bash
  if 条件1; then 
    処理1
  elif 条件2; then
    処理2
  else
    処理3
  fi
  ```

- 1行で書く場合（任意の長さとなる部分の後に`;`を付ける）

  ```bash
  if 条件; then 処理; fi
  ```

- if文では、条件部分の**終了ステータス**をもとに判断する。
- if文の中身は空にできないので、不要な場合はヌルコマンドを置く。

### case文

- `case`文は、文字列のパターンに応じて処理を分岐する。

  ```bash
  case 文字列 in
    パターン1) 
      処理1 ;;
    パターン2) 
      処理2 ;;
    ...
  esac
  ```

- パターンとして、ワイルドカードを指定できる。

### for文

- 書式

  ```bash
  for 変数 in 配列; do 
    処理
  done
  ```

### while, until文

- while, until文は、条件の終了ステータスが`0 (1)`である限り、処理が繰り返される。

  ```bash
  while, until 条件; do 
    処理
  done
  ```
