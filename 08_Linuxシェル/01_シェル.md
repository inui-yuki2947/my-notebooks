# シェル

## 使用するシェル

### 概要

- `/etc/shells`で、使用可能なシェル一覧を確認できる。
- 環境変数`SHELL`で、デフォルトのシェルを確認できることもあるが、あまり信頼できない。
- `/etc/passwd`でも、デフォルトのシェルを確認できる。

### chsh

- コマンド

  |コマンド|概要|
  |---|---|
  |`chsh [ユーザー（省略時はカレントユーザー）]`|デフォルトのシェルを変更できる。|

## Bash設定

### ショートカット

- ショートカット

  | ショートカット | 概要                                                     |
  | -------------- | -------------------------------------------------------- |
  | `Ctrl + R`     | インクリメンタル検索を行う・選択肢を進める。             |
  | `Ctrl + S`     | インクリメンタル検索の選択肢を戻る。※1                   |
  | `Ctrl + C`     | 処理をキャンセルする。                                   |
  | `Ctrl + D`     | 入力の終わりを示す。入力中の文字が存在しなければ終了する |
  | `Ctrl + Z`     | 処理を一時中断する。                                     |
  | `Ctrl + S`     | スクリーンロックを行う。                                 |
  | `Ctrl + Q`     | スクリーンロックを解除する。                             |

- ※1 通常では`Ctrl + S`がスクリーンロックに割り当てられているので、以下のようにして解除する必要がある。

  ```bash
  stty stop undef
  ```

- [bashで覚えておきたいショートカットキー(キーバインド) | 俺的備忘録 〜なんかいろいろ〜](https://orebibou.com/ja/home/201506/20150629_001/)

### 設定

- ファイル

  ファイル|読み込みタイミング|用途
    ---|---|---
  `/etc/profile`|ログイン時|基本的な環境変数の設定
  `/etc/bashrc`（RedHat系）<br>`/etc/bash.bashrc`（Debian系）|対話的シェル起動時|
  `~/.bash_profile`<br>`~/.bash_login`<br>`~/.profile`|ログイン時|環境変数の設定
  `~/.bashrc`|対話的シェル起動時|エイリアスの設定、bashオプションの設定
  `~/.bash_logout`|ログアウト時|

- Linuxディストリビューションによって、読み込まれ方は異なる。
- `~/.bash_profile`から`~/.bash_rc`を読み込むよう記述することもある。

  ```bash
  if [ -f ~/.bashrc ]; then
    . ~/.bashrc
  fi
  ```

- [【初心者向け】エイリアスの設定方法 - Qiita](https://qiita.com/yutat93/items/b5bb9c0366f21bcbea62)
- [本当に正しい .bashrc と .bash_profile の使ひ分け - Qiita](https://qiita.com/magicant/items/d3bb7ea1192e63fba850)
- [bashの.profileや.bashrc等を実行する動作仕様 - sgryjp.log](https://blog.sgry.jp/entry/2019/11/09/232927)

### その他

- 環境変数

  | 環境変数         | 概要                                          | デフォルト値 |
  | ---------------- | --------------------------------------------- | ------------ |
  | `PS1`            | プロンプト                                    | `\h:\W \u\$` |
  | `PS2`            | セカンダリプロンプト（2行目以降のプロンプト） |              |
  | `PROMPT_COMMAND` | プロンプトを出す前に実行するコマンド          |              |

- プロンプトで使える表現

  | 書式                                            | 概要                               | 例                           |
  | ----------------------------------------------- | ---------------------------------- | ---------------------------- |
  | `\D{フォーマット}`                              | 日時をフォーマット付きで指定する。 |                              |
  | `\[\e[フォントの数値;色の数値m\]文字列\[\e[m\]` | 文字列の色を変更する。             | `\[\e[1;33m\]文字列\[\e[m\]` |
  | `$(コマンド)`                                   | コマンドの結果を挿入する。         |                              |

- [ターミナルプロンプトの表示・色の変更 - Qiita](https://qiita.com/hmmrjn/items/60d2a64c9e5bf7c0fe60)

## シェルオプション

### set

- コマンド

  | コマンド                                                     | 概要                                                         |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | `set -o`                                                     | 現在のシェルオプションの設定を表示する。                     |
  | `set +o`                                                     | 現在のシェルオプションの設定にするためのコマンドを表示する。 |
  | `set -シェルオプションショート`<br />`set -o シェルオプションロング` | シェルオプションを有効にする。                               |
  | `set +シェルオプションショート`<br />`set +o シェルオプションロング` | シェルオプションを無効にする。                               |

- シェルオプション

  | ショート | ロング      | 概要                                                         |
  | -------- | ----------- | ------------------------------------------------------------ |
  | `n`      | `noexec`    | コマンドを読み込むだけで実行しない。                         |
  | `e`      | `errexit`   | コマンドが1つでもエラーになったら、直ちにシェルを終了する。  |
  | `u`      | `nounset`   | パラメーター展開中に、設定していない変数があったらエラーとする。 |
  | `c`      | `noclobber` | リダイレクトで既存のファイルを上書きしない。                 |
  | `x`      | `xtrace`    | 実際に実行されたコマンドを表示する。                         |
  | `v`      | `verbose`   | 書いたままのコマンドを表示する。                             |

### bash

- `bash`コマンドでも、シェルオプションを有効・無効にしてスクリプトを実行できる。

- 書式1

  ```bash
  bash -o|+o シェルオプション [ファイル名]
  ```

- 書式2

  ```bash
  bash -|+シェルオプション一文字 [ファイル名]
  ```
