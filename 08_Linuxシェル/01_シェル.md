# シェル

## 使用するシェル

### 概要

- `/etc/shells`で、使用可能なシェル一覧を確認できる。
- 環境変数`SHELL`で、デフォルトのシェルを確認できることもあるが、あまり信頼できない。
- `/etc/passwd`でも、デフォルトのシェルを確認できる。

### chsh

- `chsh`コマンドで、デフォルトのシェルを変更できる。

  ```bash
  chsh [ユーザー（省略時はカレントユーザー）]
  ```

## ショートカット

### 概要

- [bashで覚えておきたいショートカットキー(キーバインド) | 俺的備忘録 〜なんかいろいろ〜](https://orebibou.com/ja/home/201506/20150629_001/)

### 検索系

- 「Ctrl + R」で、インクリメンタル検索を行う・選択肢を進める。
- 「Ctrl + S」で、インクリメンタル検索の選択肢を戻る。
- 通常では「Ctrl + S」がスクリーンロックに割り当てられているので、以下のようにして解除する必要がある。

  ```bash
  stty stop undef
  ```

### 処理系

- 「Ctrl + C」で、処理をキャンセルする。
- 「Ctrl + D」で、入力の終わりを示す。入力中の文字が存在しなければ終了する。
- 「Ctrl + Z」で、処理を一時中断する。

### スクリーンロック系

- 「Ctrl + S」で、スクリーンロックを行う。
- 「Ctrl + Q」で、スクリーンロックを解除する。

## Bash設定

### プロンプト

- 環境変数`PS1`で、プロンプトを設定できる。（デフォルトは`\h:\W \u\$`）
- 環境変数`PS2`で、セカンダリプロンプト（2行目以降のプロンプト）を設定できる。
- 使える表現
  - `\D{フォーマット}`で、日時をフォーマット付きで指定できる。
  - `\[\e[フォントの数値;色の数値m\]着色したい文字列\[\e[m\]`で、文字列の色を変えられる。
    （例：`\[\e[1;33m\]文字列\[\e[m\]`）
  - `$(コマンド)`で、コマンドの結果を挿入できる。
- [ターミナルプロンプトの表示・色の変更 - Qiita](https://qiita.com/hmmrjn/items/60d2a64c9e5bf7c0fe60)

### 設定ファイル

- [【初心者向け】エイリアスの設定方法 - Qiita](https://qiita.com/yutat93/items/b5bb9c0366f21bcbea62)
- [本当に正しい .bashrc と .bash_profile の使ひ分け - Qiita](https://qiita.com/magicant/items/d3bb7ea1192e63fba850)
- [bashの.profileや.bashrc等を実行する動作仕様 - sgryjp.log](https://blog.sgry.jp/entry/2019/11/09/232927)
- 種類

  ファイル|読み込みタイミング|用途
    ---|---|---
  `/etc/profile`|ログイン時|基本的な環境変数の設定
  `/etc/bashrc`（RedHat系）<br>`/etc/bash.bashrc`（Debian系）|対話的シェル起動時|
  `~/.bash_profile`<br>`~/.bash_login`<br>`~/.profile`|ログイン時|環境変数の設定
  `~/.bashrc`|対話的シェル起動時|エイリアスの設定、bashオプションの設定
  `~/.bash_logout`|ログアウト時|
  
- Linuxディストリビューションによって、読み込まれ方は異なる。
- `~/.bash_profile`から`~/.bash_rc`を読み込むよう記述することもある。

  ```bash
  if [ -f ~/.bashrc ]; then
    . ~/.bashrc
  fi
  ```

### PROMPT_COMMAND

- 環境変数`PROMPT_COMMAND`には、プロンプトを出す前に実行するコマンドを指定する。

## シェルオプション

### set -o|+o

- `set -o`コマンドは、現在のシェルオプションの設定を表示する。

  ```bash
  set -o
  ```

- `set +o`コマンドは、現在のシェルオプションの設定にするためのコマンドを表示する。

  ```bash
  set +o
  ```

### set -o|+o シェルオプション

- `set -o シェルオプション`コマンドは、シェルオプションを有効にする。
- `set +o シェルオプション`コマンドは、シェルオプションを無効にする。
- 書式1

  ```bash
  set -o|+o シェルオプション
  ```

- 書式2

  ```bash
  set -|+シェルオプション一文字
  ```

### シェルオプション一覧

- `-e, errexit`で、コマンドが1つでもエラーになったら、直ちにシェルを終了する。
- `-u, nounset`で、パラメーター展開中に、設定していない変数があったらエラーとする。
- `-c, noclobber`で、リダイレクトで既存のファイルを上書きしない。
- `-x, xtrace`で、実際に実行されたコマンドを表示する。
- `-v, verbose`で、書いたままのコマンドを表示する。
- `-n, noexec`で、コマンドを読み込むだけで実行しないようにする。

### bash

- `bash`コマンドでも、シェルオプションを有効・無効にしてスクリプトを実行できる。

- 書式1

  ```bash
  bash -o|+o シェルオプション [ファイル名]
  ```

- 書式2

  ```bash
  bash -|+シェルオプション一文字 [ファイル名]
  ```
