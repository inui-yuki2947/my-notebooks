# 変数

## 共通

### 変数の種類

- 変数の種類

| 変数         | 概要                                                         |
| ------------ | ------------------------------------------------------------ |
| 環境変数     | カレントシェル・サブシェル、及び**子プロセス**で有効である。 |
| シェル変数   | カレントシェル・サブシェルの中で有効である。                 |
| ローカル変数 | それを定義した関数、及び**その関数から呼び出した関数**で有効である。 |

- [Bashの変数スコープについてのメモ - Qiita](https://qiita.com/kurukuruz/items/77b329f1c2e5e645de58)

- [シェル変数と環境変数の違い - 座敷牢日誌](https://zashikiro.hateblo.jp/entry/2017/03/31/001900)

### set, declare

- コマンド

| コマンド         | 概要                                         |
| ---------------- | -------------------------------------------- |
| `set`, `declare` | 環境変数・シェル変数・関数の一覧を表示する。 |

- オプション（`declare`）

| オプション    | 概要                                     |
| ------------- | ---------------------------------------- |
| `-p [変数名]` | （指定した）シェル変数のみ表示する。     |
| `-f [関数名]` | （指定した）関数の名前と内容を表示する。 |
| `-F [関数名]` | （指定した）関数の名前のみ表示する。     |

### unset

- コマンド

| コマンド               | 概要                   |
| ---------------------- | ---------------------- |
| `unset 変数名や関数名` | 変数や関数を削除する。 |

## 環境変数

### env, printenv

- コマンド

| コマンド                     | 概要                                                        |
| ---------------------------- | ----------------------------------------------------------- |
| `env`, `printenv`            | 環境変数の一覧を表示する。                                  |
| `printenv 環境変数名`        | 指定した環境変数を表示する。                                |
| `[env] 環境変数=値 コマンド` | その1回だけで有効な環境変数を作成して、コマンドを実行する。 |

- [printenv、env、set、exportコマンドの違いに関して](http://tooljp.com/windows/chigai/html/Linux/printenv-env-set-export-chigai.html)

### export

- コマンド

| コマンド             | 概要                                    |
| -------------------- | --------------------------------------- |
| `export`             | 環境変数の一覧を、declare文で表示する。 |
| `export 変数名[=値]` | 環境変数を作成する。                    |

### よく使う環境変数

- よく使う環境変数

| 環境変数 | 概要                                                         | デフォルト値                 |
| -------- | ------------------------------------------------------------ | ---------------------------- |
| `IFS`    | 「Internal Filed Separator」の略で、シェルの**区切り文字**。 | 半角スペース・タブ・改行文字 |
| `RANDOM` | `0 ~ 32767`の範囲のランダムな数値。                          |                              |

## シェル変数

### declare, readonly, local

- コマンド

| コマンド                                             | 概要                                 |
| ---------------------------------------------------- | ------------------------------------ |
| `変数名=値`<br />`declare 変数名[=値]`               | シェル変数を作成する。               |
| `declare -r 変数名[=値]`<br />`readonly 変数名[=値]` | 読み取り専用のシェル変数を作成する。 |
| `local 変数名[=値]`                                  | ローカル変数を作成する。             |

## 配列・連想配列

### 作成

- コマンド

|コマンド|概要|
|---|---|
|`変数名=(値1 値2 ...)`|配列の変数を定義する。|
|`変数名=([キー1]=値1 [キー2]=値2 ...)`|連想配列の変数を定義する。|
|`declare -a 変数名[=内容]`|配列の変数を定義する。|
|`declare -A 変数名[=内容]`|連想配列の変数を定義する。|

### 代入

- コマンド

| コマンド                  | 概要                     |
| ------------------------- | ------------------------ |
| `変数名[インデックス]=値` | 配列要素に代入する。     |
| `変数名[キー]=値`         | 連想配列要素に代入する。 |

### 取得

- 記法

| 記法                      | 概要                                   |
| ------------------------- | -------------------------------------- |
| `$変数名`                 | インデックス0の要素                    |
| `${変数名[インデックス]}` | 指定したインデックスの要素             |
| `${変数名[@]}`            | 全ての要素をスペースで連結した文字列   |
| `${変数名[*]}`            | 全ての要素を区切り文字で連結した文字列 |
| `${#変数名[@]}`           | 要素数                                 |
| `${!変数名[@]}`           | インデックス一覧                       |

## 特殊変数

### 概要

- 記法（位置パラメータ）

| 記法         | 概要                                                         |
| ------------ | ------------------------------------------------------------ |
| `$n`, `${n}` | n番目の引数<br />10個目以降は`${10}`のように記述する必要がある。 |
| `$#`         | 引数の数                                                     |
| `$@`         | 引数をスペースで連結した文字列                               |
| `$*`         | 引数を区切り文字で連結した文字列                             |

- 記法（その他特殊変数）

| 記法 | 概要                                       |
| ---- | ------------------------------------------ |
| `$0` | 起動したシェルスクリプトの名前             |
| `$?` | 直前に実行したコマンドの終了ステータス     |
| `$$` | 現在のシェルのプロセスID                   |
| `$!` | バックグラウンドで実行した直前のプロセスID |

### set, shift

- コマンド

| コマンド                        | 概要                               |
| ------------------------------- | ---------------------------------- |
| `set 引数...`                   | 位置パラメータを上書き設定する。   |
| `shift [ずらす数（省略時は1）]` | 位置パラメータの番号を前にずらす。 |

### getopts

- コマンド

| コマンド                                          | 概要                                                         |
| ------------------------------------------------- | ------------------------------------------------------------ |
| `getopts 短いオプションとなる文字列 代入先の変数` | 呼び出す度に位置パラメータを順に解析し、解析結果を変数に代入する。 |

- 環境変数

| 環境変数 | 概要                                                         |
| -------- | ------------------------------------------------------------ |
| `OPTIND` | 次に解析を行うインデックス（1始まり）                        |
| `OPTARG` | オプション引数<br />（短いオプション文字の後に`:`をつけた場合に代入される） |

- オプションが見つからない場合は、終了ステータス`1` を返す。

- 不正なオプションが指定された、あるいはオプション引数が必要なのに指定されなかった場合は、変数に`?` が代入される。

- 例

  ```bash
  while getopts ab: opt; do
    case $opt in
      a) 処理1;;
      b) 処理2;;
      *) exit 1;;
    esac
  done
  shift $((OPTIND - 1))
  ```

### getopt

- コマンド

| コマンド                                            | 概要                                                   |
| --------------------------------------------------- | ------------------------------------------------------ |
| `getopt [-o] 短いオプション文字列 解析したい文字列` | 文字列を解析し、オプション・引数に分けて標準出力する。 |

- 短いオプション文字の後に`:`をつけると、引数を取るオプションとして解析する。

- 例

  ```bash
  getopt ab:c -a -b hoge -c fuga
  ```

- `getopt`は高機能であるが外部コマンドであるため、環境を選ばず利用したい場合は`getopts`を利用するとよい。
