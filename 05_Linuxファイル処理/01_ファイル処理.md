# ファイル処理

## 一覧表示

### ls

- `ls`コマンドは、ファイルの一覧を表示する。

  ```bash
  ls [ファイルまたはディレクトリ...]
  ```

- `-a`オプションで、隠しファイルを表示する。
- `-A`オプションで、隠しファイルを表示する。（`.`及び`..`を除く）
- `-d`オプションで、ディレクトリ自体の情報を表示する。
- `-l`オプションで、ファイルの詳細を表示する。

### find

- `find`コマンドは、ファイル・ディレクトリを検索する。

  ```bash
  find 検索対象パス [検索式]
  ```

- ファイル系検索式
  - `-name ファイル名`で、ファイル名により検索する。
  - `-type ファイルタイプ`で、ファイルタイプを指定できる。
- タイムスタンプ系検索式
  - `-atime 日数`で、指定された日時より前に、最終アクセスされたものを検索する。
  - `-ctime 日数`で、指定された日時より前に、何らかの変更がなされたものを検索する。
  - `-mtime 日数`で、指定された日時より前に、ファイル内容の変更がなされたものを検索する。
- その他検索式
  - `-a, -and, -o, -or`で、条件を複数指定できる。また丸括弧で評価順を変更できる。
  - `-print`で、見つけたファイルをフルパスで出力する。（デフォルト）
  - `-print0`で、区切り文字をヌル文字にして出力する。（結果をxargsに渡すときなどに使う）
  - `-depth|-maxdepth|-mindepth 深さ`で、検索するディレクトリの深さ（の最大・最小）を指定できる。
  - `-exec コマンド \;`で、見つけたファイルを引数としてコマンドを実行する（引数を入れる箇所に`{}`を指定する）

### locate

- `locate`コマンドは、あらかじめ作成されたDBに基づいて、高速にファイルを検索する。

  ```bash
  locate 検索パターン
  ```

### updatedb

- `updatedb`コマンドは、`locate`コマンドで使うDBを更新する。

  ```bash
  updatedb
  ```

- 多くのディストリビューションでは、cronで定期的に実行される。
- `/etc/updatedb.conf`ファイルで、設定を変更できる。

### tree

- `tree`コマンドは、ファイルやディレクトリをツリー状に表示する。

  ```bash
  tree [ディレクトリ]
  ```

- Macではインストールが必要。

## 表示

### file

- `file`コマンドは、ファイルの形式を表示する。

  ```bash
  file ファイル名
  ```

### basename

- `basename`コマンドは、パスからファイル名部分を取得する。

  ```bash
  basename パス
  ```

- 2番目の引数を指定すると、接尾辞を除いて出力する。

  ```bash
  basename パス 接尾辞
  ```

### dirname

- `dirname`コマンドは、パスからディレクトリ名部分（末尾スラッシュを除く）を取得する。

  ```bash
  dirname パス
  ```

## 作成・削除

### touch

- `touch`コマンドは、ファイルのタイムスタンプを変更する。

  ```bash
  touch ファイル...
  ```

- `-t 日時`オプションで、タイムスタンプを指定できる。
  - 形式：`[[CC]YY]MMDDhhmm[.ss]`

### rm

- `rm`コマンドは、ファイルを削除する。（通常はディレクトリを削除できない）

  ```bash
  rm ファイル...
  ```

- `-r, -R, --recursive`オプションで、ディレクトリを再帰的に削除する。

### mkdir, rmdir

- `mkdir`コマンドは、空のディレクトリを作成する。

  ```bash
  mkdir ディレクトリ名
  ```

- `rmdir`コマンドは、**空の**ディレクトリを削除する。

  ```bash
  rmdir ディレクトリ名
  ```

- `-p, --parents`オプション
  - 必要に応じて親ディレクトリも作成・削除できる。
  - ディレクトリが既に存在する場合でも、エラーを吐かなくなる。
- `-m, -mode モード`オプションで、作成するディレクトリの権限を指定できる。

### mktemp

- `mktemp`コマンドは、適当な名前の空ファイルを作成する。

  ```bash
  mktemp テンプレート文字列
  ```

- `-d`オプションで、ファイルではなくディレクトリを作成する。

## 移動・コピー

### mv

- `mv`コマンドは、ファイルを移動またはリネームする。

  ```bash
  mv 移動元 移動先
  ```

- 上書き系オプション（いずれか一つのみ有効）
  - `-f, --force`オプションで、移動先に同名ファイルがあった場合に、上書きする。（デフォルト）
  - `-i, --interactive`オプションで、移動先に同名ファイルがあった場合に、確認する。
  - `-n, --no-clobber`オプションで、移動先に同名ファイルがあった場合に、上書きしない。
- 移動元・移動先の両方がディレクトリの場合
  - 移動先ディレクトリが存在しない場合は、**ディレクトリのリネーム**となる。
  - 移動先ディレクトリが存在する場合は、**その中に移動**となる。
  - 移動元・移動先に同名のディレクトリを指定すると、（`ディレクトリ名/ディレクトリ名`に移動しようとして）エラーとなる。

### rename

- `rename`コマンドは、ファイルを（まとめて）リネームする。

  ```bash
  rename s/置換前/置換後/ [ファイル名...]
  ```

- Macではインストールが必要。
- パスに含まれるディレクトリ名も、置換対象に含まれる。

### cp

- `cp`コマンドは、ファイルをコピーする。

  ```bash
  cp [コピー元...] コピー先
  ```

- `-r`オプションで、ディレクトリをコピーできる。
- `-p`オプションで、ファイルのパーミッション・所有者・タイムスタンプを保ったままコピーする。

### scp

- `scp`コマンドは、リモートでファイルをコピーする。

  ```bash
  scp コピー元 コピー先
  ```

- リモートのファイルをローカルにコピーする場合

  ```bash
  scp user@xxx.xxx.xxx.xxx:~/test.txt ./
  ```

### rsync

- `rsync`コマンドは、賢い`scp`コマンド。
- `--update`オプションで、更新日時が新しいものを優先した上でコピーが行われる。
- `--times`オプションで、更新日時をコピー元と同じにすることができる。
- `--delete`オプションで、コピー先にしかないファイルを削除できる。

## リンク

### ハードリンクとソフトリンク

|項目|リンク先|元のパスが変わると|ディレクトリへのリンク|別のファイルシステムへのリンク|パーミッションの表示|
|---|---|---|---|---|---|
|ハードリンク|iノード|影響はない|作成できない|作成できない|オリジナルと同じ|
|ソフトリンク（シンボリックリンク）|ファイルパス|アクセスできなくなる|作成できる|作成できる|デフォルト（実際にはオリジナルが適用）|

### ln

- `ln`コマンドは、リンクを作成する。

  ```bash
  ln オリジナル リンク名
  ```

- デフォルトではハードリンクを作成するが、`-s`オプションでシンボリックリンクを作成する。

- `-f|--force`オプションで、リンクファイルと同じ名前のファイルがあっても、強制的に上書きする。

### その他

- `ls`コマンドで、ハードリンクが作成されている数を確認できる。
- `ls -i`コマンドで、iノード番号を確認できる。
- `cp`コマンドは、シンボリックリンクのリンク元をコピーするが、
  `-d`オプションで、シンボリックリンク自体をコピーできる。

## 容量

### iノード

- 作成できるiノードの数は、ファイルシステム作成時に設定され、あとから変更はできない。
- iノードが枯渇すると、ファイルを新規保存できなくなる。

### df

- `df`コマンドは、ファイルシステムの空き容量を表示する。

  ```bash
  df [デバイス名やディレクトリ名]
  ```

### du

- `du`コマンドは、ファイルやディレクトリが占めている容量を表示する。

  ```bash
  du [ファイル名やディレクトリ名]
  ```

- 表示系オプション
  - `-a`オプションで、ディレクトリだけでなく、ファイルのディスク使用量も表示する。
  - `-s`オプションで、サブディレクトリの情報を非表示にする。
  - `-S`オプションで、サブディレクトリの容量を含めない。
- 表示形式系オプション
  - `-h`オプションで、人間に分かりやすい単位で容量を表示する。
  - `-i`オプションで、空き容量の代わりに、iノードの使用状況について表示する。
