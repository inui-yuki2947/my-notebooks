# MySQL/ストアドプログラム/トリガー

## CREATE, DROP, SHOW TRIGGER(S)

| 書式                                                         | 概要                         |
| ------------------------------------------------------------ | ---------------------------- |
| `CREATE TRIGGER トリガー名 時間 イベント ON テーブル名 FOR EACH ROW ステートメント` | トリガーを定義する。         |
| `DROP TRIGGER [IF EXISTS] [スキーマ名.]トリガー名`           | 指定したトリガーを削除する。 |
| `SHOW TRIGGERS [<FROM｜IN> スキーマ名]`                      | トリガーの一覧を表示する。   |

### オプション

| オプション  | 概要                                 |
| ----------- | ------------------------------------ |
| `IF EXISTS` | 削除対象が存在する場合のみ削除する。 |

### トリガー名

- トリガー名は、**スキーマ内**で一意である必要がある。
- トリガー名は、スネークケースが一般的？

### 時間

| 時間     | 概要                   |
| -------- | ---------------------- |
| `BEFORE` | 指定したイベントの前。 |
| `AFTER`  | 指定したイベントの後。 |

- `BEFORE`トリガーが失敗した場合、その後の操作は実行されない。
- 時間・イベントが同じトリガーは、複数定義できない。

### イベント

| イベント | 概要     |
| -------- | -------- |
| `INSERT` | 作成時。 |
| `UPDATE` | 更新時。 |
| `DELETE` | 削除時。 |

### 変数

| 変数           | 概要                                 | INSERT | UPDATE | DELETE | I/O  |
| -------------- | ------------------------------------ | ------ | ------ | ------ | ---- |
| `OLD.カラム名` | 古いレコードの、指定したカラムの値。 | ☓      | ○      | ○      | O    |
| `NEW.カラム名` | 新しいレコードの、指定したカラム値。 | ○      | ○      | ☓      | I/O  |

- `BEFORE INSERT`では、`AUTO_INCREMENT`カラムの値は`0`となっている。

### 参考資料

- [MySQL :: MySQL 5.6 リファレンスマニュアル :: 20.3 トリガーの使用](https://dev.mysql.com/doc/refman/5.6/ja/triggers.html)
