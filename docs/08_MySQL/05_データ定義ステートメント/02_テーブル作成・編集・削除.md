# MySQL/データ定義ステートメント/テーブル作成・編集・削除

## CREATE, ALTER, RENAME, DROP TABLE

### 書式

| 書式                                                         | 概要                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| `CREATE [TEMPORARY] TABLE [IF NOT EXISTS] テーブル名 (作成定義1, ...) [テーブルオプション1, ...]` | テーブル定義を記述して、テーブルを作成する。                 |
| `CREATE [TEMPORARY] TABLE [IF NOT EXISTS] テーブル名 [テーブルオプション1, ...] クエリ` | クエリから、テーブルを作成する。                             |
| `CREATE [TEMPORARY] TABLE [IF NOT EXISTS] テーブル名 LIKE 既存テーブル名` | 既存テーブルをもとに、テーブルを作成する。                   |
| `ALTER TABLE テーブル名 (変更定義1, ..., テーブルオプション1, ...)` | 指定したテーブルの構造を変更する。                           |
| `RENAME TABLE <テーブル名 TO 新しいテーブル名>, ...`         | 指定したテーブルの名前を変更する。                           |
| `DROP [TEMPORARY] TABLE [IF EXISTS] テーブル名, ...`         | 指定したテーブルを削除する。<br />外部キー制約で参照されている場合は、削除することはできない。 |

### オプション

| オプション      | 概要                                               |
| --------------- | -------------------------------------------------- |
| `TEMPORARY`     | 一時テーブルについて操作する。                     |
| `IF NOT EXISTS` | テーブルが存在しない場合のみ、テーブルを作成する。 |
| `IF EXISTS`     | テーブルが存在する場合のみ削除する。               |

### 作成定義

| 作成定義              | 概要               |
| --------------------- | ------------------ |
| `カラム名 カラム定義` | カラムを定義する。 |
| `制約定義`            | 制約を定義する。   |

### 変更定義

| 分類     | 変更定義                                                     | 概要                                   |
| -------- | ------------------------------------------------------------ | -------------------------------------- |
| カラム系 | `ADD [COLUMN] カラム名 カラム定義 [挿入位置]`                | 指定したカラムを追加する。             |
| カラム系 | `MODIFY [COLUMN] カラム名 カラム定義 [挿入位置]`             | 指定したカラムの定義を変更する。       |
| カラム系 | `CHANGE [COLUMN] カラム名 新しいカラム名 カラム定義 [挿入位置]` | 指定したカラムの名前と定義を変更する。 |
| カラム系 | `DROP [COLUMN] カラム名`                                     | 指定したカラムを削除する。             |
| 制約系   | `ADD 制約定義`                                               | 制約を追加する。                       |
| 制約系   | `DROP PRIMARY KEY`                                           | 主キー制約を削除する。                 |
| 制約系   | `DROP <INDEX｜KEY> インデックス名`                           | ユニーク制約・インデックスを削除する。 |
| 制約系   | `DROP FOREIGN KEY インデックス名`                            | 外部キー制約を削除する。               |

- 外部キー制約のあるカラムを削除する、またはそのインデックスを削除する場合は、先に外部キー制約を削除する必要がある。

### 挿入位置

| 挿入位置         | 概要                                     |
| ---------------- | ---------------------------------------- |
| なし             | テーブルの最後にカラムを配置する。       |
| `FIRST`          | テーブルの最初にカラムを配置する。       |
| `AFTER カラム名` | 指定したカラムの後ろにカラムを配置する。 |

### カラム定義

| カラム定義                   | 概要                                                         |
| ---------------------------- | ------------------------------------------------------------ |
| `型`                         | 型を指定する。（必須）                                       |
| `[GENERATED ALWAYS] AS (式)` | 指定した式によるGenerated Columnとする。<br />Generated Columnは、`AUTO_INCREMENT`カラムの参照はできない。 |
| `NOT NULL`<br />`NULL`       | NOT NULLまたはNULLとする。                                   |
| `DEFAULT デフォルト値`       | デフォルト値を設定する。                                     |
| `AUTO_INCREMENT`             | AUTO_INCREMENTを設定する。                                   |
| `UNIQUE [KEY]`               | ユニークにする。                                             |
| `[PRIMARY] KEY`              | 主キーにする。                                               |
| `COMMENT 文字列`             | コメントを設定する。                                         |

### 制約定義

| 作成定義                                                     | 概要                     |
| ------------------------------------------------------------ | ------------------------ |
| `[CONSTRAINT [シンボル]] PRIMARY KEY (カラム名1, ...)`       | 主キー制約を定義する。   |
| `[CONSTRAINT [シンボル]] UNIQUE [INDEX｜KEY] [インデックス名] (カラム名1, ...)` | ユニーク制約を定義する。 |
| `[CONSTRAINT [シンボル]] FOREIGN KEY [インデックス名] (カラム名1, ...) REFERENCES テーブル名(カラム名1, ...)` | 外部キー制約を定義する。 |
| `<INDEX｜KEY> [インデックス名] (カラム名1, ...)`             | インデックスを定義する。 |

- 主キー制約は、ユニーク制約をテーブルに一つしか設定できないようにしたもの。（どちらかのみ設定すればよい）
- MySQL 8.0から、逆順インデックスがサポートされた。

### テーブルオプション

| テーブルオプション      | 概要                           |
| ----------------------- | ------------------------------ |
| `AUTO_INCREMENT [=] 値` | AUTO_INCREMENTの値を設定する。 |
| `COMMENT [=] 文字列`    | コメントを設定する。           |

### 参考資料

- [MySQL :: MySQL 5.6 リファレンスマニュアル :: 13.1.17 CREATE TABLE 構文](https://dev.mysql.com/doc/refman/5.6/ja/create-table.html)
- [MySQL :: MySQL 5.6 リファレンスマニュアル :: 13.1.7 ALTER TABLE 構文](https://dev.mysql.com/doc/refman/5.6/ja/alter-table.html)
- [MySQL :: MySQL 8.0 リファレンスマニュアル :: 13.1.32 DROP TABLE ステートメント](https://dev.mysql.com/doc/refman/8.0/ja/drop-table.html)

## CREATE, DROP INDEX

### 書式

| 書式                                                         | 概要                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| `CREATE [UNIQUE] INDEX インデックス名 ON テーブル名(カラム名1, ...)` | 指定したテーブルのカラムに、インデックス（主キー制約）を追加する。<br />（`ALTER TABLE`と同等） |
| `DROP INDEX インデックス名 ON テーブル名`                    | 指定したテーブルのカラムから、インデックス（主キー制約）を削除する。<br />（`ALTER TABLE`と同等） |

## TRUNCATE TABLE

### 書式

| 書式                          | 概要                                       |
| ----------------------------- | ------------------------------------------ |
| `TRUNCATE [TABLE] テーブル名` | 指定したテーブルを**削除して再作成**する。 |

- ロールバックなどはできないが、DELETE文より高速である。
