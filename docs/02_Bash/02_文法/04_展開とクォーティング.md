# Bash/文法/展開とクォーティング

## クォーティング

### 記法

| 記法                          | 特殊文字の扱い                      | エスケープシーケンス | 単語分割     |
| ----------------------------- | ----------------------------------- | -------------------- | ------------ |
| `文字列`                      | 特殊文字として扱われる。※1          | 解釈されない。       | 行われる。   |
| `"文字列"`                    | ``$, `, \``以外エスケープされる。※1 | 解釈されない。       | 行われない。 |
| `'文字列'`                    | 全てエスケープされる。※2            | 解釈されない。       | 行われない。 |
| `$'文字列'`（ANSI-C Quoting） | 全てエスケープされる。※2            | 解釈される。         | 行われない。 |

- ※1 特殊文字を出力したい場合は、`\特殊文字`と入力する。
- ※2 `'`を出力したい場合は、以下のように一旦クォーテーションを終了させる。

  - `'文字列1'"'"'文字列2'`
  - `'文字列1'\''文字列2'`

### その他

- 信頼できない変数（下記など）を参照する場合は、単語分割やパス名展開を防ぐため、またセキュリティ対策のため、**`""`で囲んでおく**。
  - 外側から渡される引数
  - 環境変数
  - コマンドの実行結果

### 参考資料

- [メタキャラクタ](http://itdoc.hitachi.co.jp/manuals/3020/30203S3530/JPAS0125.HTM)
- [Bashの文字列で特殊文字を使う方法 - プログラミング雑ネタ集](https://azisava.sakura.ne.jp/programming/0010.html)

## 特殊文字

### 概要

- 特殊文字は、``|　&　;　<　>　(　)　$　`　'　\　"　~　#　*　[　]　?``の18種類。

## エスケープシーケンス

### 概要

- エスケープシーケンスとは、特殊な文字や機能を、特別な**文字の並び**により表したもの。（エスケープ文字`\`とは異なる）

### 記法

| 記法              | 概要                  |
| ----------------- | --------------------- |
| `\a`              | 警告音                |
| `\e`, `\E`        | エスケープ文字        |
| `\n`              | 改行                  |
| `\t`              | タブ文字              |
| `\数字8ビット3桁` | 当該8ビット数字の文字 |

### 参考資料

- [ANSI-C Quoting (Bash Reference Manual)](https://www.gnu.org/software/bash/manual/html_node/ANSI_002dC-Quoting.html)

## パス名展開

### 概要

- パス名展開では、メタキャラクタを**ファイル名**に置き換える。

### 記法

| 記法                     | 概要                     | 例                 |
| ------------------------ | ------------------------ | ------------------ |
| `*`                      | 任意の0文字以上          | `echo file_*`      |
| `?`                      | 任意の1文字              | `echo file_?`      |
| `[文字1文字2...]`        | 指定した文字のいずれか   | `echo file_[abc]`  |
| `[文字1-文字2]`          | 文字1から文字2までの文字 | `echo file_[a-z]`  |
| `[^文字]`<br />`[!文字]` | 指定した文字以外の文字   | `echo file_[^abc]` |

## チルダ展開

### 記法

| 記法          | 概要                                         |
| ------------- | -------------------------------------------- |
| `~` | カレントユーザーのホームディレクトリに展開する。 |
| `~ユーザー名` | 指定ユーザーのホームディレクトリに展開する。 |

### その他

- クォーテーション内でホームディレクトリを記述したい場合は、環境変数`HOME`を使うとよい。

## ブレース展開

### 記法

| 記法                    | 概要                                                   | 例                            |
| ----------------------- | ------------------------------------------------------ | ----------------------------- |
| `{文字列1,文字列2,...}` | 各文字列に展開する。                                   | `touch file_{hoge,fuga,piyo}` |
| `{文字列1..文字列2}`    | 文字列1から文字列2までの文字列に展開する。（逆順も可） | `touch file_{1..10}`          |

## パラメータ展開

### 記法

| 記法                       | 概要                                              |
| -------------------------- | ------------------------------------------------- |
| `${変数名:-デフォルト値}`  | デフォルト値を設定する。                          |
| `${変数名:n:m}`            | 変数のn文字目からm文字目まで切り出す。（0始まり） |
| `${変数名#文字列}`         | 変数の一部分を、**前方最短一致**で取り除く。      |
| `${変数名##文字列}`        | 変数の一部分を、**前方最長一致**で取り除く。      |
| `${変数名%文字列}`         | 変数の一部分を、**後方最短一致**で取り除く。      |
| `${変数名%%文字列}`        | 変数の一部分を、**後方最長一致**で取り除く。      |
| `${変数名/置換前/置換後}`  | 変数を置換する。                                  |
| `${変数名//置換前/置換後}` | 変数を複数回置換する。                            |

### 参考資料

- [【シェル芸人への道】Bashの変数展開と真摯に向き合う - Qiita](https://qiita.com/t_nakayama0714/items/80b4c94de43643f4be51#parameterpattern-%E5%A4%A7%E6%96%87%E5%AD%97%E5%8C%96)

## プロセス置換

### 記法

| 記法          | 概要                                                         | 例                      |
| ------------- | ------------------------------------------------------------ | ----------------------- |
| `<(コマンド)` | コマンド結果を自動的にファイルとして作成し、その**ファイル名**に展開される。 | `diff <(ls .) <(ls ..)` |

## 履歴展開

### 記法

| 記法                | 概要                             |
| ------------------- | -------------------------------- |
| `!コマンド履歴番号` | コマンド履歴の当該番号           |
| `!!`                | 直前のコマンド                   |
| `!文字列`           | 当該文字列で始まる最後のコマンド |

### その他

- 履歴展開は、対話的シェルでのみ行われる。
