# Git/GitHub Actions/文法

## 表現式

### 記法

| 記法          | 概要                                                         | 例                                                           |
| ------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| `${{ 表現 }}` | 指定した表現を評価した値。<br />表現としては、リテラル値・関数・コンテキストが使用可能。 | `${{ false }}`<br />`${{ 711 }}`<br />`${{ 'It''s open source!' }}` |

- `if`条件の中では、`${{ }}`は省略可能。

### 参考資料

- [Expressions - GitHub Docs](https://docs.github.com/en/actions/learn-github-actions/expressions)

## 関数

### 記法（基本）

| 記法                           | 概要                                                         |
| ------------------------------ | ------------------------------------------------------------ |
| `contains(検索対象, 検索要素)` | 検索対象の中に検索要素が含まれているか。<br />（配列の場合は要素として、文字列の場合は文字列の一部として） |
| `toJSON(値)`                   | 値をJSON文字列に変換したもの。                               |

### 記法（ステータスチェック系）

| 記法        | 概要                                                         |
| ----------- | ------------------------------------------------------------ |
| `success()` | 以前のステップの全てが、成功（失敗・キャンセル以外）であるか。 |
| `failure()` | 以前のステップのいずれかが、失敗・キャンセルであるか。       |

- ステータスチェック関数は、`if`条件の中でのみ使用可能。

## コンテキスト

### 記法（github）

| 記法              | 型             | 概要                                                         |
| ----------------- | -------------- | ------------------------------------------------------------ |
| `github`          | オブジェクト型 | ワークフロー実行・イベントに関する情報。                     |
| `github.ref`      | 文字列型       | ワークフローが実行されたブランチまたはタグのref。            |
| `github.ref_name` | 文字列型       | ワークフローが実行されたブランチまたはタグの名前。           |
| `github.base_ref` | 文字列型       | 当該ブランチの`base_ref`。<br />（`pull_request`, `pull_request_target`イベントでのみ使用可能） |
| `github.head_ref` | 文字列型       | 当該ブランチの`head_ref`。<br />（`pull_request`, `pull_request_target`イベントでのみ使用可能） |
| `github.event`    | オブジェクト型 | イベントに関する情報。                                       |

### 記法（env）

| 記法             | 型             | 概要                   |
| ---------------- | -------------- | ---------------------- |
| `env`            | オブジェクト型 | 環境変数に関する情報。 |
| `env.環境変数名` | 文字列型       | 指定した環境変数の値。 |

### 記法（secrets）

| プロパティ             | 型             | 概要                                             |
| ---------------------- | -------------- | ------------------------------------------------ |
| `secrets`              | オブジェクト型 | シークレット情報。                               |
| `secrets.GITHUB_TOKEN` | 文字列型       | 各ワークフローで自動的に生成されたトークンの値。 |
| `secrets.名前`         | 文字列型       | 指定したシークレット情報の値。                   |

- 「リポジトリのSettings -> Secrets -> Actions」でシークレット情報を登録すると、当該リポジトリでそのシークレット情報を使用できる。

### 記法（その他）

| 記法    | 型             | 概要                   |
| ------- | -------------- | ---------------------- |
| `job`   | オブジェクト型 | ジョブに関する情報。   |
| `steps` | オブジェクト型 | ステップに関する情報。 |

### コンテキストと環境変数

| 種類         | 評価タイミング           | 使い時                           |
| ------------ | ------------------------ | -------------------------------- |
| コンテキスト | 仮想マシンに送られる前。 | `if`条件で使用したい場合など。   |
| 環境変数     | 仮想マシンでの実行時。   | コマンド内で使用したい場合など。 |

- [Environment variables - GitHub Docs](https://docs.github.com/en/actions/learn-github-actions/environment-variables#using-contexts-to-access-environment-variable-values)

### 参考資料

- [Contexts - GitHub Docs](https://docs.github.com/en/actions/learn-github-actions/contexts)
