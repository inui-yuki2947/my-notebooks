# テキスト/JSON,YAML/jq表現

## 共通

### 書式

| 書式                               | 概要                                                         |
| -------------------------------------- | ------------------------------------------------------------ |
| `.`                                    | ルートの値を出力する。                                       |
| `オブジェクト.プロパティ名` ※1<br />`オブジェクト.["プロパティ名"]` ※1 | オブジェクトのプロパティの値を出力する。<br />（見つからない場合は`null`）     |
| `配列.[インデックス]`                 | 配列のインデックス（0始まり）の要素を出力する。<br />（見つからない場合は`null`） |
| `配列またはオブジェクト[]` ※1           | 配列の全ての要素、またはオブジェクトの全ての値について、別の行で出力する。 |
| `配列またはオブジェクト[]jq表現` ※1 | 配列の全ての要素、またはオブジェクトの全ての値について、jq表現を実行する。 |
| `jq表現1, jq表現2` | それぞれのjq表現を、別の行で出力する。 |
| `jq表現1 ｜ jq表現2` | jq表現1の出力の各行について、jq表現2を実行する。 |

- jq表現は、JSONで使える表現に加え、上記の特有の表現が使用可能である。
- ※1 末尾に`?`をつけると、プロパティやインデックスが見つからない場合に、エラーを出さないようにできる。

## 型と値

### 書式

| 書式                                | 概要                         |
| ----------------------------------- | ---------------------------- |
| `[jq表現, jq表現, ...]`             | 配列形式で出力する。         |
| `{キー: jq表現, キー: jq表現, ...}` | オブジェクト形式で出力する。 |

## 組み込み演算子・関数

### 書式

| 書式               | 例                                                           | 概要                                                         |
| ------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| `to_entries`       | `{"a": 1, "b": 2} | to_entries`<br />-> `[{"key":"a", "value":1}, {"key":"b", "value":2}]` | オブジェクトをキーバリュー型の配列に変換して出力する。       |
| `from_entries`     | `[{"key":"a", "value":1}, {"key":"b", "value":2}] | to_entries`<br />-> `{"a": 1, "b": 2}` | キーバリュー型の配列をオブジェクトに変換して出力する。       |
| `select(表現)`     | `select(. >= 2)`                                             | 表現がtrueとなる結果を出力する。                             |
| `keys`             |                                                              | オブジェクトのキーの配列を出力する。                         |
| `length`           |                                                              | 文字列の長さ、配列の要素数、またはオブジェクトのプロパティ数を出力する。 |
| `@csv`<br />`@tsv` |                                                              | 配列を、CSVまたはTSV形式に変換する。                         |
| `split(デリミタ)`  | `"foo,baa,baz"` <br />-> `["foo","baa","baz"]`               | 文字列を、デリミタで分割して配列に変換する。                 |

## 条件と比較

### 書式

| 書式     | 概要                                                  |
| -------- | ----------------------------------------------------- |
| `a // b` | `a`が`null`または`false`である場合に、`b`を出力する。 |

## 代入

### 書式

| 書式            | 概要                                                         |
| --------------- | ------------------------------------------------------------ |
| `jq表現 ｜= 値` | 指定したjq表現に値を代入し、全ての値を返す。<br />（右辺での`.`は、左辺と同じ） |
| `jq表現 = 値`   | 指定したjq表現に値を代入し、全ての値を返す。<br />（右辺での`.`は、入力全体と同じ） |

### その他

- 代入された値は、ディープコピーされたような挙動となる。

## その他

### 書式

| 書式                | 概要                         |
| ------------------- | ---------------------------- |
| `jq表現 as $変数名` | jq表現の値を変数に代入する。 |

## 参考資料

- [とほほのjq入門 - とほほのWWW入門](https://www.tohoho-web.com/ex/jq.html)
