# MySQL/複合ステートメント/条件の処理

## 共通

### 概要

- [MySQL :: MySQL 5.6 リファレンスマニュアル :: 13.6.7 条件の処理](https://dev.mysql.com/doc/refman/5.6/ja/condition-handling.html)

## DECLARE ... CONDITION, HANDLER

### 記法

- `DECLARE ... CONDITION`文は、名前付きエラー条件を宣言する。

  ```mysql
  DECLARE コンディション名 CONDITION FOR コンディション値
  ```

- `DECLARE ... HANDLER`文は、1つ以上の条件を処理するハンドラを指定する。

  ```mysql
  DECLARE ハンドラアクション HANDLER FOR コンディション値, コンディション値, ...
      ステートメント
  ```

### ハンドラアクション

| ハンドラアクション | 概要                                                         |
| ------------------ | ------------------------------------------------------------ |
| `CONTINUE`         | 現在のプログラムの実行が続行される。                         |
| `EXIT`             | このハンドラが宣言されている`BEGIN ... END`複合ステートメントの実行が終了する。 |

### コンディション値

| 記法                          | 概要                                                       | 例                 |
| ----------------------------- | ---------------------------------------------------------- | ------------------ |
| `MySQLエラーコード`           | 番号。<br />`0`から始まる場合は成功。                      | `1051`             |
| `SQLSTATE [VALUE] SQLSTATE値` | 5文字の文字列リテラル。                                    | `SQLSTATE '42S02'` |
| `コンディション名`            | `DECLARE ... CONDITION`文で定義した名前。                  |                    |
| `SQLWARNING`                  | `01` で始まるSQLSTATE値のクラスの短縮形。                  |                    |
| `NOT FOUND`                   | `02` で始まるSQLSTATE値のクラスの短縮形。                  |                    |
| `SQLEXCEPTION`                | `00`, `01` , `02` で始まらないSQLSTATE値のクラスの短縮形。 |                    |

### SQLSTATE値

- `00`から始まる場合は成功。
- `45000`は、未処理のユーザー定義の例外。

### 例

- 全ての`SQLEXCEPTION`で続行したい場合。

  ```mysql
  DECLARE CONTINUE HANDLER
    FOR SQLWARNING
    BEGIN END
  ```

## SIGNAL, RESIGNAL

- `SIGNAL`文は、条件情報を渡す。

  ```mysql
  SIGNAL コンディション値
      [SET 条件情報 = 値, 条件情報 = 値, ...]
  ```

- `RESIGNAL`文は、条件情報を（変更してから）渡す。

  ```mysql
  RESIGNAL [コンディション値]
      [SET 条件情報 = 値, 条件情報 = 値, ...]
  ```

- `SET`句を含む場合は、エラーを変更して渡す。

- コンディション値を含む場合は、条件を現在の診断領域にプッシュする。
