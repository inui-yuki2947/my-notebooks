# Go/制御構造/制御構造

## 共通

### if文

- 書式（丸括弧は不要で、波括弧は必要）

  ```go
  if [簡易文;] 条件 {
    処理
  }
  ```

- 簡易文は、制御構文内スコープで先に実行される。

### for文

- 書式

  ```go
  for [条件] {
    処理
  }
  ```

- 条件省略時は、無限ループとなる。

### for文（範囲式）

- 書式

  ```go
  for インデックス, 要素 := range 配列等 {
    処理
  }
  ```

- 範囲式で文字列を指定する場合、インデックスは文字数でなく**コードポイント**単位となる。

- 要素を代入する変数は、**使い回される。**
  [Goのfor rangeでのポインタでハマったこと - Qiita](https://qiita.com/uchiko/items/1c611f0db618ce9dc0a9)

### 式によるswitch文

- `switch`文では、指定した式がcaseの値と等しい場合にそのcaseが実行される。

  ```go
  switch [簡易文;] [式] {
  case 値1:
    処理1
  case 値2:
    処理2
  ...
  default:
    処理
  }
  ```

- 式省略時は`true`となるため、各caseに真偽値を返す条件を書く。
- デフォルトではフォールスルー（次のcase節へ移る処理）は行われないが、`fallthrough`文で行うことができる。

### 型によるswitch文

- 型によるswitch文では、型アサーションと分岐を組み合わせた処理を記述できる。

  ```go
  switch [型変換後の値 :=] 変数.{型} {
  case 型1:
    処理1
  case 型2:
    処理2
  ...
  default:
    処理
  }
  ```

### defer

- `defer`文で、関数終了時に実行される関数呼び出しを定義できる。

  ```go
  defer 関数呼び出し
  ```

- `defer`文はいくつでも定義できるが、実行は**あとから定義された順**になされる。

### panic, recover

- `panic`関数を実行すると、（`defer`を実行後）ランタイムをエラー終了させる。
- `recover`関数は、`defer`文内で使い、ランタイムパニックによるプログラムの中断を回復する。

### go

- `go`文は、ゴルーチンを新たに作成してランタイムに追加する。

  ```go
  go 関数呼び出し
  ```

### init

- `init`関数で、`main`関数の前に実行される処理を定義できる。
- `init`関数では、引数も戻り値も定義しないようにする。
- `init`関数は複数定義でき、実行は定義した順になされる。
