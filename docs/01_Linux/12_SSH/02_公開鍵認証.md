# Linux/SSH/公開鍵認証

## ssh-keygen

### コマンド

|コマンド|概要|
|---|---|
|`ssh-keygen`|公開鍵と秘密鍵のペアを作成する。|

### オプション

|オプション|概要|
|---|---|
|`-f ファイル名`|ファイルを指定する。|
|`-p`|パスフレーズを変更する。|
|`-t 暗号化形式`|暗号化形式を指定できる。（デフォルトは`rsa`）|

- 秘密鍵のパーミッションは`600`にしておかないとエラーが出る。

## ~/.ssh/authorized_keys

### ファイル

| ファイル                 | 概要                                                         |
| ------------------------ | ------------------------------------------------------------ |
| `~/.ssh/authorized_keys` | サーバー側で、公開鍵を記載するファイル。<br />パーミッションは、`600`に設定しておくべき。 |

### 書式

```text
ssh-rsa 公開鍵1
ssh-rsa 公開鍵2
...
```

### 例

- アクセス元を制限する場合

  ```text
  from=アクセス元 ssh-rsa 公開鍵
  ```

- 実行できるコマンドを制限する場合

  ```text
  command=コマンド ssh-rsa 公開鍵
  ```

## ssh-copy-id

### コマンド

|コマンド|概要|
|---|---|
|`ssh-copy-id [ユーザー名@]接続先`|簡単に公開鍵を接続先に登録する。|

### オプション

|オプション|概要|
|---|---|
|`-i 公開鍵ファイル`|コピーする公開鍵ファイルを指定できる。|

## ssh-agent

### 概要

- ssh-agentは、パスフレーズの入力を代わりに行う。

### 起動

- ssh-agentの起動方法はいくつか存在する。
  [【SSH】ssh-agent の使い方 – ラボラジアン](https://laboradian.com/how-to-use-ssh-agent/)

  ```bash
  ssh-agent bash
  ```

### コマンド

|コマンド|概要|
|---|---|
|`ssh-add 秘密鍵ファイル`|秘密鍵を登録する。|
