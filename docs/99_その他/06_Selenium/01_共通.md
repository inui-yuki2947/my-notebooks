# その他/Selenium/共通

## 共通

### 参考資料

- [Seleniumブラウザー自動化プロジェクト | Selenium](https://www.selenium.dev/ja/documentation/)

### Selenium IDE

- Selenium IDEは、ブラウザでのアクションを記録する、ブラウザの拡張機能である。

## インストール

### 共通

- インストールには下記が必要。
  - 任意のプログラミング言語のSeleniumライブラリ
  - 任意のブラウザのブラウザドライバ

### Ruby

```bash
gem 'selenium-webdriver'
gem 'webdrivers', '~> 5.0'
```

## 初期化

### 記法

| 記法                                       | 概要                           |
| ------------------------------------------ | ------------------------------ |
| `driver = Selenium::WebDriver.for :chrome` | Chromeのセッションを開始する。 |

### オプション

| オプション            | 概要                                                         | デフォルト値 |
| --------------------- | ------------------------------------------------------------ | ------------ |
| `--user-data-dir`     | 使用するユーザープロファイルの配置ディレクトリ名。           | 一時ファイル |
| `--profile-directory` | 使用するユーザープロファイルのファイル名。<br />（`--user-data-dir`内での名前） | `Default`    |

- デフォルトでは、スクリプト実行のたびに、ユーザープロファイルが作成・破棄される。

- 例

  ```ruby
  options = Selenium::WebDriver::Chrome::Options.new
  options.add_argument('--user-data-dir=/Users/inuiyuki/Library/Application Support/Google/Chrome')
  options.add_argument('--profile-directory=Profile 1')
  driver = Selenium::WebDriver.for :chrome, options: options
  ```

- [SeleniumでChromeのプロファイルを使う | Seleniumワールド](https://selenium-world.net/selenium-tips/3519/)

## ナビゲート

### 記法

| 記法                                             | 概要                                  |
| ------------------------------------------------ | ------------------------------------- |
| `driver.get(URL)`<br />`driver.navigate.to(URL)` | 指定したURLを開く。（ナビゲートする） |
| `driver.navigate.back`                           | ブラウザの戻るボタンを押す。          |
| `driver.navigate.forward`                        | ブラウザの進むボタンを押す。          |
| `driver.navigate.refresh`                        | 現在のページを更新する。              |

## ブラウザの情報

### 記法

| 記法                 | 概要                     |
| -------------------- | ------------------------ |
| `driver.title`       | 現在のページのタイトル。 |
| `driver.current_url` | 現在のページのURL。      |
| `driver.page_source` | ページのソース。         |

## Web要素の検索

### 記法

| 記法                                                         | 概要                                                        |
| ------------------------------------------------------------ | ----------------------------------------------------------- |
| `driver.find_element(引数1, ...)`<br />`DOM要素.find_element(引数1, ...)` | 指定したコンテキストの中で、最初に見つかったDOM要素を返す。 |
| `driver.find_elements(引数1, ...)`<br />`DOM要素.find_elements(引数1, ...)` | 指定したコンテキストの中で、見つかったDOM要素の配列を返す。 |

- iframe内の要素は取得できない。

## iframe

### 記法

| 記法                                                         | 概要                           |
| ------------------------------------------------------------ | ------------------------------ |
| `driver.switch_to.frame(iframeDOM要素)`<br />`driver.switch_to.frame(iframeのnameまたはid)` | 指定したiframeに切り替える。   |
| `driver.switch_to.default_content`                           | もとのコンテンツに切り替える。 |

## Web要素の情報

### 記法

| 記法           | 概要                              |
| -------------- | --------------------------------- |
| `DOM要素.text` | 指定したDOM要素のテキストを返す。 |

## 終了

### 記法

| 記法          | 概要                   |
| ------------- | ---------------------- |
| `driver.quit` | セッションを終了する。 |

## 待機

- ページ遷移した後などで、要素が取得できるまで待ちたい場合は、以下のようにする。
  ただしリダイレクトが行われた場合は、要素取得が中断されるので注意。

  ```ruby
  driver = Selenium::WebDriver.for :firefox
  driver.manage.timeouts.implicit_wait = 10
  driver.find_element(...)
  ```
