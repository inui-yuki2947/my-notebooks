# その他/ビルドツール/Make

## 共通

### 参考資料

- [makeコマンドの基本動作を理解する - Qiita](https://qiita.com/hotoku/items/6e50c9f8864e98468ac7)

## make

### コマンド

| コマンド                              | 概要                                                         |
| ------------------------------------- | ------------------------------------------------------------ |
| `make [ターゲット...] [変数=値...]`※1 | Makefileファイルをもとに、後述のターゲットのコマンドを実行する。 |

- ※1 `ターゲット...`と`変数=値...`は、順不同。
- [GNU make変数の伝播についてまとめ - Qiita](https://qiita.com/aosho235/items/8cd094a2abd22bc62af0)

### 実行されるターゲット

- 指定したターゲット。（デフォルトは1番目のターゲット）
- 実行されるターゲットのソースファイルをターゲットとしていて、タイムスタンプが変更されたもの。

### オプション

| オプション    | 概要                                             |
| ------------- | ------------------------------------------------ |
| `-f Makefile` | Makefileを指定する。（デフォルトは`./Makefile`） |

## Makefile

### 書式

```makefile
ターゲット: [ソースファイル...]
    [コマンド...]

# または
ターゲット: [ターゲット...]

...
```

- インデントには、必ず**タブ文字**を使用する。
- 変数名は、アッパースネークケースが推奨。

### コマンド書式

| 書式        | 概要                                   |
| ----------- |--------------------------------------|
| `@コマンド` | 実行したコマンド文字列を標準出力しない。（デフォルトでは標準出力される） |

### 変数

| 書式                                             | 概要                                                         |
| ------------------------------------------------ | ------------------------------------------------------------ |
| `変数 = 値`                                      | 変数に値を代入する。（遅延評価）                             |
| `変数 := 値`                                     | 変数に値を代入する。（即時評価）                             |
| `$(変数名)`<br />`${変数名}`<br />`$変数名1文字` | 指定した変数の値に展開する。<br />（Bashと違い、括弧がない場合は変数名が1文字として解釈される） |

- [Makefile における := と = の違い - Qiita](https://qiita.com/chi9rin/items/42e76e1995558904baa7)

### 特殊変数

| 書式 | 概要                                      |
| ---- | ----------------------------------------- |
| `$@` | 現在のターゲット名。                      |
| `$<` | 現在のターゲットの1番目のソースファイル。 |
| `$^` | 現在のターゲットの全てのソースファイル。  |

- [Makefile の特殊変数・自動変数の一覧 | 晴耕雨読](https://tex2e.github.io/blog/makefile/automatic-variables)

### .PHONY

```makefile
.PHONY ターゲット ターゲット ...
```

- 実際にファイルを生成するわけではないターゲットは、もし同じ名前のファイルが作成されてしまうとコマンド実行されなくなるので、`.PHONY`ターゲットを追加しておくのがよい。
- [MakefileのPHONYで便利コマンドを書く - なるぽのブログ](https://yu-nix.com/blog/2021/8/27/makefile-phony/#.PHONY%E3%81%AE%E5%BD%B9%E5%89%B2%E3%81%A8%E5%BF%85%E8%A6%81%E6%80%A7)
