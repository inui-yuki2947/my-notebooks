# MySQL/複合ステートメント/診断ステートメント

## 共通

### 参考資料

- [MySQL :: MySQL 5.6 リファレンスマニュアル :: 13.6.7.7 MySQL の診断領域](https://dev.mysql.com/doc/refman/5.6/ja/diagnostics-area.html)

## SHOW ERRORS, WARNINGS

### 記法

| 記法                     | 概要                                                         |
| ------------------------ | ------------------------------------------------------------ |
| `SHOW ERRORS`            | ステートメント実行結果の、エラー情報を表示する。             |
| `SHOW COUNT(*) ERRORS`   | ステートメント実行結果の、エラー情報**の数**を表示する。     |
| `SHOW WARNINGS`          | ステートメント実行結果の、エラー・警告・注意情報を表示する。 |
| `SHOW COUNT(*) WARNINGS` | ステートメント実行結果の、エラー・警告・注意情報**の数**を表示する。 |

## GET DIAGNOSTICS

### 記法

| 記法             | 概要                 |
| ---------------- | -------------------- |
| 記法1<br />記法2 | 診断情報を取得する。 |

- 記法1

  ```mysql
  GET [CURRENT,STACKED] DIAGNOSTICS
      変数 = ステートメント情報, 
      変数 = ステートメント情報,
      ...
  ```

- 記法2

  ```mysql
  GET [CURRENT,STACKED] DIAGNOSTICS CONDITION 条件番号
      変数 = 条件情報,
      変数 = 条件情報,
      ...
  ```

### 例

```mysql
GET DIAGNOSTICS CONDITION 1
    @p1 = RETURNED_SQLSTATE,
    @p2 = MESSAGE_TEXT
```

## 診断領域

### 概要

- 診断領域には、下記の2種類の情報が含まれる。

  - ステートメント情報
  - 条件情報
- 通常のステートメントは診断領域をクリアするが、診断ステートメントは診断領域をクリアしない。

### ステートメント情報

| ステートメント情報 | 概要                                         |
| ------------------ | -------------------------------------------- |
| `NUMBER`           | 情報が含まれている条件領域の数。             |
| `ROW_COUNT`        | このステートメントによって影響を受けた行数。 |

### 条件情報

| 条件情報            | 概要                          |
| ------------------- | ----------------------------- |
| `RETURNED_SQLSTATE` | この条件のSQLSTATE値。        |
| `MESSAGE_TEXT`      | この条件のエラーメッセージ。  |
| `MYSQL_ERRNO`       | この条件のMySQLエラーコード。 |
