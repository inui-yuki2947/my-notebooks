# AWS/ネットワーキングとコンテンツ配信/Amazon CloudFront

## 共通

### 概要

- **Amazon CloudFront**は、エッジロケーションからコンテンツを配信するCDNサービスのこと。（cf. AWS Global Accelerator）
- 接続ポイントは、400を超える**PoP（Point of Presence）**、**エッジロケーション**と、13の**リージョン別エッジキャッシュ**（エッジロケーションにコンテンツがキャッシュされていない場合、オリジンサーバーの前にこのサーバーから配信される）で構成されている。
- CloudFrontへキャッシュするコンテンツの提供元を**オリジン**と呼ぶ。
- Amazon CloudFrontが生成されると自動的にディストリビューションドメイン名が生成され、それを使ってCloudFrontに接続することが出来る。
- [Amazon CloudFront とは何ですか? - Amazon CloudFront](https://docs.aws.amazon.com/ja_jp/AmazonCloudFront/latest/DeveloperGuide/Introduction.html)

### キャッシュ

- キャッシュヒット率の改善には以下の方法がある。
  - オブジェクトのTTLを増やす。
  - オリジンが固有のオブジェクトを返す必要なクエリ文字列パラメータ、Cookie、またはリクエスト ヘッダーのみを転送するようにディストリビューションを設定する。
  - 圧縮が必要ない場合は、Accept-Encoding ヘッダーを削除する。
  - HTTPを使用したメディア コンテンツを提供する。

### セキュリティ

- **フィールドレベル暗号化**は、個人情報に関わるような機密性の高いデータのセキュリティを確保するための機能である。
- S3バケットがオリジンの場合、**オリジンアクセスアイデンティティ（OAI）**を使用することで、CloudFrontのみにS3バケットへのアクセスを許可することができる。
- ALBがオリジンの場合、指定したHTTPヘッダーがリクエストに含まれている場合のみ、ルーティングを可能とすることができる。（**カスタムヘッダー**）

### エッジ関数

- **エッジ関数**という独自のコードを記述して、CloudFrontがHTTPリクエストとレスポンスを処理する方法をカスタマイズできる。
- エッジ関数には、CloudFront FunctionsとLambda@Edgeの2種類がある。
