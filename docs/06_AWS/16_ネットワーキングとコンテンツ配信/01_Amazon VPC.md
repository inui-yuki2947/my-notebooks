# AWS/ネットワーキングとコンテンツ配信/Amazon VPC

## 共通

### 概要

- **Amazon Virtual Private Cloud（Amazon VPC）**とは、AWS上の特定のリージョンに、独立したネットワーク空間を作成できるサービスである。

- [Amazon VPC とは? - Amazon Virtual Private Cloud](https://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/what-is-amazon-vpc.html)

### サブネット

- **サブネット**は、VPCのIPアドレスの範囲である。

| サブネットタイプ       | 概要                                             |
| ---------------------- | ------------------------------------------------ |
| パブリックサブネット   | インターネットゲートウェイへの直接ルートがある。 |
| プライベートサブネット | インターネットゲートウェイへの直接ルートがない。 |

### VPCに接続する

- **インターネットゲートウェイ（IGW）**は、VPCとインターネットとの間の通信を可能にする VPC コンポーネントである。
- **Egress-Onlyインターネットゲートウェイ**は、IPv6経由でのVPCからインターネットへのアウトバウンド送信を可能にする。
- **NATゲートウェイ**または**NATインスタンス**を使用すると、プライベートサブネット内のインスタンスは VPC 外のサービスに接続できる。
  （IPv4はサポートしていない）
- NATゲートウェイは、NATインスタンスより**高い可用性**が期待できる。
- **AWS Transit Gateway**は、VPC内にハブの機能を備えたゲートウェイを配置するサービスである。
- **VPCピアリング**は、異なるVPC間をプライベート接続するサービスである。

### モニタリング

- **VPCフローログ**は、VPC のネットワークインターフェイスとの間で行き来するトラフィック情報をキャプチャするサービスである。

### セキュリティ

- **セキュリティグループ**、**ネットワークアクセスコントロールリスト（ACL）**は、
  特定のインバウンドまたはアウトバウンドのトラフィックを、許可または拒否する。
- 実際のセキュリティグループの適用では、インバウンド通信は最低限必要な通信のみ許可し、アウトバウンド通信は全て許可しておくのが一般的である。
- セキュリティグループとネットワークACLの両方でルールが適用されている場合、**両方で許可されないと拒否になる。**

| 種類                 | デフォルト動作                                           | 適用範囲         | 評価順                   | ステータス                                                   |
| -------------------- | -------------------------------------------------------- | ---------------- | ------------------------ | ------------------------------------------------------------ |
| セキュリティグループ | インバウンド：全て**拒否**<br />アウトバウンド：全て許可 | インスタンス単位 | 全てのルールが適用される | ステートフル<br />（アウトバウンドの通信も自動で許可される） |
| ネットワークACL      | インバウンド：全て許可<br />アウトバウンド：全て許可     | サブネット単位   | ルール番号順に適用される | ステートレス<br />（インバウンド・アウトバウンドの両方の許可が必要） |

### AWS PrivateLink

- **AWS PrivateLink**は、サービスが VPC 内にあるかのようにVPCをそれらのサービスにプライベートに接続できるようにする、可用性が高くスケーラブルなテクノロジーである。
- [AWS PrivateLink の概要 - Amazon Virtual Private Cloud](https://docs.aws.amazon.com/ja_jp/vpc/latest/privatelink/what-is-privatelink.html)

| 種類                           | 概要                                                         | 料金                                                   |
| ------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------ |
| ゲートウェイエンドポイント     | ルートテーブルに指定されたターゲットを追加することで、<br />AWSサービスにプライベート接続できる。 | 無料                                                   |
| インターフェイスエンドポイント | APIコールに対してインターネットを経由せずに、<br />プライベート接続をすることができる。 | 時間単位の使用料金と<br />データ処理料金が課金される。 |

### その他

- EC2やRDS作成時には、VPCを選択する必要がある。
- VPCには物理的なルーターがなく、ソフトウェアがルーティングを行う。
- デフォルトVPCは「/16」、デフォルトのサブネットは「/20」である。
