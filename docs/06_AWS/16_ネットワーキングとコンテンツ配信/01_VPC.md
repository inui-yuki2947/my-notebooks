# AWS/ネットワーキングとコンテンツ配信/VPC

## 共通

### 概要

- Amazon Virtual Private Cloud（Amazon VPC）とは、AWS上の特定のリージョンに、独立したネットワーク空間を作成できるサービスである。

- [Amazon VPC とは? - Amazon Virtual Private Cloud](https://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/what-is-amazon-vpc.html)

### サブネット

- *サブネット*は、VPCのIPアドレスの範囲である。

| サブネットタイプ       | 概要                                             |
| ---------------------- | ------------------------------------------------ |
| パブリックサブネット   | インターネットゲートウェイへの直接ルートがある。 |
| プライベートサブネット | インターネットゲートウェイへの直接ルートがない。 |

### VPCに接続する

- **インターネットゲートウェイ（IGW）**は、VPCとインターネットとの間の通信を可能にする VPC コンポーネントである。

- **NATゲートウェイ**または**NATインスタンス**を使用すると、プライベートサブネット内のインスタンスは VPC 外のサービスに接続できる。

- **AWS Transit Gateway**は、VPC内にハブの機能を備えたゲートウェイを配置するサービスである。

- **VPCピアリング**は、異なるVPC間をプライベート接続するサービスである。

### モニタリング

- **VPCフローログ**は、VPC のネットワークインターフェイスとの間で行き来するトラフィック情報をキャプチャするサービスである。

### セキュリティ

- **セキュリティグループ**、**ネットワークアクセスコントロールリスト（ACL）**は、
  特定のインバウンドまたはアウトバウンドのトラフィックを、許可または拒否する。
- 実際のセキュリティグループの適用では、インバウンド通信は最低限必要な通信のみ許可し、アウトバウンド通信は全て許可しておくのが一般的である。
- セキュリティグループとネットワークACLの両方でルールが適用されている場合、**両方で許可されないと拒否になる。**

| 種類                 | 適用範囲         | ステータス                                                   |
| -------------------- | ---------------- | ------------------------------------------------------------ |
| セキュリティグループ | インスタンス単位 | ステートフル（アウトバウンドの通信も自動で許可される）       |
| ネットワークACL      | サブネット単位   | ステートレス（インバウンド・アウトバウンドの両方の許可が必要） |

## AWS PrivateLink

### 概要

- AWS PrivateLinkは、サービスが VPC 内にあるかのようにVPCをそれらのサービスにプライベートに接続できるようにする、可用性が高くスケーラブルなテクノロジーである。
- [AWS PrivateLink の概要 - Amazon Virtual Private Cloud](https://docs.aws.amazon.com/ja_jp/vpc/latest/privatelink/what-is-privatelink.html)

### インターフェイスエンドポイント

- インターフェイスエンドポイントを用いると、APIコールに対してインターネットを経由せずにプライベート接続をすることができる。
- インターフェイスエンドポイントは、時間単位の使用料金とデータ処理料金が課金される。

### ゲートウェイエンドポイント

- ゲートウェイエンドポイントでは、ルートテーブルに指定されたターゲットを追加することで、AWSサービスにプライベート接続できる。
- ゲートウェイエンドポイントは、追加料金なしで使用できる。

## その他

- EC2やRDS作成時には、VPCを選択する必要がある。
- VPCには物理的なルーターがなく、ソフトウェアがルーティングを行う。
- デフォルトVPCは「/16」、デフォルトのサブネットは「/20」である。
