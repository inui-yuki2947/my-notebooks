# AWS/コンピューティング/Amazon EC2

## 共通

### 概要

- **Amazon EC2（Elastic Compute Cloud）**は、サーバー・OS・ソフトウェアなどを一式レンタルできるサービス。
- EC2はデフォルトでは5分間隔でCloudWatchにメトリクスを送信するが、インスタンスの詳細なモニタリングを有効にしている場合、1分間隔で送信する。
- [Amazon EC2 とは - Amazon Elastic Compute Cloud](https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/concepts.html)

### Amazon マシンイメージ（AMI）

- EC2インスタンスは、**Amazon マシンイメージ（AMI）**と呼ばれるイメージファイルから起動する。
- インスタンスをAMIとしてテンプレート化することで、バックアップや別リージョンにコピーすることができる。
- **EC2 Image Builder**は、AMIの作成や管理を自動化するサービスである。

### インスタンス

- **ユーザーデータ**とは、EC2インスタンス初回起動時に1回だけスクリプトを実行できる機能。
- **インスタンスメタデータ**とは、EC2インスタンス自身に関するデータ。

### インスタンスタイプ

- インスタンスタイプは、`t3.xlarge`のように表す。
  - `t`はインスタンスファミリー。
  - `3`はインスタンス世代。数字が大きいほど高性能かつ安価。
  - `xlarge`はインスタンスサイズ。

### インスタンス購入オプション

| 種類                                   | 概要                                                         | 主な用途                                                     |
| -------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| オンデマンドインスタンス（デフォルト） | 初期費用なしで、使用した分だけ従量課金されるプラン。         | 開発・テスト環境<br />キャンペーンなどの一時的なWebサイト    |
| リザーブドインスタンス                 | 長期利用券による購入割引があるプラン。<br />**Standardタイプ**は、リージョンやAZを指定する代わりに安価。<br />**Convertibleタイプ**は、柔軟に変更可能な代わりに高価。<br />**スケジュールされたリザーブドインスタンス**もある。 | Webサーバー<br />アプリケーションサーバー<br />データベースサーバー |
| スポットインスタンス                   | AWSの余剰リソースを安価に利用するプラン。<br />スポット価格が入札価格を上回ると強制終了される。<br />**スポットブロック**は継続期間。<br />**スポットフリート**は性能キャパシティ。 | 処理が中断されても再実行可能なシステム                       |
| 専有インスタンス                       | 物理的なホストサーバーを占有する。                           |                                                              |

- EC2のインスタンス**使用量**を購入することで割引が受けられる**Savings Plans**というプランもある。

### ネットワーク

- **Elastic IP（EIP）**は、固定のグローバルIPアドレスを提供するサービス。
- EIPは、**使用されていない時間単位**で料金が発生する。

### プレイスメントグループ

- **プレイスメントグループ**は、EC2インスタンスを論理的にグループ化したものである。

  | 種類                                 | 概要                                                         |
  | ------------------------------------ | ------------------------------------------------------------ |
  | クラスタープレイスメントグループ     | 同じラックに配置。<br />ネットワークレイテンシーを最小限に抑える。 |
  | パーティションプレイスメントグループ | パーティション単位で異なるラックに配置。<br />大規模分散処理で使用される。 |
  | スプレッドプレイスメントグループ     | 全てのEC2インスタンスを異なるラックに配置。                  |

### リージョンとゾーン

- **リージョン**とは、地理的に離れた領域のこと。（例：`アジアパシフィック (東京): ap-northeast-1`）
- ローカルリージョンの使用には、申込みと審査が必要。
- **アベイラビリティーゾーン（AZ）**は、各リージョン内の複数の独立した場所のこと。（例：`ap-northeast-1a`）
- 各リージョンでは、複数のアベイラビリティーゾーンに、物理的に独立した設備を置いている。
- [リージョンとゾーン - Amazon Elastic Compute Cloud](https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/using-regions-availability-zones.html)

### ストレージ

- **Amazon Elastic Block Store（Amazon EBS）**は、EC2インスタンスで使用するための、ブロックレベルのストレージボリュームである。
- **インスタンスストア（エフェメラルディスク）**は、EC2の特定のインスタンスタイプで利用できる無料のストレージサービス（揮発性ディスク）である。
- インスタンスストアは、インスタンスの**停止・終了・障害発生**時にデータが消失する。（再起動では消失しない）

### フリート

- 単一の API 呼び出しでは、フリートは、オンデマンドインスタンス、リザーブドインスタンス、スポットインスタンスの購入オプションを一緒に使用して、複数のアベイラビリティーゾーンにまたがって複数のインスタンスタイプを起動できる。

### VM Import/Export

- VM Import/Exportを使用すると、仮想マシン（VM）イメージを既存の仮想化環境からAmazon EC2にインポートし、それを元の環境にエクスポートすることができる。
- [VM Import/Export とは - VM Import/Export](https://docs.aws.amazon.com/ja_jp/vm-import/latest/userguide/what-is-vmimport.html)
