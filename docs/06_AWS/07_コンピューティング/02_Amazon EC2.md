# AWS/コンピューティング/Amazon EC2

## 共通

### 概要

- **Amazon EC2（Elastic Compute Cloud）**は、サーバー・OS・ソフトウェアなどを一式レンタルできるサービス。
- [Amazon EC2 とは - Amazon Elastic Compute Cloud](https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/concepts.html)

### Amazon マシンイメージ（AMI）

- インスタンスを**Amazon マシンイメージ（AMI）**としてテンプレート化することで、バックアップや別リージョンにコピーすることができる。
- **EC2 Image Builder**は、AMIの作成や管理を自動化するサービスである。

### インスタンス

- **ユーザーデータ**とは、EC2インスタンス初回起動時に1回だけスクリプトを実行できる機能。
- **インスタンスメタデータ**とは、EC2インスタンス自身に関するデータ。

### インスタンスタイプ

- インスタンスタイプは、`t3.xlarge`のように表す。
  - `t`はインスタンスファミリー。
  - `3`はインスタンス世代。数字が大きいほど高性能かつ安価。
  - `xlarge`はインスタンスサイズ。
- T2、T3、T3a、T4は、**バーストパフォーマンス**があり、バースト（突発的に負荷量が大きくなること）に対応する。

### インスタンス購入オプション

| 種類                                   | 概要                                                         | 主な用途                                                     |
| -------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| オンデマンドインスタンス（デフォルト） | 初期費用なしで、使用した分だけ従量課金されるプラン。<br />**キャパシティ予約**もできる。 | 開発・テスト環境<br />キャンペーンなどの一時的なWebサイト    |
| リザーブドインスタンス                 | 長期利用券による購入割引があるプラン。<br />**Standardタイプ**は、リージョンやAZを指定する代わりに安価。<br />**Convertibleタイプ**は、柔軟に変更可能な代わりに高価。<br />**スケジュールされたリザーブドインスタンス**（現在は使用停止）もある。 | Webサーバー<br />アプリケーションサーバー<br />データベースサーバー |
| スポットインスタンス                   | AWSの余剰リソースを安価に利用するプラン。<br />スポット価格が入札価格を上回ると強制終了される。<br />**スポットブロック**は継続期間。<br />**スポットフリート**は性能キャパシティ。 | 処理が中断されても再実行可能なシステム                       |

- **テナンシー**は、EC2インスタンスが物理ハードウェアに分散される方法であり、共有・ハードウェア専有インスタンス・専有ホストが選択できる。

### Savings Plans

- **Savings Plans**は、EC2のインスタンス**使用量**を購入することで割引が受けられるプランである。
- Savings Plansは、AWS Cost Explorerから購入する。
- Savings Plansには下記の種類がある。
  - EC2 Instance Saving Plans
  - Compute Saving Plans
  - Amazon SageMaker Saving Plans

### ネットワーク

- **Elastic IP（EIP）**は、固定のグローバルIPアドレスを提供するサービス。
- EIPは、**使用されていない時間単位**で料金が発生する。

### プレイスメントグループ

- **プレイスメントグループ**は、EC2インスタンスを論理的にグループ化したものである。

  | 種類                                 | 概要                                                         |
  | ------------------------------------ | ------------------------------------------------------------ |
  | クラスタープレイスメントグループ     | 同じAZの同じラックに配置。<br />ネットワークレイテンシーを最小限に抑える。 |
  | パーティションプレイスメントグループ | パーティション単位で、同じAZの異なるラックに配置。<br />大規模分散処理で使用される。 |
  | スプレッドプレイスメントグループ     | 全てのEC2インスタンスを、同じAZの異なるラックに配置。        |

### インスタンスストア

- **インスタンスストア（エフェメラルディスク）**は、EC2の特定のインスタンスタイプで利用できる無料のストレージサービス（揮発性ディスク）である。
- インスタンスストアは、インスタンスの**停止・終了・障害発生**時にデータが消失する。（再起動では消失しない）

### フリート

- **EC2フリート**は、オンデマンドインスタンスとスポットインスタンスのグループである。

### VM Import/Export

- VM Import/Exportを使用すると、仮想マシン（VM）イメージを既存の仮想化環境からAmazon EC2にインポートし、それを元の環境にエクスポートすることができる。
- [VM Import/Export とは - VM Import/Export](https://docs.aws.amazon.com/ja_jp/vm-import/latest/userguide/what-is-vmimport.html)

### その他

- EC2は従量課金制であり、起動中のみ課金される。
- EC2はデフォルトでは5分間隔でCloudWatchにメトリクスを送信するが、インスタンスの詳細なモニタリングを有効にしている場合、1分間隔で送信する。
