# AWS/ストレージ/Amazon S3

## 共通

### 概要

- **Amazon Simple Storage Service（Amazon S3）**は、**オブジェクトストレージ**（データをオブジェクトとしてあつかう方式）サービスである。
- [Amazon S3 とは - Amazon Simple Storage Service](https://docs.aws.amazon.com/ja_jp/AmazonS3/latest/userguide/Welcome.html)

### バケット・オブジェクト

- **バケット**は、Windowsで言うところのドライブで、**オブジェクト**はファイルのこと。
- バケットの中にバケットは作成できない。
- バケット作成後は、名前やリージョンを変更できない。

### セキュリティ

- **バケットポリシー**は、JSON形式でバケット全体のアクセス制御を行う機能である。
- S3ではオブジェクト単位でACLを設定することができる。
- **ブロックパブリックアクセス**によるアクセス制御を行うと、バケットポリシーやACLの設定に対して、一括で制限を設けることができる。
- デフォルトでは全てのS3オブジェクトはプライベートだが、**署名付きURL**を用いると、一定時間だけオブジェクトを他のユーザーと共有できる。
- **オブジェクトロック**を使用すると、オブジェクトを読み込み専用にできる。

### 暗号化

| 種類    | 暗号化処理         | 鍵の管理                 |
| ------- | ------------------ | ------------------------ |
| CSE     | クライアントサイド | クライアントが提供・管理 |
| SSE-C   | サーバーサイド     | クライアントが提供・管理 |
| SSEｰS3  | サーバーサイド     | Amazon S3が提供・管理    |
| SSE-KMS | サーバーサイド     | AWS KMSが提供・管理      |

### ストレージクラス

| 種類                | 概要                                                         |
| ------------------- | ------------------------------------------------------------ |
| Standard            | 標準のストレージクラス。                                     |
| Standard – IA       | 低頻度アクセス向けのストレージクラス。<br />標準クラスに比べて安価だが、データの読み出し容量に対して課金される。 |
| One Zone – IA       | 低頻度アクセス向けのストレージクラス。<br />1つのAZのみにデータを保存する代わりに安価。 |
| Glacier             | データアーカイブ・長期バックアップを意識して作られた、最も安価なストレージクラス。<br />アクセス頻度が高い順に下記の3種類がある。<br />**Glacier Instant Retrieval**：4半期に1回程度<br />**Glacier Flexible Retrieval**：1年に1回程度<br />**Glacier Deep Archive**：1年に1回以下 |
| Intelligent Tiering | アクセス頻度に応じて、コスト最適なストレージ層を自動で使い分けるストレージクラス。 |

### Amazon S3 Glacier

- Amazon S3 Glacierの**ボールト（Vault）**は、アーカイブを格納するコンテナ（S3のバケットに相当）である。
- ボールトロックを使用すると、規制要件およびコンプライアンス要件を適用するのに役立てることができる。

### Amazon S3 インベントリ

- **Amazon S3インベントリ**は、ストレージの管理を支援するツールで、
  オブジェクトのレプリケーションや暗号化のステータスを監査およびレポートしたりできる。

### その他

- 予め容量を予約する必要はなく、保存した分だけ従量課金される。
- S3に保存したオブジェクトは、**同一リージョン内の3箇所のAZ**に自動的に複製される。
- **バージョニング**を有効にすることで、以前のバージョンのオブジェクトを取り出すことができる。
- **クロスリージョンレプリケーション**を有効化すると、別リージョンのS3バケットにオブジェクトを複製できる。
- **バッチオペレーション**は、大量のオブジェクトに対して、日時・週次など一括してバッチ処理を行うことである。
- **マルチパートアップロード**を用いると、大容量のオブジェクトを分割してアップロードできる。
- **Amazon S3 Transfer Acceleration**は、エッジロケーションを用いてクライアントとS3間の通信化を高速化する。
- **S3 Select**は、SQLクエリを使用してデータの一部分を抽出する機能である。
- **リクエスタ支払い**を設定すると、ユーザ側にオブジェクトへのアクセス料金を支払わせることが出来る。

## aws s3

### コマンド

| コマンド                      | 概要                                                         |
| ----------------------------- | ------------------------------------------------------------ |
| `aws s3 ls パス`              | S3に存在するファイルの一覧を表示する。                       |
| `aws s3 cp コピー元 コピー先` | S3に存在するファイルをコピーする。<br />引数に`-`を指定することで、標準入力または標準出力を指定できる。 |
