# Docker/Docker/コンテナ

## 共通

### 概要

- コンテナには、IDと名前（それぞれ一意）がある。
- コンテナのステータスには、以下の７種類がある。
  [[Docker入門] Dockerコンテナのステータスを調べてみよう | Skyarch Broadcasting](https://www.skyarch.net/blog/?p=16702)
  - created
  - restarting
  - running
  - removing
  - paused
  - exited
  - dead
- コンテナ内のファイルは、コンテナが破棄されるときに破棄される。

## docker container ls

### コマンド

| コマンド              | 概要                     |
| --------------------- | ------------------------ |
| `docker container ls` | コンテナ一覧を表示する。 |

### オプション

| オプション  | 概要                             |
| ----------- | -------------------------------- |
| `-a, --all` | 実行中以外のコンテナも表示する。 |

## docker container inspect

### コマンド

| コマンド                                 | 概要                               |
| ---------------------------------------- | ---------------------------------- |
| `docker container inspect コンテナ1 ...` | 指定したコンテナの詳細を表示する。 |

## docker container run, create

### コマンド

| コマンド                                             | 概要                                                         |
| ---------------------------------------------------- | ------------------------------------------------------------ |
| `docker container run イメージ [コマンド] [引数]`    | コンテナを**起動状態**で作成し、標準出力に繋ぐ。（`create`と`start`の組み合わせ） |
| `docker container create イメージ [コマンド] [引数]` | コンテナを**停止状態**で作成し、作成したコンテナIDを標準出力に出力する。 |

### オプション（起動方法系）

| オプション          | 概要                                                         |
| ------------------- | ------------------------------------------------------------ |
| `-d, --detach`      | コンテナを**デタッチド・モード**で起動する。<br />（現在のターミナルを占有しないようにする） |
| `-i, --interactive` | ホストの標準入力を、コンテナの標準入力につなげる。           |
| `-t, --tty`         | コンテナの標準出力を、ホストの標準出力につなげる。           |

- デフォルトでは、改行文字がLFで出力されるが、TTYを有効にする（`-t`オプションを付ける）と、CRLFで出力される。
  [Docker や docker-compose で TTY を有効にした場合, 標準出力の改行コードが CR+LF になる件 - ようへいの日々精進XP](https://inokara.hateblo.jp/entry/2018/12/19/235758)

### オプション（その他）

| オプション                                                   | 概要                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| `-p, --publish ホストのポート:コンテナのポート`              | ポートフォワーディングを行う。                               |
| `-v, --volume [ボリュームまたはホスト側パス:]コンテナ側送信先` | ホスト側とコンテナの**ディレクトリを共有**させる。<br />ボリューム省略時は、匿名ボリュームとなる。 |
| `-w, --workdir ディレクトリ`                                 | コンテナ内での作業ディレクトリを指定できる。                 |
| `--network ネットワーク名`                                   | コンテナをネットワークに接続する。                           |
| `--name コンテナ名`                                          | コンテナ名を指定する。<br />（指定しない場合は、適当な名前が与えられる） |
| `--rm`                                                       | 終了時にコンテナを破棄する。                                 |

## docker container rm

### コマンド

| コマンド                            | 概要                         |
| ----------------------------------- | ---------------------------- |
| `docker container rm コンテナ1 ...` | 指定したコンテナを削除する。 |

## docker container attach, exec

### コマンド

| コマンド                                  | 概要                                                         |
| ----------------------------------------- | ------------------------------------------------------------ |
| `docker container attach コンテナ`        | 実行中のコンテナで起動している**PID=1**のプロセスの標準入出力に接続する。<br />（exitするとコンテナが停止する） |
| `docker container exec コンテナ コマンド` | 実行中のコンテナ内で新しいコマンドを実行する。               |

### 参考資料

- [Dockerコンテナ内で操作 attachとexecの違い - Qiita](https://qiita.com/RyoMa_0923/items/9b5d2c4a97205692a560)

## docker container commit

### コマンド

| コマンド                                               | 概要                                                         |
| ------------------------------------------------------ | ------------------------------------------------------------ |
| `docker container commit コンテナ [リポジトリ[:タグ]]` | コンテナのファイル変更や設定をもとに、新しいイメージを作成する。 |

- これでイメージを作成すると、何の操作をしてできたものなのかが分かりにくいため、**暫定的に**Dockerイメージにしておきたい場合などのみ使うべき。（Dockerfileをできるだけ使うべき）

## docker container cp

### コマンド

| コマンド                            | 概要                 |
| ----------------------------------- | -------------------- |
| `docker container cp 移動元 移動先` | ファイルを移動する。 |

- `コンテナ名:ファイル名`でコンテナを指定できる。
