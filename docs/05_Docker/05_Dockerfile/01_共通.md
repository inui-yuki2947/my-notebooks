# Docker/Dockerfile/共通

## 共通

### 概要

- Dockerfileの各コマンドは、**毎回コンテナを起動して実行している**ので注意。
  （例：`RUN cd /tmp`などとしても、次のコマンドのカレントディレクトリは`/`である。）
- キャッシュを効かせるため、ファイルのコピーより`yarn install`などを先に書くべき。

### 参考資料

- [Dockerfile リファレンス — Docker-docs-ja 20.10 ドキュメント](https://docs.docker.jp/engine/reference/builder.html)
- [Dockerfile のベスト・プラクティス — Docker-docs-ja 19.03 ドキュメント](https://docs.docker.jp/develop/develop-images/dockerfile_best-practices.html)

## パーサ・ディレクティブ

### 書式

| 書式                  | 概要                         |
| --------------------- | ---------------------------- |
| `# ディレクティブ=値` | シンタックス等を変更できる。 |

## FROM

### 書式

| 書式                    | 概要                                   |
| ----------------------- | -------------------------------------- |
| `FROM 元となるイメージ` | ベースとなるDockerイメージを指定する。 |

## WORKDIR

### 書式

| 書式           | 概要                                       |
| -------------- | ------------------------------------------ |
| `WORKDIR パス` | 以降の命令での作業ディレクトリを指定する。 |

## COPY, ADD

### 書式

| 書式                                             | 概要                                                  |
| ------------------------------------------------ | ----------------------------------------------------- |
| `COPY コピー元 Dockerイメージ内のコピー・展開先` | ファイルのコピーを行う。                              |
| `ADD コピー元 Dockerイメージ内のコピー・展開先`  | tarファイルの展開を行いつつ、ファイルのコピーを行う。 |

### ファイル

| ファイル        | 概要                                                 |
| --------------- | ---------------------------------------------------- |
| `.dockerignore` | `COPY`句で無視するファイル・ディレクトリを記述する。 |

## ENV

### 書式

| 書式              | 概要                                                         |
| ----------------- | ------------------------------------------------------------ |
| `ENV キー=値 ...` | 以降の命令及びイメージから実行したコンテナで使える環境変数を定義する。 |

## ARG

### 書式

| 書式                        | 概要                                     |
| --------------------------- | ---------------------------------------- |
| `ARG 変数名[=デフォルト値]` | 構築時にユーザーが渡せる変数を定義する。 |
