# Bash/その他/標準入力処理

## tee

### コマンド

| コマンド              | 概要                                       |
| --------------------- | ------------------------------------------ |
| `tee [ファイル名...]` | 標準入力を、標準出力とファイルに出力する。 |

### オプション

| オプション | 概要                             |
| ---------- | -------------------------------- |
| `-a`       | ファイルに上書きでなく追記する。 |

### その他

- 複数ファイルに同じ内容を出力したいときに有用である。
- `任意のコマンド | tee /dev/tty`とすると、コマンドの結果を標準出力しつつ、その結果をパイプで繋ぐことができる。

## xargs

### コマンド

| コマンド         | 概要                                           |
| ---------------- | ---------------------------------------------- |
| `xargs コマンド` | 標準入力を、指定したコマンドの引数として渡す。 |

### オプション

| オプション                   | 概要                                                         | 例                                            |
| ---------------------------- | ------------------------------------------------------------ | --------------------------------------------- |
| `-0`                         | ヌル文字を区切り文字として扱う。                             | `find . -name '*.txt' -print0 ｜ xargs -0 ls` |
| `-I 置換文字列`              | 引数を任意の位置に挿入し、`-L 1`を指定した状態とする。<br />（置換文字列としては、`{}`などをよく使う？） | `xargs -I {} コマンド 引数 {}`                |
| `-L 行数`                    | 指定した行数ごとに、コマンドを実行する。<br />（デフォルトは`5000`？） |                                               |
| `-P, --max-procs プロセス数` | 同時に実行するプロセス数の上限を指定する。<br />（`0`は無制限。デフォルトは`1`） |                                               |

### その他

- 引数をコマンド置換で指定する場合と比べ、引数が長くなる場合にも対応できるという利点がある。
- 標準入力が空であった場合
  - BSD系では、コマンドは実行されない。（終了ステータスは0）
  - GNU系では、コマンドは実行される。（`--no-run-if-empty`オプションで、実行させないようにできる）
- [GNU/BSDでのxargsの振る舞いの違い](https://rcmdnk.com/blog/2017/06/01/computer-linux-gnu-bsd/)

## read

### コマンド

| コマンド           | 概要                                                         |
| ------------------ | ------------------------------------------------------------ |
| `read 変数名1 ...` | 標準入力を1行読み取って、区切り文字`IFS`で分割し、各変数に代入する。<br />入力が多かった場合は、最後の変数にまとめて代入される。 |
| `read -a 変数名`   | 標準入力を1行読み取って、区切り文字`IFS`で分割し、配列として変数に代入する。 |

- 先頭と末尾の区切り文字は取り除かれる。
- 区切り文字が連続していても、1つの区切り文字として扱われる。

### オプション

| オプション      | 概要                                                         |
| --------------- | ------------------------------------------------------------ |
| `-r`            | エスケープ文字をそのまま読み取る。                           |
| `-p プロンプト` | 入力前にプロンプトを出力する。                               |
| `-s`            | 入力文字を表示しない。（パスワードを入力する場合などに使う） |
| `-u 数字`       | ファイルディスクリプタを指定する。                           |

### その他

- 文字分割を無効化する（スペースなどをそのまま読み取る）ためには、区切り文字`IFS`を空文字にするとよい。

  ```bash
  while IFS= read -r line; do
    処理
  done
  ```

- `read`コマンドをネストさせる場合は、下記のようにファイルディスクリプタを分離するよい。

  ```bash
  while read -u 3 -r hoge; do
    while read -u 4 -r fuga; do
      ...
    done 4<<<"$fuga_list"
  done 3<<<"$hoge_list"
  ```
