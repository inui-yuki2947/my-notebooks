# Git/設定/Gitフック

## 共通

### 概要

- [Git - Git フック](https://git-scm.com/book/ja/v2/Git-%E3%81%AE%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA-Git-%E3%83%95%E3%83%83%E3%82%AF)
- コミット・プッシュ前のフックでは、終了ステータスが0以外だった場合、そのコミット・プッシュが中断される。
- 「husky」というライブラリを使う手もあるらしい。
  [typicode/husky: Git hooks made easy 🐶 woof!](https://github.com/typicode/husky)

### 作成方法

- `.git/hooks`ディレクトリ内に、フック名を名前とする実行可能なスクリプトファイルを配置する。
- `git init`すると、同ディレクトリにサンプルが格納されるので、これをカスタマイズしファイル名末尾の`.sample`を削除するとよい。

### リポジトリでの共有

- `.git`ディレクトリはリポジトリで管理されないので、スクリプトは別のディレクトリに格納し、
  それにシンボリックリンクを貼る、あるいは`core.hooksPath`を変更するなどの手法を取る。
- <https://www.webdevqa.jp.net/ja/git/git%E3%83%95%E3%83%83%E3%82%AF%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AF%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%81%A8%E3%81%A8%E3%82%82%E3%81%AB%E7%AE%A1%E7%90%86%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%99%E3%81%8B%EF%BC%9F/958112807/>
- [チームで共通のフックスクリプト(Git hook)を使っています - ファーエンドテクノロジー株式会社](https://www.farend.co.jp/blog/2020/04/git-hook/)

### クライアントサイドフック

- クライアントサイドフックは、リポジトリクローン時にコピーされない。

- 種類

| 種類                 | 概要                                       |
| -------------------- | ------------------------------------------ |
| `pre-commit`         | コミットメッセージが入力される前           |
| `prepare-commit-msg` | コミットメッセージエディターが起動する直前 |
| `commit-msg`         | コミットメッセージを保存した後             |
| `post-commit`        | コミットプロセスが全て完了した後           |

- `git commit --no-verify`コマンドで、pre-commitフックを無視できる。

### サーバーサイドフック

- 種類

| 種類           | 概要                                                         |
| -------------- | ------------------------------------------------------------ |
| `pre-receive`  | プッシュ前（複数ブランチにプッシュされた場合は、一度のみ実行） |
| `update`       | プッシュ前（複数ブランチにプッシュされた場合は、各ブランチについて実行） |
| `post-receive` | プッシュ後                                                   |
