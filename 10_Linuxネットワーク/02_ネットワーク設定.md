# ネットワーク設定

## 共通

### コマンド

- net-toolsのコマンドは非推奨であり、iproute2のコマンドを使用するのがよい。

  | net-tools  | iproute2 |
  | ---------- | -------- |
  | `ifconfig` | `ip a`   |
  | `route`    | `ip r`   |
  | `netstat`  | `ss`     |

- [net-toolsとiproute2のコマンド対応早見表 | 俺的備忘録 〜なんかいろいろ〜](https://orebibou.com/ja/home/201412/20141215_002/)

- [ifconfigコマンドとipコマンドの違いと比較 – エラーの向こうへ](https://tech.mktime.com/entry/211)

## ホスト名

### /etc/hostname

- `/etc/hostname`ファイルには、ホスト名を記述する。

### hostname

- コマンド

  | コマンド            | 概要                 |
  | ------------------- | -------------------- |
  | `hostname`          | ホスト名を表示する。 |

| `hostname ホスト名` | ホスト名を変更する。 |

### hostnamectl

- `hostnamectl`コマンドは、ホスト名を設定する。

  ```bash
  hostnamectl [サブコマンド]
  ```

- サブコマンド

  | サブコマンド            | 概要                                         |
  | ----------------------- | -------------------------------------------- |
  | `status`                | ホスト名と関連情報を表示する。（デフォルト） |
  | `set-hostname ホスト名` | ホスト名を設定する。                         |

## ポート番号

### /etc/services

- `/etc/services`ファイルには、ポート番号とサービスの対応が記述されている。
- `netstat`コマンドでの名前解決などに使われる。

## ネットワークインターフェース

### 概要

- ネットワークインターフェースは、1番目のものから`eth0`, `eth1`となる。（環境によって名前が異なることもある）
- `lo`は、「ローカルループバック」のことである。

- 設定ファイル

  | ファイル                         | 概要                                                         |
  | -------------------------------- | ------------------------------------------------------------ |
  | `/etc/network/interfaces`        | Debian系ディストリビューションで、ネットワークインターフェースの設定を記述する。 |
  | `/etc/sysconfig/network-scripts` | Red Hat系ディストリビューションで、ネットワークインターフェースの設定を記述する。 |

### ip

- `ip`コマンドは、ネットワークの各情報を管理する。

  ```bash
  ip オブジェクト [サブコマンド]
  ```

- オブジェクト

  | オブジェクト       | 概要                                 |
  | ------------------ | ------------------------------------ |
  | `l, link`          | ネットワークデバイス                 |
  | `a, addr, address` | ネットワークデバイスとそのIPアドレス |
  | `r, route`         | ルーティングテーブル                 |

- サブコマンド

  | サブコマンド | 概要                             |
  | ------------ | -------------------------------- |
  | `show`       | 表示する。（省略時のデフォルト） |
  | `add`        | 追加する。                       |
  | `del`        | 削除する。                       |

### nmcli

- `nmcli`コマンドは、Red Hat系ディストリビューションで、NetworkManagerの管理を行う。

  ```bash
  nmcli オブジェクト [サブコマンド]
  ```

- オブジェクト・サブコマンド

  | オブジェクト    | サブコマンド        | 概要                                          |
  | --------------- | ------------------- | --------------------------------------------- |
  | `g, general`    | `status`            | NetworkManagerの状態を表示する。              |
  | `n, networking` | `connectivity`      | ネットワークの接続状態を表示する。            |
  | `r, radio`      | `wifi`              | Wi-Fiの状態を表示する。                       |
  | `r, radio`      | `wifi on, off`      | Wi-Fi接続を有効化・無効化する。               |
  | `c, connection` | `show`              | 接続状況を表示する。                          |
  | `d, device`     | `status`            | デバイスの状態を表示する。                    |
  | `d, device`     | `wifi connect SSID` | Wi-Fiに接続するデバイスを作成し、有効化する。 |

### ifconfig

- コマンド

  | コマンド                           | 概要                                           |
  | ---------------------------------- | ---------------------------------------------- |
  | `ifconfig [インターフェース名]`    | ネットワークインターフェースの情報を表示する。 |
  | `ifconfig インターフェース名 操作` | ネットワークインターフェースの操作を行う。     |
  
- 操作

  | 操作                       | 概要                         |
  | -------------------------- | ---------------------------- |
  | `up`                       | インタフェースを有効にする。 |
  | `down`                     | インタフェースを無効にする。 |
  | `IPアドレス`               | IPアドレスを設定する。       |
  | `netmask サブネットマスク` | サブネットマスクを設定する。 |

### ifup, ifdown

- `ifup`, `ifdown`コマンドは、ネットワークインターフェースを有効・無効にする。

  ```bash
  ifup, ifdown [インターフェース名]
  ```

### route

- コマンド

  | コマンド                                                     | 概要                                                         |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | `route`                                                      | ルーティングテーブルを表示する。（`ip route`コマンドと同じ） |
  | `route add [-host, -net] 宛先IPアドレス [gw ゲートウェイのIPアドレス] [reject] [[dev] インタフェース]` | ルーティングテーブルに経路を追加する。                       |
  | `route del [-host, -net] 宛先IPアドレス [gw ゲートウェイのIPアドレス] [[dev] インタフェース]` | ルーティングテーブルの経路を削除する。                       |

- オプション

  | オプション | 概要                                       |
  | ---------- | ------------------------------------------ |
  | `-4`       | IPv4の情報を表示・操作する。（デフォルト） |
  | `-6`       | IPv6の情報を表示・操作する。               |

- [route　～ルーティングテーブルの表示／設定を行う：ネットワークコマンド使い方 - ＠IT](https://atmarkit.itmedia.co.jp/ait/articles/0111/01/news002.html)

## 疎通確認

### ICMP

- ICMP（Internet Control Message Protocol）は、エラー報告プロトコルで、`ping`や`traceroute`コマンドで使われる。

### ping, ping6

- `ping, ping6`コマンドは、宛先までIPパケットが届くか確認できる。

  ```bash
  ping, ping6 FQDNまたはIPアドレス
  ```

- オプション

  | オプション | 概要                                 |
  | ---------- | ------------------------------------ |
  | `-c 回数`  | 送信する回数を指定する。             |
  | `-i 間隔`  | 送信する間隔を指定する。             |
  | `-n`       | ホスト名でなくIPアドレスを表示する。 |

### traceroute, tracepath

- コマンド

  | コマンド                           | 概要                                                    |
  | ---------------------------------- | ------------------------------------------------------- |
  | `traceroute FQDNまたはIPアドレス`  | パケットが伝わる経路を表示する。                        |
  | `traceroute6 FQDNまたはIPアドレス` | パケットが伝わる経路を表示する。（IPv6）                |
  | `tracepath FQDNまたはIPアドレス`   | パケットが伝わる経路と**経路のMTU**を表示する。         |
  | `tracepath6 FQDNまたはIPアドレス`  | パケットが伝わる経路と**経路のMTU**を表示する。（IPv6） |

- MTUは、Maximum Transmission Unitのこと。

## ネットワークの状態

### netstat

- `netstat`コマンドは、ネットワークの各種状態を表示する。

  ```bash
  netstat
  ```

- オプション

  | オプション | 概要                             |
  | ---------- | -------------------------------- |
  | `-a`       | 全てのソケット情報を表示する。   |
  | `-r`       | ルーティングテーブルを表示する。 |
  | `-t`       | TCPポートのみ表示する。          |
  | `-u`       | UDPポートのみ表示する。          |

### ss

- `ss`コマンドは、ネットワークの各種状態を表示する。

  ```bash
  ss [フィルター]
  ```

### nmap

- `nmap`コマンドは、指定したホストのポートスキャンを行う。

  ```bash
  nmap FQDNまたはIPアドレス
  ```

### nethogs, iftop

- `nethogs`コマンドで、どのプロセスの通信量が多いかを調べることができる。
- `iftop`コマンドで、どの通信相手との通信量が多いかを調べることができる。

## その他

### nc

- `nc`（Netcat）コマンドは、`cat`コマンドと同様の働きをネットワーク上で行う。

  ```bash
  nc [ホスト名] [ポート番号]
  ```

- オプション

  | オプション          | 概要                           |
  | ------------------- | ------------------------------ |
  | `-l`                | 指定したポートをリッスンする。 |
  | `-o 出力ファイル名` | 指定したファイルに出力する。   |

- [nc(netcat)コマンドのいろんな使い方 - DENET 技術ブログ](https://blog.denet.co.jp/netcat-command/)
