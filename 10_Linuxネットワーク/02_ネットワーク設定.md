# ネットワーク設定

## 共通

### 使用するコマンド

- net-toolsのコマンドは非推奨であり、iproute2のコマンドを使用するのがよい。
- [net-toolsとiproute2のコマンド対応早見表 | 俺的備忘録 〜なんかいろいろ〜](https://orebibou.com/ja/home/201412/20141215_002/)
- [ifconfigコマンドとipコマンドの違いと比較 – エラーの向こうへ](https://tech.mktime.com/entry/211)

## ネットワークインターフェース

### 設定

- `/etc/hostname`ファイルには、ホスト名を記述する。
- `/etc/network/interfaces`ファイルには、Debian系ディストリビューションで、ネットワークインターフェースの設定を記述する。
- `/etc/sysconfig/network-scripts`ファイルには、Red Hat系ディストリビューションで、ネットワークインターフェースの設定を記述する。
- `/etc/services`ファイル
  - ポート番号とサービスの対応が記述されている。
  - `netstat`コマンドでの名前解決などに使われる。

### ifconfig|ipconfig

- `ifconfig`コマンドは、ネットワークインターフェースの表示・設定を行う。

  ```bash
  ifconfig [ネットワークインターフェース名] [パラメータ]
  ```

- Windowsでは、代わりに`ipconfig`コマンドを使う。

### ifup|ifdown

- `ifup`, `ifdown`コマンドは、ネットワークインターフェースを有効・無効にする。

  ```bash
  ifup|ifdown [ネットワークインターフェース名]
  ```

### ip a

- `ip a`コマンドは、ネットワークデバイスのIPアドレスを管理する。

  ```bash
  ip a|addr|address [サブコマンド]
  ```

- サブコマンド
  - `show`：表示する。（省略時のデフォルト）
  - `add`：設定する。
  
- `eth0`などを「インタフェース名」と呼び、環境によって様々な種類がある。
  また`lo`は「ローカルループバック」のことである。

### hostname

- `hostname`コマンドは、ホスト名を表示する。

  ```bash
  hostname
  ```

- `hostname ホスト名`コマンドは、ホスト名を変更する。

  ```bash
  hostname ホスト名
  ```

## NetworkManager

### 概要

- Red Hat系ディストリビューションでは、**NetworkManager**というネットワーク管理システムが導入されている。

### nmcli

- `nmcli`コマンドは、NetworkManagerの設定を行う。

  ```bash
  nmcli オブジェクト [コマンド]
  ```

- オブジェクト

  - `general`は、操作一般。
  - `networking`は、ネットワーク管理全般。
  - `radio`は、無線ネットワーク。
  - `connection`は、接続。
  - `device`は、デバイス。

### hostnamectl

- `hostnamectl`コマンドは、ホスト名を設定する。

  ```bash
  hostnamectl [サブコマンド]
  ```

- `status`サブコマンドまたはサブコマンドを省略すると、ホスト名と関連情報を表示する。

- `set-hostname ホスト名`サブコマンドは、ホスト名を設定する。

## ネットワークの状態

### netstat

- `netstat`コマンドは、ネットワークの各種状態を表示する。

  ```bash
  netstat
  ```

- `-a`オプションで、全てのソケット情報を表示する。
- `-r`オプションで、ルーティングテーブルを表示する。
- `-t`オプションで、TCPポートのみ表示する。
- `-u`オプションで、UDPポートのみ表示する。

### ss

- `ss`コマンドは、ネットワークの各種状態を表示する。

  ```bash
  ss [フィルター]
  ```

### nmap

- `nmap`コマンドは、指定したホストのポートスキャンを行う。

  ```bash
  nmap FQDNまたはIPアドレス
  ```

## ルーティング

### route

- `route`コマンドは、ルーティングテーブルを表示する。（`ip route`コマンドと同じ）

  ```bash
  route
  ```

- `route add`コマンドは、ルーティングテーブルに経路を追加する。

  ```bash
  route add [-host|-net] 宛先IPアドレス [gw ゲートウェイのIPアドレス] [reject] [[dev] インタフェース]
  ```

- `route del`コマンドは、ルーティングテーブルの経路を削除する。

  ```bash
  route del [-host|-net] 宛先IPアドレス [gw ゲートウェイのIPアドレス] [[dev] インタフェース]
  ```

- オプション
  - `-4`オプションで、IPv4の情報を表示・操作する。（デフォルト）
  - `-6`オプションで、IPv6の情報を表示・操作する。
  
- [route　～ルーティングテーブルの表示／設定を行う：ネットワークコマンド使い方 - ＠IT](https://atmarkit.itmedia.co.jp/ait/articles/0111/01/news002.html)

### ip r

- `ip r`コマンドは、ルーティングテーブルを管理する。

  ```bash
  ip r|route [サブコマンド]
  ```

## 疎通確認

### ICMP

- ICMP（Internet Control Message Protocol）は、エラー報告プロトコルで、`ping`や`traceroute`コマンドで使われる。

### ping|ping6

- `ping|ping6`コマンドは、宛先までIPパケットが届くか確認できる。

  ```bash
  ping|ping6 FQDNまたはIPアドレス
  ```

- `-c 回数`オプションで、送信する回数を指定できる。

- `-i 間隔`オプションで、送信する間隔を指定できる。

- `-n`オプションで、ホスト名でなくIPアドレスを表示する。

### traceroute|traceroute6

- `traceroute|traceroute6`コマンドは、パケットが伝わる経路を表示する。

  ```bash
  traceroute|traceroute6 FQDNまたはIPアドレス
  ```

### tracepath|tracepath6

- `tracepath|tracepath6`コマンドは、パケットが伝わる経路と**経路のMTU（Maximum Transmission Unit）**を表示する。

  ```bash
  tracepath|tracepath6 FQDNまたはIPアドレス
  ```

## その他

### nc

- `nc`コマンドは、`cat`コマンドと同様の働きをネットワーク上で行う。

  ```bash
  nc [ホスト] [ポート番号]
  ```

### nethogs, iftop

- `nethogs`コマンドで、どのプロセスの通信量が多いかを調べることができる。
- `iftop`コマンドで、どの通信相手との通信量が多いかを調べることができる。
