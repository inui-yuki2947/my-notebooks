# 暗号化・復号

## 共通

### 暗号化方式

- 暗号化方式には、共通鍵暗号方式と公開鍵暗号方式がある。

  | 項目           | 概要                               | 代表アルゴリズム                  | 速度 | 鍵の数       |
  | -------------- | ---------------------------------- | --------------------------------- | ---- | ------------ |
  | 共通鍵暗号方式 | 暗号化と復号化の両方で同じ鍵を使う | AES、DES（非推奨）、RC4（非推奨） | 高速 | 多く必要     |
  | 公開鍵暗号方式 | 暗号化と復号化で異なる鍵を使う     | RSA、ECC（楕円曲線暗号）          | 低速 | 少なくて済む |

- 共通鍵暗号方式は、ストリーム暗号化方式とブロック暗号化方式に分かれる。

  | 種類                 | 概要                                        | 速度 | 安全性 |
  | -------------------- | ------------------------------------------- | ---- | ------ |
  | ストリーム暗号化方式 | 1bitや1byteなど細かい単位で暗号化を行う     | 速い | 低い   |
  | ブロック暗号化方式   | 128や256bitなどまとまった単位で暗号化を行う | 遅い | 高い   |

### 暗号利用モード

- 暗号利用モードとは、ブロック暗号を利用して、ブロック長よりも長いメッセージを暗号化するメカニズムのこと。

  | 暗号利用モード                     | 概要                                                         |
  | ---------------------------------- | ------------------------------------------------------------ |
  | ECB（Electronic Codebook）モード   | 最も単純な方式で、同一の平文が同一の暗号文になってしまう。   |
  | CBC（Cipher Block Chaining）モード | 最初に初期化ベクトルを使い、次から前暗号文とのXORを取って暗号化する。 |

### 初期化ベクトル・ソルト

- **初期化ベクトル**（initialization vector、IV）とは、同じ暗号鍵で毎回異なるストリームを生成するために使用するビット列。
- 初期化ベクトルは復号できるようにするが、ソルトは復号できないようにする。

### 実装

- 暗号化・復号を行うソフトウェアとしては、以下のようなものがある。
  - GnuPG
  - OpenSSL

## GnuPG

### gpg

- コマンド

  |コマンド|概要|
  |---|---|
  |`gpg サブコマンド`|GnuPG (Gnu Privacy Guard)を扱える。|

- サブコマンド

  |サブコマンド|概要|
  |---|---|
  |`--gen-key`|公開鍵・秘密鍵を作成する。|
  |`--full-gen-key`|全てのオプションを指定して、公開鍵・秘密鍵を作成する。|
  |`--gen-revoke メールアドレス`|失効証明書（パスフレームが漏れてしまった場合に、鍵を無効化するもの）を作成する。|
  |`--export メールアドレス`|公開鍵をエクスポートする。|
  |`--import 鍵ファイル`|公開鍵をインポートする。|
  |`-k, --list-public-keys, --list-keys`|公開鍵の一覧を表示する。|
  |`-K, --list-secret-keys`|秘密鍵の一覧を表示する。|
  |`-c, --symmetric ファイル名`|共通鍵でファイルを暗号化する。|
  |`-e, --encrypt ファイル名`|公開鍵でファイルを暗号化する。|
  |`-d, --decrypt ファイル名`|公開鍵でファイルを復号する。（デフォルト）|
  |`-s, --sign ファイル名`|ファイルに署名を行う。|
  |`--verify ファイル名`|ファイルの署名を検証する。|

- オプション

  | オプション                 | 概要                                          |
  | -------------------------- | --------------------------------------------- |
  | `-a, --armor`              | ASCII armored形式（拡張子`.asc`）で出力する。 |
  | `-o, --output ファイル名`  | 出力ファイル名を指定する。                    |
  | `-r, --recipient 受信者名` | 受信者名を指定する。                          |

- 暗号化ファイルの拡張子は、`.gpg`となる。

- デフォルトでは、公開鍵・秘密鍵は下記に作成される。

  - 公開鍵：`~/.gnupg/pubring.gpg`
  - 秘密鍵：`~/.gnupg/secring.gpg`

### gpg-agent

- gpg-agentは、ssh-agentと同様、秘密鍵を管理し、パスフレーズのキャッシュを行う。
