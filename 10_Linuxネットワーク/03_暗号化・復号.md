# 暗号化・復号

## 共通

### 暗号化方式

| 項目           | 概要                               | 代表アルゴリズム                  | 速度 | 鍵の数       |
| -------------- | ---------------------------------- | --------------------------------- | ---- | ------------ |
| 共通鍵暗号方式 | 暗号化と復号化の両方で同じ鍵を使う | AES、DES（非推奨）、RC4（非推奨） | 高速 | 多く必要     |
| 公開鍵暗号方式 | 暗号化と復号化で異なる鍵を使う     | RSA、ECC（楕円曲線暗号）          | 低速 | 少なくて済む |

### ストリーム暗号とブロック暗号

- 共通鍵暗号方式は、1bitや1byteなど細かい単位で暗号化を行う**ストリーム暗号化方式**と、128や256bitなどまとまった単位で暗号化を行う**ブロック暗号化方式**に分かれる。
- ストリーム暗号は速度が速いが、ブロック暗号は安全性が高い。

### 暗号利用モード

- 暗号利用モードとは、ブロック暗号を利用して、ブロック長よりも長いメッセージを暗号化するメカニズムのこと。
- **ECB（Electronic Codebook）モード**は、最も単純な方式で、同一の平文が同一の暗号文になってしまう。
- **CBC（Cipher Block Chaining）モード**は、最初に初期化ベクトルを使い、次から前暗号文とのXORを取って暗号化する。

### 初期化ベクトル・ソルト

- **初期化ベクトル**（initialization vector、IV）とは、同じ暗号鍵で毎回異なるストリームを生成するために使用するビット列。
- 初期化ベクトルは復号できるようにするが、ソルトは復号できないようにする。

### 実装

- 暗号化・復号を行うソフトウェアとしては、以下のようなものがある。
  - GnuPG (Gnu Privacy Guard)
  - OpenSSL

## GnuPG

### 概要

- `gpg`コマンドで、GnuPGを扱える。

  ```bash
  gpg
  ```

- 暗号化ファイルの拡張子は、`.gpg`となる。

### 作成

- `--full-generate-key`サブコマンドは、以下を作成する。
  - 公開鍵（`~/.gnupg/pubring.gpg`）
  - 秘密鍵（`~/.gnupg/secring.gpg`）
- `--gen-revoke メールアドレス`サブコマンドは、失効証明書（パスフレームが漏れてしまった場合に、鍵を無効化するもの）を作成する。

- `--export メールアドレス`サブコマンドは、公開鍵をエクスポートする。
- `--import 鍵ファイル`サブコマンドは、公開鍵をインポートする。

### 表示

- `--list-keys`サブコマンドは、公開鍵の一覧を表示する。

### 暗号化・復号

- `-c ファイル名`サブコマンドは、共通鍵でファイルを暗号化する。
- `-e|--encrypt ファイル名`サブコマンドは、公開鍵でファイルを暗号化する。
- `-d|--decrypt ファイル名`サブコマンド、またはサブコマンド未指定時は、公開鍵でファイルを復号する。

### 署名

- `-s|--sign ファイル名`サブコマンドは、ファイルに署名を行う。
- `--verify ファイル名`サブコマンドは、ファイルの署名を検証する。

### オプション

- `-o|--output ファイル名`オプションで、出力ファイル名を指定できる。
- `-r|--recipient 受信者名`オプションで、受信者名を指定できる。
