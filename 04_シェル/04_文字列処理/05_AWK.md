# シェル/文字列処理/AWK

## 共通

### コマンド

|コマンド|概要|
|---|---|
|`awk 'スクリプト' [ファイル名...]`|指定したファイル（省略時は標準入力）に対して、指定したスクリプトを実行する。|
|`awk -f スクリプトファイル名 [ファイル名...]`|指定したファイル（省略時は標準入力）に対して、スクリプトファイルの内容を実行する。|

### オプション

| オプション      | 概要                                         |
| --------------- | -------------------------------------------- |
| `-v 変数名=値`  | 変数を定義し、スクリプト内で使用可能とする。 |
| `-F 区切り文字` | 区切り文字を指定する。                       |

## 文法

### スクリプト

| スクリプト              | 概要                                               | 例                           |
| ----------------------- | -------------------------------------------------- | ---------------------------- |
| `パターン {アクション}` | パターンに当てはまる行について、アクションを行う。 | `$5 >= 1000000 { print $2 }` |
| `パターン`              | パターンに当てはまる行について、行全体を出力する。 |                              |
| `{アクション}`          | 全ての行について、アクションを行う。               |                              |
| `BEGIN {アクション}`    | 処理前にアクションを行う。                         |                              |
| `END {アクション}`      | 処理後にアクションを行う。                         |                              |

### 変数

| 変数  | 概要                                      | デフォルト値 |
| ----- | ----------------------------------------- | ------------ |
| `$0`  | 行全体                                    |              |
| `$n`  | 行を空白文字で区切ったn番目のフィールド。 |              |
| `NR`  | 現在処理しているレコード番号（行番号）    |              |
| `FS`  | 入力時のフィールドの区切り文字            | 半角スペース |
| `OFS` | 出力時のフィールドの区切り文字            | 半角スペース |

### パターン

| パターン     | 概要                     | 例              |
| ------------ | ------------------------ | --------------- |
| `比較式`     | 比較式を評価する。       | `$5 >= 1000000` |
| `/正規表現/` | 拡張正規表現を評価する。 | `/^l/`          |

### パターンの組み合わせ

| 書式                   | 概要                       |
| ---------------------- | -------------------------- |
| `パターン && パターン` | AND条件で評価する。        |
| `パターン ｜｜ パターン` | OR条件で評価する。         |
| `! パターン`           | パターンの否定で評価する。 |

### アクション（出力系）

| アクション           | 概要                                         |
| -------------------- | -------------------------------------------- |
| `print`              | 行全体を出力する。                           |
| `print 値1 値2 ...`  | 値を**直接連結して**出力する。               |
| `print 値1,値2, ...` | 値を**区切り文字で連結して**出力する。       |
| `printf "書式", 値`  | 値を書式の通り出力する。（改行は行われない） |

### アクション（制御系）

| アクション                     | 概要                                         |
| ------------------------------ | -------------------------------------------- |
| `if (条件) 処理1 [else 処理2]` | 条件を満たす場合に、処理を実行する。         |
| `while (条件) 処理`            | 条件を満たす場合に、繰り返し処理を実行する。 |
| `for (変数名 in 配列名) 処理`  | 配列の要素について、繰り返し処理を実行する。 |

### その他

- awkスクリプトのシバン

  ```text
  #!/usr/bin/awk -f
  ```
