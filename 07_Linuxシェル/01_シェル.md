# シェル

## 共通

### 概要

- シェルは、**グルー言語**（ソフトウェアコンポーネント同士を結びつける言語）とも呼ばれる。

### 主要なシェル

| 分類      | シェル | 概要                                                         |
| --------- | ------ | ------------------------------------------------------------ |
| Bシェル系 | sh     | 最も基礎的なシェル。                                         |
| Bシェル系 | bash   | shの拡張版。                                                 |
| Bシェル系 | zsh    | 様々なシェルを拡張子したシェル。最新版Macのデフォルトシェル。 |
| Cシェル系 | csh    |                                                              |
| Cシェル系 | tcsh   |                                                              |

- `/etc/shells`ファイルで、使用可能なシェル一覧を確認できる。
- [【Linux】コマンドまとめ 〜コマンド名の由来を添えて〜 - Qiita](https://qiita.com/taji-taji/items/0b4bcccf097371bc143c)

### GNUとBSD

- LinuxはGNU系、MacはBSD系であり、挙動が異なるコマンドがある。

- MacでGNU版のコマンドを利用するには、GNU版のコマンドをインストールするとよい。

  ```bash
  brew install grep
  brew install gnu-sed
  ```

## chsh

### コマンド

|コマンド|概要|
|---|---|
|`chsh`|カレントユーザーのデフォルトのシェルを、対話的に変更する。|
|`chsh ユーザー`|指定したユーザーのデフォルトのシェルを、対話的に変更する。|

### オプション

| オプション        | 概要                                         |
| ----------------- | -------------------------------------------- |
| `-s シェルのパス` | 対話的でなく、デフォルトのシェルを変更する。 |

### その他

- 使用するシェルは、下記でも表示・変更できる。
  - 環境変数`SHELL`（あまり信頼できない）

  - `/etc/passwd`ファイル

## ショートカット

### コマンド履歴系

| ショートカット | 概要                                                         |
| -------------- | ------------------------------------------------------------ |
| `Ctrl + R`     | インクリメンタル検索を行う・選択肢を進める。                 |
| `Ctrl + S`     | インクリメンタル検索の選択肢を戻る。<br />通常では`Ctrl + S`がスクリーンロックに割り当てられているので、`stty stop undef`などとして解除する必要がある。 |

### 処理系

| ショートカット | 概要                                                     |
| -------------- | -------------------------------------------------------- |
| `Ctrl + C`     | 処理をキャンセルする。                                   |
| `Ctrl + D`     | 入力の終わりを示す。入力中の文字が存在しなければ終了する |
| `Ctrl + Z`     | 処理を一時中断する。                                     |

### その他

| ショートカット | 概要                                          |
| -------------- | --------------------------------------------- |
| `Ctrl + S`     | スクリーンロックを行う。                      |
| `Ctrl + Q`     | スクリーンロックを解除する。                  |
| `Ctrl + V`     | 次の1回、タブ文字などの特殊文字を入力できる。 |

### ドキュメント

- [bashで覚えておきたいショートカットキー(キーバインド) | 俺的備忘録 〜なんかいろいろ〜](https://orebibou.com/ja/home/201506/20150629_001/)

## コマンド, eval, bash, exec

### コマンド

| コマンド                     | 概要                                                         |
| ---------------------------- | ------------------------------------------------------------ |
| `コマンド [引数...]`         | **カレントシェル**で、コマンドを実行する。                   |
| `eval コマンド [引数...]`    | **カレントシェル**で、コマンドを実行する。<br />変数の値にパイプやリダイレクトを含む場合も、正常に解釈される。 |
| `bash -c コマンド [引数...]` | **子プロセス**で、コマンドを実行する。                       |
| `exec コマンド [引数...]`    | **現在のプロセス**で、コマンドを実行する。                   |

### ドキュメント

- [技術メモメモ: シェルスクリプトで変数に入れたコマンドを実行する方法の比較(evalコマンドなどの動作比較)](https://tech-mmmm.blogspot.com/2017/11/eval.html)

## source, bash

### コマンド

| コマンド                                                    | 概要                                                         |
| ----------------------------------------------------------- | ------------------------------------------------------------ |
| `. ファイル名 [引数...]`<br />`source ファイル名 [引数...]` | **カレントシェル**で、指定したファイルのコマンドを実行する。 |
| `bash`                                                      | **子プロセス**で、標準入力のコマンドを実行する。             |
| `bash ファイル名 [引数...]`                                 | **子プロセス**で、指定したファイルのコマンドを実行する。     |
| `ファイル名 [引数...]` ※1                                   | **子プロセス**で、指定したファイルのコマンドを実行する。<br />（ファイルの実行権限が必要） |

- ※1 ファイルがカレントディレクトリにある場合は、`./ファイル名 [引数...]`とする必要がある。

## グループコマンド

### コマンド

| 記法                                | 概要                                                         |
| ----------------------------------- | ------------------------------------------------------------ |
| `{ コマンド1 ; コマンド2 ; ... ; }` | **カレントシェル**で、複数のコマンドを実行し、まとめて標準出力する。 |
| `( コマンド1 ; コマンド2 ; ... )`   | **サブシェル**で、複数のコマンドを実行し、まとめて標準出力する。 |

### その他

- サブシェルでは、シェル変数・環境変数は引き継がれるが、サブシェル内での変更は反映されない。

## オプション

### ドキュメント

- [Linux系システムのコマンドラインオプションについて調べたメモ - Qiita](https://qiita.com/rubytomato@github/items/2ee2fd4127eadc1f1193)

### 記法

- ハイフン1つの場合

  - オプション同士は、連結できる。

    ```bash
    ls -tr
    ```

  - オプション→オプション引数の順は連結でき、オプション引数→オプションの順は連結できない。

    ```bash
    ls -tw100 -r
    ```

- ハイフンが2つの場合

  - オプション引数が必須の場合、半角スペースまたは`=`で区切る。

    ```bash
    ls --sort none
    ls --sort=none
    ```

  - オプション引数が任意の場合、`=`で区切る。

    ```bash
    ls --color=always
    ```

- ハイフンをつける文化の前から存在していたコマンドでは、ハイフンをつけなくてもよいオプションもある。

### コマンド -- 引数

- `--`以降に記述した文字列は、オプションとして解析されなくなる。
