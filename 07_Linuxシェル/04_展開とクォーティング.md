# 展開とクォーティング

## 共通

### 概要

- シェルは、クォーテーションで囲まれていないコマンド引数について、パス名展開・チルダ展開・ブレース展開を行う。

- クォーテーション

  | 種類                     | 概要                                          |
  | ------------------------ | --------------------------------------------- |
  | シングルクォーテーション | 全ての特殊文字がエスケープされる。            |
  | ダブルクォーテーション   | ``$, `, \``以外の特殊文字がエスケープされる。 |

### パス名展開

- 以下のメタキャラクタは、**ファイル名**に置き換えられる。

  | 記法                     | 概要                     | 例       |
  | ------------------------ | ------------------------ | -------- |
  | `*`                      | 任意の0文字以上          |          |
  | `?`                      | 任意の1文字              |          |
  | `[文字1文字2...]`        | 指定した文字のいずれか   | `[abc]`  |
  | `[文字1-文字2]`          | 文字1から文字2までの文字 | `[a-z]`  |
  | `[^文字]`<br />`[!文字]` | 指定した文字以外の文字   | `[^abc]` |

### チルダ展開

- 記法

  | 記法          | 概要                                         |
  | ------------- | -------------------------------------------- |
  | `~ユーザー名` | 指定ユーザーのホームディレクトリに展開する。 |

- クォーテーション内でホームディレクトリを記述したい場合は、環境変数`HOME`を使うとよい。

### ブレース展開

- 記法

  | 記法                    | 概要                                                   | 例                 |
  | ----------------------- | ------------------------------------------------------ | ------------------ |
  | `{文字列1,文字列2,...}` | 各文字列に展開する。                                   | `{hoge,fuga,piyo}` |
  | `{文字列1..文字列2}`    | 文字列1から文字列2までの文字列に展開する。（逆順も可） | `{1..10}`          |

### パラメータ展開

- 記法

  | 記法                       | 概要                                              |
  | -------------------------- | ------------------------------------------------- |
  | `${変数名:-デフォルト値}`  | デフォルト値を設定する。                          |
  | `${変数名:n:m}`            | 変数のn文字目からm文字目まで切り出す。（0始まり） |
  | `${変数名#文字列}`         | 変数の一部分を、**前方最短一致**で取り除く。      |
  | `${変数名##文字列}`        | 変数の一部分を、**前方最長一致**で取り除く。      |
  | `${変数名%文字列}`         | 変数の一部分を、**後方最短一致**で取り除く。      |
  | `${変数名%%文字列}`        | 変数の一部分を、**後方最長一致**で取り除く。      |
  | `${変数名/置換前/置換後}`  | 変数を置換する。                                  |
  | `${変数名//置換前/置換後}` | 変数を複数回置換する。                            |

- [【シェル芸人への道】Bashの変数展開と真摯に向き合う - Qiita](https://qiita.com/t_nakayama0714/items/80b4c94de43643f4be51#parameterpattern-%E5%A4%A7%E6%96%87%E5%AD%97%E5%8C%96)

### プロセス置換

- プロセス置換は、コマンドの結果を仮想的なファイルとして利用できる。
（コマンドの結果が、自動的に作成された**ファイルパス名**に置換される）
- 使い道としては、2つ以上ファイルを指定するコマンド（「diff」コマンドなど）で使用する。

  ```bash
  diff <(ls .) <(ls ..)
  ```

### 履歴展開

- 履歴展開は、対話的シェルでのみ行われる。

  | 記法                | 概要                             |
  | ------------------- | -------------------------------- |
  | `!コマンド履歴番号` | コマンド履歴の当該番号           |
  | `!!`                | 直前のコマンド                   |
  | `!文字列`           | 当該文字列で始まる最後のコマンド |

### その他

- 信頼できない変数（下記など）を参照する場合は、単語分割やパス名展開を防ぐため、またセキュリティ対策のため、**`""`で囲んでおく**。
  - 外側から渡される引数
  - 環境変数
  - コマンドの実行結果

## 算術計算

### 整数型変数

- コマンド

  |コマンド|概要|
  |---|---|
  |`declare -i 変数名[=値]`|整数型の変数を定義できる。|

- 整数型変数への代入

  - 右辺は、算術式評価される。
  - 右辺は、スペースを含めない。
  
- 例

  ```bash
  declare -i a
  a=b+1
  ```

### 算術式評価

- コマンド

  | コマンド                     | 概要                                                         |
  | ---------------------------- | ------------------------------------------------------------ |
  | `((式または式を含む代入式))` | 式の算術式評価結果が`0`の場合は、終了ステータス`1`を返す。<br />式の算術式評価結果が`0`以外の場合は、終了ステータス`0`を返す。 |
  | `$((式))`                    | 式の算術式評価の結果に展開される。（算術式展開）             |

- 式の記法

  - スペースは含めても含めなくてもよい。

  - `*, >>, |`などは、算術式の演算子とみなされる。

  - 変数名の前の`$`は、付けなくてもよい。

### expr, let, bc

- コマンド

  |コマンド|概要|式|
  |---|---|---|
  |`expr 式`|式を評価し標準出力する。|式には、スペースを含める。 <br />`*`を使う場合は、パス名展開されないようクォートする。|
  |`let 変数=式`|式を評価し代入する。|式には、スペースを含めない。|
  |`bc [ファイル名]`|ファイルまたは標準入力から読み込んで計算を行う。||

- `bc`コマンドでは、標準では小数点以下を表示しないが、`scale=小数点以下の桁数`と入力することで、表示されるようになる。
