# ファイルシステム

## 共通

### 概要

- ファイルを保存するためには、パーティション上にファイルシステムを作る必要がある。

### 種類

| 名称                         | 概要                                                         | コマンド     |
| ---------------------------- | ------------------------------------------------------------ | ------------ |
| ext4（extended file system） | 多くのLinuxディストリビューションの標準ファイルシステム      | `mke2fs`     |
| Btrfs（B-tree file system）  | Linux向けの新しいファイルシステム                            | `mkfs.btrfs` |
| XFS（eXtents File System）   | CentOS 7などで標準となっている、ジャーナリングファイルシステム | `mkfs.xfs`   |

## mkfs

### コマンド

|コマンド|概要|
|---|---|
|`mkfs デバイス名`|パーティション上にファイルシステムを作成する。（各種ファイルシステムのフロントエンド）|

### オプション

|オプション|概要|
|---|---|
|`-t ファイルシステムタイプ`|ファイルシステムタイプを指定できる。|

## mkswap

### コマンド

| コマンド            | 概要                                       |
| ------------------- | ------------------------------------------ |
| `mkswap デバイス名` | パーティション上にスワップ領域を作成する。 |

## XFS

### コマンド

| コマンド  | 概要                                  |
| --------- | ------------------------------------- |
| `xfs_db`  | XFSファイルシステムのデバッグを行う。 |
| `xfs_fsr` | XFSファイルシステムのデフラグを行う。 |

## fsck, e2fsck

### コマンド

|コマンド|概要|
|---|---|
|`fsck デバイス名`|ディスクのチェックを行い、必要であれば修復を試みる。|
|`e2fsck デバイス名`|ディスクのチェックを行い、必要であれば修復を試みる。（ext2, ext3, ext4）|

### オプション

|オプション|概要|
|---|---|
|`-A`|`/etc/fstab`ファイルに記述されている全ファイルシステムをチェックする。|

## tune2fs

### コマンド

|コマンド|概要|
|---|---|
|`tune2fs デバイス名`|ext2, ext3, ext4の様々なパラメータを指定する。|

### オプション

| オプション | 概要                                                   |
| ---------- | ------------------------------------------------------ |
| `-c 回数`  | 何回マウント後にファイルシステムを検査するか指定する。 |
| `-i 間隔`  | ファイルシステムを検査する間隔を指定する。             |

## mount, umount

### コマンド

| コマンド                                  | 概要                                                         |
| ----------------------------------------- | ------------------------------------------------------------ |
| `mount`                                   | マウント状況を表示する。                                     |
| `mount [デバイス名] [マウントポイント]`   | ファイルシステムをマウントする。<br />引数のどちらかを省略すると、`/etc/fstab`ファイルの記述が参照される。 |
| `umount デバイス名またはマウントポイント` | ファイルシステムをアンマウントする。                         |

### オプション（`mount`）

| オプション                  | 概要                                                 |
| --------------------------- | ---------------------------------------------------- |
| `-a, --all`                 | `/etc/fstab`ファイルの全てのデバイスをマウントする。 |
| `-t ファイルシステムタイプ` | ファイルシステムタイプを指定する。                   |

## /etc/fstab

### 概要

- `/etc/fstab`ファイルには、マウントするファイルシステムの情報を記述する。

### 記法

```text
デバイス名   マウントポイント   ファイルシステムの種類   マウントオプション   dumpフラグ   fsckフラグ
```

### 例

```text
/dev/sda1        /home           ext4    defaults        1 1
```

## /etc/mtab

### 概要

- `/etc/mtab`ファイルには、マウントされたファイルシステムの情報が格納される。

## ディレクトリ

### トップディレクトリ

| ディレクトリ | 概要                                                         |
| ------------ | ------------------------------------------------------------ |
| `/dev`       | デバイスファイルが格納される。<br />udev (Userspace DEVice management)という仕組みによって、自動的に作成される。 |
| `/media`     | DVD-ROMなど、リムーバブルメディアのマウントポイントが配置される。 |
| `/mnt`       | 一時的にマウントするファイルシステムのマウントポイントが配置される。 |
| `/opt`       | パッケージ管理の仕組みによって、プログラムがインストールされる。 |
| `/proc`      | カーネルが認識しているデバイスの情報が確認できる。           |
| `/home`      | 一般ユーザーがそれぞれ利用するファイルが格納される。         |
| `/root`      | rootユーザーが利用するファイルが格納される。                 |
| `/usr`       | システムの起動には必須でない、プログラムやライブラリ、ドキュメントが格納される。 |

- [Linuxディレクトリ構造 - Qiita](https://qiita.com/nys9302/items/a8ddeedd3cd9d0deb332)

### デバイスファイル

| ファイル                  | 概要                               |
| ------------------------- | ---------------------------------- |
| `/dev/sda, sdb, sdc, sdd` | SCSI接続の1〜4番目のハードディスク |
| `/dev/hda, hdb, hdc, hdd` | IDE接続の1〜4番目のハードディスク  |
| `/dev/sr0`                | CD/DVDドライブの1番目              |
| `/dev/st0`                | テープドライブの1番目              |

### 疑似デバイス

| ファイル       | 概要                                   |
| -------------- | -------------------------------------- |
| `/dev/null`    | あらゆる入力を受け付け、それを捨てる。 |
| `/dev/zero`    | NULL文字                               |
| `/dev/random`  | 乱数を再利用しない、真の乱数文字列     |
| `/dev/urandom` | 乱数を再利用した、擬似乱数文字列       |

### /proc

| ファイル          | 概要                                           |
| ----------------- | ---------------------------------------------- |
| `/proc/cpuinfo`   | CPUに関する情報                                |
| `/proc/meminfo`   | メモリに関する情報                             |
| `/proc/modules`   | ロードされているカーネルモジュールに関する情報 |
| `/proc/dma`       | 使用中のDMAチャネルに関する情報                |
| `/proc/scsi/scsi` | SCSIデバイスに関する情報                       |
| `/proc/bus/usb/*` | USBデバイスの情報                              |
| `/proc/bus/pci/*` | PCIデバイスの情報                              |

### /usr

| ディレクトリ          | 概要                                                         |
| --------------------- | ------------------------------------------------------------ |
| `/usr/bin, /usr/sbin` | 緊急時のシステム管理に必須でないコマンドが配置される。       |
| `/usr/local`          | 更に`bin, sbin lib`などのディレクトリに細分化され、<br/>ローカルシステムで必要とされるコマンド、自作のコマンドなどが配置される。 |
| `/usr/share`          | アーキテクチャに依存しないファイルが配置される。             |
| `/usr/share/man`      | マニュアルが配置される。                                     |

- [「/bin」「/usr/bin」「/usr/local/bin」ディレクトリの使い分け - Linux技術者認定 LinuC | LPI-Japan](https://linuc.org/study/knowledge/544/)
