# Git

## 共通

### ドキュメント

- [Git - Book](https://git-scm.com/book/ja/v2)

### 作業スペース

- ワークツリー（ワーキングツリー）
  - 今作業している場所
  - 変更分は**赤色**で表示
- インデックス
  - リポジトリにコミットするファイルがある場所
  - 変更分は**緑色**で表示
- リポジトリ
  - Gitで履歴が管理された場所

### ブランチ

- [GitのHEADとは何者なのか - Qiita](https://qiita.com/ymzk-jp/items/00ff664da60c37458aaa)
- Gitにおけるブランチは、単にコミットを指す軽量なポインタに過ぎない。
- ブランチ・タグ名は、コミットIDのエイリアスである。
- 「detached HEAD」とは、HEADがブランチを指していない状態のことである。

### チルダとキャレット

- [【やっとわかった！】gitのHEAD^とHEAD~の違い - Qiita](https://qiita.com/chihiro/items/d551c14cb9764454e0b9)
- `~n`は、親1つ目をn世代遡ったものを表す。
  - `HEAD~`：親1つ目
  - `HEAD~~`：親1つ目の親1つ目
  - `HEAD~2`：親1つ目の親1つ目
- `^n`は、複数親がいる場合に、n番目の親を表す。（マージコミットを遡りたい場合などに使う）
  - `HEAD^`：親1つ目
  - `HEAD^^`：親1つ目の親1つ目
  - `HEAD^2`：親2つ目
  - `HEAD^2^`：親2つ目の親1つ目

### ドット表記

- [git diff と git log におけるドット表記](https://zenn.dev/yoichi/articles/git-dotted-notations)

### AuthorとCommiter

- Authorは、オリジナルのコードを書いた人。
- Committerは、コミットをした人。

### CLI

- 引数でコミットを取る場合、省略すると原則`HEAD`となる。

## リポジトリ操作

### remote

- `remote`コマンドは、リモートリポジトリの名前を表示する。

  ```bash
  git remote
  ```

- `-v`オプションで、fetchとpullそれぞれについて、URLも合わせて表示する。

### remote add

- `remote add`コマンドは、リモートリポジトリを追加する。

  ```bash
  git remote add リポジトリ リポジトリURL
  ```

### remote remove

- `remote remove`コマンドは、リモートリポジトリを削除する。

  ```bash
  git remote remove リポジトリ
  ```

### remote prune

- `remote prune`コマンドは、消え残っているリモートブランチを削除する。

  ```bash
  git remote prune リポジトリ
  ```

### clone

- `clone`コマンドは、リモートリポジトリをローカルリポジトリに複製する。

  ```bash
  git clone リポジトリURL
  ```

### fork

- `fork`コマンドは、リモートリポジトリを自分のアカウントの**リモートリポジトリ**にコピーする。

## コミット操作

### log

- `log`コマンドは、コミット履歴を表示する。

  ```bash
  git log
  ```

- `--reverse`オプションで、ログを古い順に表示する。

- `--oneline`オプションで、ログを一行で表示させる。

- `--date=format:"フォーマット"`オプションで、日時のフォーマットを指定できる。

  - 例：`--date=format:"%Y/%m/%d %H:%M:%S"`

- `--pretty=format:"フォーマット"`オプションで、項目のフォーマットを指定できる。
  [git logのフォーマットを指定する - Qiita](https://qiita.com/harukasan/items/9149542584385e8dea75)

  - `%h`：コミットID（短縮形）
  - `%x09`：タブ文字

### show

- `show`コマンドは、コミット詳細を表示する。

  ```bash
  git show [コミット]
  ```

### add

- `add`コマンドは、指定したファイルをインデックスに追加（ステージ）する。

  ```bash
  git add ファイル
  ```

### rm

- `rm`コマンドは、ワークツリー・インデックスから、ファイルを削除する。

  ```bash
  git rm ファイル
  ```

- `--cached`オプションで、インデックスからのみ、ファイルを削除できる。

### commit

- `commit`コマンドは、インデックスにあるものをコミットする。

  ```bash
  git commit [ファイル名...]
  ```

- `-m メッセージ`オプションで、コミットメッセージを指定できる。

- `-a`オプションで、管理対象ファイルが全て`add`されコミットされる。
  （管理対象外ファイルは、先に`add`を行っておく必要がある）

- `-m, --message メッセージ`オプションで、メッセージを指定できる。

- `--no-edit`オプションで、メッセージの編集を省略できる。

### revert

- `revert`コマンドは、コミットを打ち消す。

  ```bash
  git revert 打ち消したいコミット
  ```

- `--mainline, -m <parent-number>`オプションで、マージコミットを打ち消すことができる。
  - `<parent-number>`は、`1`がマージされた側のブランチ、`2`がマージする側のブランチ。（なので基本的には`1`を指定する）
  - [GitでMerge CommitをRevertする方法 - Qiita](https://qiita.com/awakia/items/5fad0c454ddc7b478ff1)

## ブランチ・タグ操作

### branch

- `branch`コマンドは、ブランチ一覧を表示する。

  ```bash
  git branch
  ```

- `-a`オプションで、リモートブランチも表示する。
- `-v`オプションで、詳細情報を表示する。
- `-vv`オプションで、更に上流ブランチの情報も表示する。
- `--merged [コミット]`オプションで、指定したコミットにマージ済みのブランチのみ表示する。

### branch ブランチ名

- `branch ブランチ名`コマンドは、ブランチを作成する。

  ```bash
  git branch ブランチ名 [派生元コミット]
  ```

- 派生元コミットでリモートブランチを指定すると、それが上流ブランチとなる。

### git branch -m

- `branch -m`コマンドは、ブランチ名を変更する。

  ```ba
  git branch -m [変更前ブランチ名] 変更後ブランチ名
  ```

### tag

- `tag`コマンドは、タグ一覧を表示する。

  ```bash
  git tag
  ```

### tag タグ名

- `tag タグ名`コマンドは、タグを作成する。

  ```bash
  git tag タグ名 [タグを付けるコミット]
  ```

## チェックアウト・リセット

### 概要

- [Git の Reset, Checkout, Revert の違い - yu8mada](https://yu8mada.com/2018/06/01/the-difference-between-reset-checkout-and-revert-in-git/)
- `checkout`コマンドは、ブランチ・ワークツリー・インデックスを変更する。
- `reset`コマンドは、ブランチを変更せず、（ワークツリー・）インデックスを変更する。

### checkout（ファイル未指定）

- 書式

  ```bash
  git checkout コミット
  ```

- ブランチの移動
  - 引数でローカルブランチを指定した場合、そのブランチに切り替わる。
  - 引数でローカルブランチ以外を指定した場合、「detached HEAD」状態となる。
- 未コミットの変更があればエラーとなる。

### checkout（ファイル指定）

- 書式

  ```bash
  git checkout [コミット] ファイル
  ```

- ファイルのみ指定した場合、ワークツリーがインデックスの状態となる。
- コミット・ファイルを指定した場合、ワークツリー・インデックスが、指定したコミットのファイルの状態となる。

### checkout（-bオプション指定）

- 書式

  ```bash
  git checkout -b 新しいブランチ [派生元コミット]
  ```

- 新しいブランチを作成してチェックアウトする。
- 派生元コミットでリモートブランチを指定すると、それが上流ブランチとなる。

### reset（ファイル未指定）

- 書式

  ```bash
  git reset [コミット]
  ```

- HEADは、指定したコミットに移動する。
- オプション
  - `--soft`オプションは、ワークツリー・インデックスを変更しない。
  - `--mixed`オプションは、ワークツリーは変更せず、インデックスを変更する。（デフォルト）
  - `--hard`オプションは、ワークツリー・インデックスを変更する。

### reset（ファイル指定）

- 書式

  ```bash
  git reset [コミット] ファイル
  ```

- インデックスは、指定したコミットのファイルの状態となる。
- `git reset ファイル`と`git add ファイル`は、逆の操作である。

## マージ・リベース

### merge

- `merge`コマンドは、コミットをマージする。

  ```bash
  git merge [マージするコミット（省略時は上流ブランチ）]
  ```

- `--no-edit`オプションで、メッセージの編集を省略できる。

### rebase

- `rebase`コマンドは、コミットをリベースする。

  ```bash
  git rebase [リベースするコミット（省略時は上流ブランチ）]
  ```

- `-i`オプションで、対話的にリベースを行うことができる。
- `--autosquash`オプションで、メッセージに`fixup!`を付けたコミットを`fixup`とできる。

## リモートブランチ・タグ操作

### fetch

- `fetch`コマンドは、リモートブランチ・タグを更新する。

  ```bash
  git fetch [リポジトリ [<refspec>]]
  ```

- 引数省略時は、HEADの上流ブランチのリポジトリ、または`origin`の、全ブランチ・タグを更新する。
- 第1引数でリポジトリを指定すると、そのリポジトリの全ブランチ・タグを更新する。
- 第2引数でブランチ・タグを指定すると、更新対象をそれに限定できる。
- リモートのタグがローカルに存在する場合、ローカルのタグは更新されない。

### pull

- `pull`コマンドは、リモートブランチ・タグを更新した後、それをHEADにマージする。
  （`fetch` + `merge FETCH_HEAD`である）

  ```bash
  git pull [リポジトリ [<refspec>]]
  ```

- 引数省略時は、HEADの上流ブランチを更新した後、それをHEADにマージする。
- 第1引数でリポジトリを指定すると、そのリポジトリでの上流ブランチを更新した後、それをHEADにマージする。
- 第2引数でブランチ・タグを指定すると、そのブランチ・タグを更新した後、それをHEADにマージする。
- `--prune`オプションで、リモートで削除されたブランチを削除する。

### push

- `push`コマンドは、リモートリポジトリの指定したブランチ・タグを、ローカルの状態へ更新する。

  ```bash
  git push [リポジトリ [<refspec>]]
  ```

- `-u`オプションで、今回指定するブランチを上流ブランチとして設定する。
- `--tags`オプションで、全タグをプッシュする。
- `-d, --delete`オプションで、指定したリモートブランチを削除する。

### refspec

- TODO あとで調べる

## サブモジュール

### 概要

- `submodule`コマンドは、サブモジュール一覧を表示する。

### update

- `sudmodule update`コマンドで、サブモジュールを親で指定したコミットに更新する。

## その他操作

### diff

- `diff`コマンドは、ファイルの差分を確認できる。

  ```bash
  git diff コミット1..コミット2
  ```

- `--name-only`オプションで、ファイル名のみ表示する。

- `--exit-code`オプションで、差分があれば`1`、なければ`0`で終了ステータスを返す。

- `--quiet`オプションで、`--exit-code`オプションを、標準出力をしない形で適用する。

### clean

- `clean`コマンドは、管理対象外のファイルを削除する。

  ```bash
  git clean [パス（省略時はカレントディレクトリ）]
  ```

- `-f, --force`オプションで、削除を確定できる。
- `-n, --dry-run`オプションで、ドライランできる。
- `-d`オプションで、ディレクトリも含めて削除する。

## gitignore

- `.gitignore`ファイルには、Git管理に含めないファイルを記述する。
- 値がスラッシュから始まらない場合、全サブディレクトリの同名ファイル・ディレクトリが除外される。
- あとからgitignoreを追加する場合は、`git rm --cached`を行う必要がある。
  ただしその場合、それをプルした他ユーザーは、そのファイルが消えてしまう。
  [.gitignoreを後から設定し、git管理から除外する方法 - Qiita](https://qiita.com/yutosa3/items/25ab031c8061e8c9a4c4)

## Gitフック

### 共通

- [Git - Git フック](https://git-scm.com/book/ja/v2/Git-%E3%81%AE%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA-Git-%E3%83%95%E3%83%83%E3%82%AF)
- コミット・プッシュ前のフックでは、終了ステータスが0以外だった場合、そのコミット・プッシュが中断される。

### 作成方法

- `.git/hooks`ディレクトリ内に、フック名を名前とする実行可能なスクリプトファイルを配置する。
- `git init`すると、同ディレクトリにサンプルが格納されるので、これをカスタマイズしファイル名末尾の`.sample`を削除するとよい。

### クライアントサイドフック

- クライアントサイドフックは、リポジトリクローン時にコピーされない。
- 種類
  - pre-commit：コミットメッセージが入力される前
  - prepare-commit-msg：コミットメッセージエディターが起動する直前
  - commit-msg：コミットメッセージを保存した後
  - post-commit：コミットプロセスが全て完了した後

### サーバーサイドフック

- 種類
  - pre-receive：プッシュ前（複数ブランチにプッシュされた場合は、一度のみ実行）
  - update：プッシュ前（複数ブランチにプッシュされた場合は、各ブランチについて実行）
  - post-receive：プッシュ後
